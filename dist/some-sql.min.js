!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var n=e();for(var r in n)("object"==typeof exports?exports:t)[r]=n[r]}}(this,function(){return function(t){function e(r){if(n[r])return n[r].exports;var o=n[r]={exports:{},id:r,loaded:!1};return t[r].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){"use strict";function r(t){return a.init(t)}var o=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},i=n(1),s=function(){function t(t){var e=this;t?e.connect(t):e.connect(new c(e)),e._callbacks={"*":{}},e._actions={},e._views={},e._models={},e._query=[],e._events=["change","delete","upsert","drop","select"],e._events.forEach(function(t){e._callbacks["*"][t]=[]})}return t.prototype.init=function(t){return this._selectedTable=t||"",this},t.prototype.connect=function(t){return this._backend=t,this},t.prototype.on=function(t,e){var n=this;return t.split(" ").forEach(function(t){if(n._events.indexOf(t)==-1)throw new Error(t+"ins't a valid attachable event!");n._callbacks[n._selectedTable][t].push(e)}),this},t.prototype.model=function(t){var e=this,n=e._selectedTable;return e._callbacks[n]={},e._events.forEach(function(t){e._callbacks[n][t]=[]}),e._models[n]=t,e._views[n]={},e._actions[n]={},e._backend.newModel(n,t),e},t.prototype.views=function(t){return this._views[this._selectedTable]=t,this},t.prototype.getView=function(t,e){var n=this,r=n._selectedTable,o=n._views[r][t];return o[1](n.init(r),n._cleanArgs(o,e))},t.prototype._cleanArgs=function(t,e){var n=this,r=(n._selectedTable,{}),o=t;return o[0].forEach(function(t){var o=t.split(":");o.length>1?r[o[0]]=n._cast(o[1],e[o[0]]):r[o[0]]=e[o[0]]}),r},t.prototype._cast=function(t,e){switch(["string","int","float","array","map"].indexOf(t)){case 0:return String(e);case 1:return parseInt(e);case 2:return parseFloat(e);case 3:case 4:return JSON.parse(JSON.stringify(e));default:return e}},t.prototype.actions=function(t){return this._actions[this._selectedTable]=t,this},t.prototype.doAction=function(t,e){var n=this,r=n._selectedTable,o=n._actions[r][t];return o[1](n.init(r),n._cleanArgs(o,e))},t.prototype.query=function(t,e){this._query=[];var n=t.toLowerCase();return["select","upsert","delete","drop"].indexOf(n)!=-1&&this._query.push({type:n,args:e}),this},t.prototype.where=function(t){return this._query.push({type:"where",args:t}),this},t.prototype.andWhere=function(t){return this._query.push({type:"andWhere",args:t}),this},t.prototype.orWhere=function(t){return this._query.push({type:"orWhere",args:t}),this},t.prototype.orderBy=function(t){return this._query.push({type:"orderby",args:t}),this},t.prototype.limit=function(t){return this._query.push({type:"limit",args:t}),this},t.prototype.offset=function(t){return this._query.push({type:"offset",args:t}),this},t.prototype.exec=function(){var t=this,e=t._selectedTable;return t._triggerEvents=[],this._query.map(function(t){switch(t.type){case"select":return[t.type];case"delete":case"upsert":case"drop":return[t.type,"change"];default:return[]}}).forEach(function(e){e.forEach(function(e){t._triggerEvents.push(e)})}),new u(this,function(n,r){t._backend.exec(e,t._query,function(r){t._triggerEvents.forEach(function(n){t._callbacks[e][n].concat(t._callbacks["*"][n]).forEach(function(o){o({type:n,table:e,query:t._query,time:(new Date).getTime(),result:r})})}),n(r)})})},t.prototype.custom=function(t,e){var n=this;return new u(n,function(r,o){n._backend.custom?n._backend.custom(t,e,r):r()})},t.prototype.uuid=function(t){return t?t:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0,n="x"==t?e:3&e|8;return n.toString(16)})}()},t.prototype.loadJS=function(t){var e=this;return i.tsPromise.all(t.map(function(t){return e.init(e._selectedTable).query("upsert",t).exec()}))},t.prototype.loadCSV=function(t){var e=this,n=[];return new u(e,function(r,o){i.tsPromise.all(t.split("\n").map(function(t,r){return new u(e,function(o,i){if(0==r)n=t.split(","),o();else{var s={},c=t.match(/(".*?"|[^",\s]+)(?=\s*,|\s*$)/g).map(function(t){return t.replace(/^"(.+(?="$))"$/,"$1")});n.forEach(function(t,e){0!=c[e].indexOf("{")&&0!=c[e].indexOf("[")||(c[e]=JSON.parse(c[e].replace(/'/g,'"'))),s[t]=c[e]}),e.init(e._selectedTable).query("upsert",c).exec().then(function(){o()})}})})).then(function(){r()})})},t.prototype.toCSV=function(t){var e=this;return new u(e,function(n,r){e.exec().then(function(r){var o=e._query.filter(function(t){return"select"==t.type}).map(function(t){return t.args?t.args.map(function(t){return e._models[e._selectedTable].filter(function(e){return e.key==t})[0]}):e._models[e._selectedTable]})[0];t&&r.unshift(o.map(function(t){return t.key})),n(r.map(function(e,n){return t&&0==n?e:o.filter(function(t){return!!e[t.key]}).map(function(t){switch(t.type){case"map":return'"'+JSON.stringify(e[t.key]).replace(/"/g,"'")+'"';case"array":return'"'+JSON.stringify(e[t.key]).replace(/"/g,"'")+'"';default:return JSON.stringify(e[t.key])}}).join(",")}).join("\n"))})})},t}();e.someSQL_Instance=s;var c=function(){function t(t){this.parent=t}return t.prototype.newModel=function(t,e){},t.prototype.exec=function(t,e,n){n()},t.prototype.custom=function(t,e,n){n()},t}();e.someSQL_Backend=c;var u=function(t){function e(e,n){var r=t.call(this,n)||this;return r.scope=e,r}return o(e,t),e.prototype.then=function(t,n){var r=this;return new e(r.scope,function(e,o){r.done(function(n){if("function"==typeof t)try{n=t.apply(r.scope,[n])}catch(t){return void o(t)}e(n)},function(t){if("function"==typeof n){try{t=n.apply(r.scope,[t])}catch(t){return void o(t)}e(t)}else o(t)})})},e}(i.tsPromise),a=new s;e.someSQL=r},function(t,e){t.exports=function(t){function e(r){if(n[r])return n[r].exports;var o=n[r]={exports:{},id:r,loaded:!1};return t[r].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e){"use strict";var n=function(){function t(t){this._callbacks=[],this._failed=!1,this._resolved=!1,this._settled=!1,t(this._resolve.bind(this),this._reject.bind(this))}return t.resolve=function(e){return new t(function(t){t(e)})},t.reject=function(e){return new t(function(t,n){n(e)})},t.race=function(e){var n=!1;return new t(function(t,r){e.forEach(function(e){e.then(function(e){n||(t(e),n=!0)}).catch(function(t){r(t),n=!0})})})},t.all=function(e){return new t(function(t,n){var r=e.length,o=[],i=!1;e.forEach(function(e,s){e.then(function(e){i||(r--,o[s]=e,0==r&&t(o))}).catch(function(t){n(t),i=!0})})})},t.prototype.done=function(t,e){this._settled?setTimeout(this._release.bind(this,t,e),0):this._callbacks.push({onSuccess:t,onFail:e})},t.prototype.then=function(e,n){var r=this;return new t(function(t,o){r.done(function(n){if("function"==typeof e)try{n=e(n)}catch(t){return void o(t)}t(n)},function(e){if("function"==typeof n){try{e=n(e)}catch(t){return void o(t)}t(e)}else o(e)})})},t.prototype.catch=function(t){return this.then(null,t)},t.prototype._release=function(t,e){if(this._failed){if("function"!=typeof e)throw this._value;e(this._value)}else"function"==typeof t&&t(this._value)},t.prototype._resolve=function(e){this._resolved||(this._resolved=!0,e instanceof t?e.done(this._settle.bind(this),function(t){this._failed=!0,this._settle(t)}.bind(this)):this._settle(e))},t.prototype._reject=function(t){this._resolved||(this._resolved=!0,this._failed=!0,this._settle(t))},t.prototype._settle=function(t){this._settled=!0,this._value=t,setTimeout(this._callbacks.forEach.bind(this._callbacks,function(t){this._release(t.onSuccess,t.onFail)},this),0)},t}();e.tsPromise=n}])}])});