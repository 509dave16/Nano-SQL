!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n=t();for(var r in n)("object"==typeof exports?exports:e)[r]=n[r]}}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.e?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=6)}([function(e,t,n){function r(e){return a.table(e)}var o=n(1),i=n(3),s=function(){function e(){var e=this;e.t={},e.r={},e.a={},e.u=[],e._=[],e.f=["change","delete","upsert","drop","select","error"],e.h={},e.h["*"]={};for(var t=e.f.length;t--;)e.h["*"][e.f[t]]=[];e.b={},e.y=[],e.v={}}return e.prototype.table=function(e){return e&&(this.g=e,this.activeTable=e),this},e.prototype.connect=function(e){var t=this,n=this;if(n.backend){var r="You can only call connect() once for each database!";return new o.Promise(function(e,t){throw t(r),Error(r)})}return n.backend=e||new i.w,new o.Promise(function(e,r){n.backend.x({a:n.a,t:n.t,r:n.r,b:n.b,k:n._,T:t,S:function(t){e(t,n)},I:function(e){r&&r(e)}})})},e.prototype.on=function(e,t){var n=this,r=n.g,o=0;if(!n.h[r])for(n.h[r]={},n.h[r]["*"]=[];o--;)n.h[r][n.f[o]]=[];var i=e.split(" ");for(o=i.length;o--;)n.f.indexOf(i[o])!==-1&&n.h[r][i[o]].push(t);return n},e.prototype.off=function(e){var t=this;for(var n in t.h)for(var r in t.h[n])t.h[n][r]=t.h[n][r].filter(function(t){return t!==e});return t},e.prototype.alwaysApplyFilter=function(e){return this.y.indexOf(e)===-1&&this.y.push(e),this},e.prototype.model=function(e){var t=this,n=t.g,r=t.f.length;if(!t.h[n])for(t.h[n]={},t.h[n]["*"]=[];r--;)t.h[n][t.f[r]]=[];return t.a[n]=e,t.r[n]=[],t.t[n]=[],t},e.prototype.views=function(e){return this.r[this.g]=e,this},e.prototype.getView=function(e,t){void 0===t&&(t={});for(var n,r=this,o=r.g,i=r.r[o].length;i--;)r.r[o][i].name===e&&(n=r.r[o][i]);if(!n)throw Error;return r.O=e,n.call.apply(r,[r.j(n.args?n.args:[],t),r])},e.prototype.j=function(e,t){var n=this,r=(n.g,{}),o=e.length?e.length:-1;if(o>0)for(;o--;){var i=e[o].split(":");i.length>1?r[i[0]]=n.R(i[1],t[i[0]]||null):r[i[0]]=t[i[0]]||null}return r},e.prototype.R=function(e,t){return{string:String(t),int:parseInt(t),float:parseFloat(t),array:JSON.parse(JSON.stringify(t||[])),map:JSON.parse(JSON.stringify(t||{})),bool:t===!0}[e]||t},e.prototype.actions=function(e){return this.t[this.g]=e,this},e.prototype.doAction=function(e,t){void 0===t&&(t={});for(var n,r=this,o=r.g,i=r.t[o].length;i--;)r.t[o][i].name===e&&(n=r.t[o][i]);if(!n)throw Error;return r.O=e,n.call.apply(r,[r.j(n.args?n.args:[],t),r])},e.prototype.addFilter=function(e,t){return this.b[e]=t,this},e.prototype.query=function(e,t){var n=this;this.u=[];var r=e.toLowerCase();if(["select","upsert","delete","drop"].indexOf(r)===-1)throw Error;var o=t||{};if("upsert"===e){var i=JSON.parse(JSON.stringify(t||{}));o={},this.a[this.g].forEach(function(e){i[e.key]&&(o[e.key]=n.R(e.type,i[e.key]))}),this.v[this.g]&&(o=this.v[this.g](o))}return this.u.push({type:r,args:o}),this},e.prototype.where=function(e){return this.A("where",e)},e.prototype.orderBy=function(e){return this.A("orderby",e)},e.prototype.join=function(e){return this.A("join",e)},e.prototype.limit=function(e){return this.A("limit",e)},e.prototype.offset=function(e){return this.A("offset",e)},e.prototype.filter=function(e,t){return this.A("filter-"+e,t)},e.prototype.A=function(e,t){return this.u.push({type:e,args:t}),this},e.prototype.triggerEvent=function(e,t){var n=this;setTimeout(function(){for(var r,o,i=t.length,s=0;i--;)for(r=t[i],o=n.h[n.g][r].concat(n.h[n.g]["*"]),s=o.length;s--;)e.name=r,e.actionOrView=n.O||"",o[s](e,n);n.O=void 0},0)},e.prototype.exec=function(){var e=this,t=e.g;return e.P=e.u.map(function(e){switch(e.type){case"select":return[e.type];case"delete":case"upsert":case"drop":return[e.type,"change"];default:return[]}}).reduce(function(e,t){return e.concat(t)}),new o.Promise(function(n,r){if(!e.backend){var o="You must connect() before calling any queries!";throw r(o),Error(o)}var i=function(n,r,o){e.y.length&&o!==!0&&(n=e.y.reduce(function(t,r,o){return e.b[e.y[o]].apply(e,[n])},n)),e.triggerEvent({name:"error",actionOrView:"",table:t,query:e.u,time:(new Date).getTime(),result:n},e.P),r(n,e)};e.backend.C({D:t,u:e.u,q:e.O||"",S:function(e){i(e,n,!1)},I:function(t){e.P=["error"],r&&i(t,r,!0)}})})},e.prototype.config=function(e){var t=this;return t.backend||t._.push(e),t},e.prototype.extend=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=this;if(n.backend)return n.backend.Q?(e.unshift(n),n.backend.Q.apply(n.backend,e)):void 0},e.prototype.loadJS=function(e){var t=this;return new o.Promise(function(n,r){o.Promise.all(e.map(function(e){return t.table(t.g).query("upsert",e).exec()})).then(function(e){n(e,t)})})},e.prototype.rowFilter=function(e){return this.v[this.g]=e,this},e.prototype.loadCSV=function(e){var t=this,n=[];return new o.Promise(function(r,i){o.Promise.all(e.split("\n").map(function(e,r){return new o.Promise(function(o,i){if(0===r)n=e.split(","),o();else{var s={},a=e.match(/(".*?"|[^",\s]+)(?=\s*,|\s*$)/g)||[];a=a.map(function(e){return e.replace(/^"(.+(?="$))"$/,"$1")});for(var c=n.length;c--;)0!==a[c].indexOf("{")&&0!==a[c].indexOf("[")||(a[c]=JSON.parse(a[c].replace(/'/g,""))),s[n[c]]=a[c];t.table(t.g).query("upsert",s).exec().then(function(){o()})}})})).then(function(){r([],t)})})},e.uuid=function(){var e,t,n,r=function(){return"undefined"==typeof crypto?Math.round(Math.random()*Math.pow(2,16)):crypto.getRandomValues?(n=new Uint16Array(1),window.crypto.getRandomValues(n),n[0]):crypto.randomBytes?crypto.randomBytes(2).reduce(function(e,t){return t*e}):Math.round(Math.random()*Math.pow(2,16))},o="";return[o,o,o,o,o,o,o,o,o].reduce(function(n,i,s){for(e=r(),t=4===s?s:5===s?(e%16&3|8).toString(16):o,e=e.toString(16);e.length<4;)e="0"+e;return n+([3,4,5,6].indexOf(s)>=0?"-":o)+(t+e).slice(0,4)},o)},e.F=function(e){return Math.abs(e.split("").reduce(function(t,n,r){return(t<<5)+t+e.charCodeAt(r)},0))},e.prototype.toCSV=function(e){var t=this;return new o.Promise(function(n,r){t.exec().then(function(r){var o=t.u.filter(function(e){return"select"===e.type}).map(function(e){return e.args?e.args.map(function(e){return t.a[t.g].filter(function(t){return t.key===e})[0]}):t.a[t.g]})[0];e&&r.unshift(o.map(function(e){return e.key})),n(r.map(function(t,n){return e&&0===n?t:o.filter(function(e){return!!t[e.key]}).map(function(e){switch(e.type){case"map":case"array":return'"'+JSON.stringify(t[e.key]).replace(/"/g,"'")+'"';default:return JSON.stringify(t[e.key])}}).join(",")}).join("\n"),t)})})},e}();t.SomeSQLInstance=s;var a=new s;t.SomeSQL=r},function(e,t,n){(function(t,r){/*!
 * @overview es6-promise - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
 * @version   4.0.5+40d194ed
 */
!function(t,n){e.exports=n()}(this,function(){"use strict";function e(e){return"function"==typeof e||"object"==typeof e&&null!==e}function o(e){return"function"==typeof e}function i(e){z=e}function s(e){G=e}function a(){return function(){return t.nextTick(f)}}function c(){return void 0!==U?function(){U(f)}:_()}function u(){var e=0,t=new Z(f),n=document.createTextNode("");return t.observe(n,{characterData:!0}),function(){n.data=e=++e%2}}function l(){var e=new MessageChannel;return e.port1.onmessage=f,function(){return e.port2.postMessage(0)}}function _(){var e=setTimeout;return function(){return e(f,1)}}function f(){for(var e=0;e<K;e+=2){(0,ne[e])(ne[e+1]),ne[e]=void 0,ne[e+1]=void 0}K=0}function d(){try{var e=n(5);return U=e.runOnLoop||e.runOnContext,c()}catch(e){return _()}}function h(e,t){var n=arguments,r=this,o=new this.constructor(b);void 0===o[oe]&&q(o);var i=r.L;return i?function(){var e=n[i-1];G(function(){return P(i,o,e,r.N)})}():j(r,o,e,t),o}function p(e){var t=this;if(e&&"object"==typeof e&&e.constructor===t)return e;var n=new t(b);return T(n,e),n}function b(){}function y(){return new TypeError("You cannot resolve a promise with itself")}function v(){return new TypeError("A promises callback cannot return that same promise.")}function m(e){try{return e.then}catch(e){return ce.error=e,ce}}function g(e,t,n,r){try{e.call(t,n,r)}catch(e){return e}}function w(e,t,n){G(function(e){var r=!1,o=g(n,t,function(n){r||(r=!0,t!==n?T(e,n):I(e,n))},function(t){r||(r=!0,O(e,t))},"Settle: "+(e.B||" unknown promise"));!r&&o&&(r=!0,O(e,o))},e)}function x(e,t){t.L===se?I(e,t.N):t.L===ae?O(e,t.N):j(t,void 0,function(t){return T(e,t)},function(t){return O(e,t)})}function k(e,t,n){t.constructor===e.constructor&&n===h&&t.constructor.resolve===p?x(e,t):n===ce?(O(e,ce.error),ce.error=null):void 0===n?I(e,t):o(n)?w(e,t,n):I(e,t)}function T(t,n){t===n?O(t,y()):e(n)?k(t,n,m(n)):I(t,n)}function S(e){e.M&&e.M(e.N),R(e)}function I(e,t){e.L===ie&&(e.N=t,e.L=se,0!==e.J.length&&G(R,e))}function O(e,t){e.L===ie&&(e.L=ae,e.N=t,G(S,e))}function j(e,t,n,r){var o=e.J,i=o.length;e.M=null,o[i]=t,o[i+se]=n,o[i+ae]=r,0===i&&e.L&&G(R,e)}function R(e){var t=e.J,n=e.L;if(0!==t.length){for(var r=void 0,o=void 0,i=e.N,s=0;s<t.length;s+=3)r=t[s],o=t[s+n],r?P(n,r,o,i):o(i);e.J.length=0}}function A(){this.error=null}function E(e,t){try{return e.apply(this,t)}catch(e){return ue.error=e,ue}}function P(e,t,n,r){var i=o(n),s=void 0,a=void 0,c=void 0,u=void 0;if(i){if(s=E(n,r),s===ue?(u=!0,a=s.error,s.error=null):c=!0,t===s)return void O(t,v())}else s=r,c=!0;t.L!==ie||(i&&c?T(t,s):u?O(t,a):e===se?I(t,s):e===ae&&O(t,s))}function C(e,t){try{t(function(){for(var t=[],n=0;n<arguments.length;n++)t.push(arguments[n]);T(e,t)},function(t){O(e,t)})}catch(t){O(e,t)}}function D(){return le++}function q(e){e[oe]=le++,e.L=void 0,e.N=void 0,e.J=[]}function Q(e,t){this.H=e,this.promise=new e(b),this.promise[oe]||q(this.promise),$(t)?(this.V=t,this.length=t.length,this.Y=t.length,this.N=new Array(this.length),0===this.length?I(this.promise,this.N):(this.length=this.length||0,this.$(),0===this.Y&&I(this.promise,this.N))):O(this.promise,F())}function F(){return new Error("Array Methods must be provided an Array")}function L(e){return new Q(this,e).promise}function N(e){var t=this;return new t($(e)?function(n,r){for(var o=e.length,i=0;i<o;i++)t.resolve(e[i]).then(n,r)}:function(e,t){return t(new TypeError("You must pass an array to race."))})}function B(e){var t=this,n=new t(b);return O(n,e),n}function M(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function J(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function H(e){this[oe]=D(),this.N=this.L=void 0,this.J=[],b!==e&&("function"!=typeof e&&M(),this instanceof H?C(this,e):J())}function V(){var e=void 0;if(void 0!==r)e=r;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;if(t){var n=null;try{n=Object.prototype.toString.call(t.resolve())}catch(e){}if("[object Promise]"===n&&!t.cast)return}e.Promise=H}var Y=void 0;Y=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)};var $=Y,K=0,U=void 0,z=void 0,G=function(e,t){ne[K]=e,ne[K+1]=t,K+=2,2===K&&(z?z(f):re())},W="undefined"!=typeof window?window:void 0,X=W||{},Z=X.MutationObserver||X.WebKitMutationObserver,ee="undefined"==typeof self&&void 0!==t&&"[object process]"==={}.toString.call(t),te="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,ne=new Array(1e3),re=void 0;re=ee?a():Z?u():te?l():void 0===W?d():_();var oe=Math.random().toString(36).substring(16),ie=void 0,se=1,ae=2,ce=new A,ue=new A,le=0;return Q.prototype.$=function(){for(var e=this.length,t=this.V,n=0;this.L===ie&&n<e;n++)this.K(t[n],n)},Q.prototype.K=function(e,t){var n=this.H,r=n.resolve;if(r===p){var o=m(e);if(o===h&&e.L!==ie)this.U(e.L,t,e.N);else if("function"!=typeof o)this.Y--,this.N[t]=e;else if(n===H){var i=new n(b);k(i,e,o),this.z(i,t)}else this.z(new n(function(t){return t(e)}),t)}else this.z(r(e),t)},Q.prototype.U=function(e,t,n){var r=this.promise;r.L===ie&&(this.Y--,e===ae?O(r,n):this.N[t]=n),0===this.Y&&I(r,this.N)},Q.prototype.z=function(e,t){var n=this;j(e,void 0,function(e){return n.U(se,t,e)},function(e){return n.U(ae,t,e)})},H.all=L,H.race=N,H.resolve=p,H.reject=B,H.G=i,H.W=s,H.X=G,H.prototype={constructor:H,then:h,catch:function(e){return this.then(null,e)}},H.polyfill=V,H.Promise=H,H})}).call(t,n(2),n(4))},function(e,t){function n(){throw new Error("setTimeout has not been defined")}function r(){throw new Error("clearTimeout has not been defined")}function o(e){if(l===setTimeout)return setTimeout(e,0);if((l===n||!l)&&setTimeout)return l=setTimeout,setTimeout(e,0);try{return l(e,0)}catch(t){try{return l.call(null,e,0)}catch(t){return l.call(this,e,0)}}}function i(e){if(_===clearTimeout)return clearTimeout(e);if((_===r||!_)&&clearTimeout)return _=clearTimeout,clearTimeout(e);try{return _(e)}catch(t){try{return _.call(null,e)}catch(t){return _.call(this,e)}}}function s(){p&&d&&(p=!1,d.length?h=d.concat(h):b=-1,h.length&&a())}function a(){if(!p){var e=o(s);p=!0;for(var t=h.length;t;){for(d=h,h=[];++b<t;)d&&d[b].run();b=-1,t=h.length}d=null,p=!1,i(e)}}function c(e,t){this.fun=e,this.array=t}function u(){}var l,_,f=e.exports={};!function(){try{l="function"==typeof setTimeout?setTimeout:n}catch(e){l=n}try{_="function"==typeof clearTimeout?clearTimeout:r}catch(e){_=r}}();var d,h=[],p=!1,b=-1;f.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];h.push(new c(e,t)),1!==h.length||p||o(a)},c.prototype.run=function(){this.fun.apply(null,this.array)},f.title="browser",f.browser=!0,f.env={},f.argv=[],f.version="",f.versions={},f.on=u,f.addListener=u,f.once=u,f.off=u,f.removeListener=u,f.removeAllListeners=u,f.emit=u,f.binding=function(e){throw new Error("process.binding is not supported")},f.cwd=function(){return"/"},f.chdir=function(e){throw new Error("process.chdir is not supported")},f.umask=function(){return 0}},function(e,t,n){var r=n(0),o=n(1),i={sum:function(e){return[{sum:e.map(function(e){for(var t in e)return e[t]}).reduce(function(e,t){return e+t},0)}]},min:function(e){return[{min:e.map(function(e){for(var t in e)return e[t]}).sort(function(e,t){return e<t?-1:1})[0]}]},max:function(e){return[{max:e.map(function(e){for(var t in e)return e[t]}).sort(function(e,t){return e>t?-1:1})[0]}]},average:function(e){return[{average:i.sum(e)[0].sum/e.length}]},count:function(e){return[{count:e.length}]}},s=function(){function e(){var e=this;e.a={},e.Z={},e.ee=[],e.te=[[]],e.ne=0,e.re={},e.oe=[0,0],e.ie={},e.se=[],e.ae={},e.ce=[],e.ue=!1}return e.prototype.le=function(e){return this.se[e][this._e(e)]},e.prototype._e=function(e){return this.re[e]},e.prototype.x=function(e){var t,n=this,o=0,s=[],a=!1;n.T=e.T,n.fe=!!e.k.length&&(e.k[0].persistent||!1);for(var c in e.a){var u=r.SomeSQLInstance.F(c);for(s.push(c),n.a[u]=e.a[c],n.ae[u]={},n.Z[u]={de:"",he:c,pe:1,be:[],ye:{}},o=n.a[u].length;o--;)t=n.a[u][o],t.props&&t.props.indexOf("pk")!==-1&&(n.Z[u].de=t.key)}if(n.ve=r.SomeSQLInstance.F(JSON.stringify(e.a)),e.b)for(var l in e.b)i[l]=e.b[l];var _=0;if(n.fe&&"undefined"!=typeof indexedDB){var f=window.indexedDB.open(String(n.ve),1);f.onupgradeneeded=function(t){a=!0;var o=t.target.result,i=function(){if(_<s.length){var t=r.SomeSQLInstance.F(s[_]),a=n.Z[t].de?{keyPath:n.Z[t].de}:{};o.createObjectStore(s[_],a),_++,i()}else e.S()};i()},f.onsuccess=function(t){if(n.me=t.target.result,!a){n.ue=!0;var o=function(){if(_<s.length){var t=(r.SomeSQLInstance.F(s[_]),n.me.transaction(s[_],"readonly")),i=t.objectStore(s[_]),a=i.openCursor(),c=[];t.oncomplete=function(){n.T.table(s[_]).loadJS(c).then(function(){_++,o()})},a.onsuccess=function(e){var t=e.target.result;t&&(c.push(t.value),t.continue())}}else n.ue=!1,e.S()};o()}}}else e.S()},e.prototype.C=function(e){var t=this;t.ee.length?t.ee.push(e):(t.g=r.SomeSQLInstance.F(e.D),new a(t).ge(e,function(e){t.ee.length&&t.C(t.ee.pop())}))},e.prototype.we=function(e){for(var t=this,n=[t.g],r=t.ce.length;r--;)t.ce[r].indexOf(t.g)!==-1&&n.concat(t.ce[r]);t.xe(n.sort()).forEach(function(n){t.ae[n]={},e&&t.T.triggerEvent({name:"change",actionOrView:"",table:t.Z[n].he,query:[],time:(new Date).getTime(),result:[]},["change"])})},e.prototype.xe=function(e){return e.filter(function(e,t,n){return!t||e!==n[t-1]})},e.prototype.Q=function(e,t){var n,r,i,s,a,c,u=this;u.me&&(c=u.me.transaction(u.Z[u.g].he,"readwrite").objectStore(u.Z[u.g].he));var l=function(e){for(n=u.te[u.ne].length;n--;)i=u.te[u.ne][n],s=u.le(i)||{},a=s[u.Z[u.g].de],u.re[i]+=e,s=u.le(i),c&&(s?c.put(s):c.delete(a)),u.re[i]<0&&(u.re[i]=0)};return new o.Promise(function(e,n){if(!u.te.length&&["<",">"].indexOf(t)!==-1)return void e(!1);switch(t){case"<":u.ne===u.te.length-1?e(!1):(l(1),u.ne++,u.we(!0),e(!0));break;case">":u.ne<1?e(!1):(u.ne--,l(-1),u.we(!0),e(!0));break;case"?":r=[u.te.length-1,u.ne],u.oe.join("+")!==r.join("+")&&(u.oe=r),e(u.oe);break;case"flush_db":u.me&&window.indexedDB.deleteDatabase(String(u.ve));break;case"disable":u.ue=!0;break;case"enable":u.ue=!1}})},e}();t.w=s;var a=function(){function e(e){this.ke=e}return e.prototype.ge=function(e,t){var n=this;n.Te=[],n.Se=void 0,n.ke.g=r.SomeSQLInstance.F(e.D),n.Ie=r.SomeSQLInstance.F(JSON.stringify(e.u)),e.u.forEach(function(e){["upsert","select","delete","drop"].indexOf(e.type)!==-1?n.Se=e:n.Te.push(e)}),n.Oe(function(r){e.S(r),t(n)})},e.prototype.je=function(){var e=this,t=e.ke.se.length;return e.ke.se.push([null]),e.ke.Z[e.ke.g].be.push(t),e.ke.re[t]=0,t},e.prototype.Oe=function(e){var t=this;if(t.Se){var n,o,i,s,a,c,u,l,_,f,d,h,p,b,y,v=t.ke.Z[t.ke.g].de,m=t.Se.args||[],g=t.ke.Z[t.ke.g].be.slice(),w=0,x=[],k=[],T=[],S=t.Te.filter(function(e){return"where"===e.type}),I=function(e){return t.Te.filter(function(t){return t.type===e}).pop()},O=function(n,r){n>0?(t.ke.ne>0&&t.ke.ue!==!0&&(t.ke.te=t.ke.te.filter(function(e,n){if(n<t.ke.ne){for(i=e.length;i--;)t.ke.re[e[i]]=0,t.ke.se[e[i]].shift();return!1}return!0}),t.ke.ne=0),t.ke.ue?(t.ke.te[0]||(t.ke.te[0]=[]),t.ke.te[0]=t.ke.te[0].concat(k)):t.ke.te.unshift(k),t.ke.we(!1),e([{msg:n+" row(s) "+r}])):e([{msg:"0 rows "+r}])},j=function(e){return t.ke.a[t.ke.g].forEach(function(t){var n=e[t.key];"object"==typeof n&&null!==n&&"blob"!==t.type&&(n=j(n))}),Object.freeze(e)},R=function(e,n){k.push(e);var r={},o=t.ke.le(e)||{};if(t.ke.a[t.ke.g].forEach(function(e){"object"==typeof o[e.key]&&"blob"!==e.type?r[e.key]=JSON.parse(JSON.stringify(o[e.key])):r[e.key]=o[e.key]||e.default||null}),Object.getOwnPropertyNames(m||{}).forEach(function(e){r[e]=n(e,r[e])}),t.ke.se[e].unshift(j(r)),t.ke.me){var i=t.ke.Z[t.ke.g].he;t.ke.me.transaction(i,"readwrite").objectStore(i).put(r)}};switch("drop"!==t.Se.type&&(x=S.length&&!I("join")?t.Re(g,S[0].args):g),t.Se.type){case"upsert":if(n="updated",o=x.length,S.length&&m[v])throw new Error("Can't use a where statement if you have a non null primary key value!");if(S.length)for(w=o,n="modified";o--;)R(x[o],function(e,t){return e!==v?m[e]:t});else{if(c=0,m[v])t.ke.Z[t.ke.g].ye[m[v]]?c=t.ke.Z[t.ke.g].ye[m[v]]:(c=t.je(),n="inserted",t.ke.Z[t.ke.g].pe=Math.max(m[v]+1,t.ke.Z[t.ke.g].pe),t.ke.Z[t.ke.g].ye[m[v]]=c);else for(n="inserted",s=t.ke.a[t.ke.g].length;s--;)if(u=t.ke.a[t.ke.g][s],u.props&&u.props.indexOf("pk")!==-1){switch(u.type){case"int":m[v]=t.ke.Z[t.ke.g].pe++;break;case"uuid":m[v]=r.SomeSQLInstance.uuid()}c=t.je(),t.ke.Z[t.ke.g].ye[m[v]]=c}R(c,function(e,t){return m[e]||t}),w=1}O(w,n);break;case"select":if(t.ke.ae[t.ke.g][t.Ie]){e(t.ke.ae[t.ke.g][t.Ie]);break}l=["join","orderby","offset","limit"];var A=function(e,n,o){if(_=I(l[n]),!_)return o(e);switch(n){case 0:t.ke.T.table(_.args.table).query("select").exec().then(function(n,i){a=_.args.where.map(function(e,t){return e.split(".").map(function(e,n){return 1!==t&&0===n?r.SomeSQLInstance.F(e):e})});var s=t.ke.Z[a[2][0]];n=n.map(function(e){return s.ye[e[s.de]]}).filter(function(e){return e}),e=t.Ae(_.args.type,e,n,a),S.length&&(e=t.Re(e,S[0].args)),o(e)});break;case 1:o(e.sort(function(e,n){f=[];for(var r in _.args)f.push(r);return f.reduce(function(r,o,i){return d=f[i],h=t.ke.le(e)||{},p=t.ke.le(n)||{},(h[d]>p[d]?1:-1)*("asc"===_.args[d]?1:-1)+r},0)}));break;case 2:o(e.filter(function(e,t){return!_||t>=_.args}));break;case 3:o(e.filter(function(e,t){return!_||t<_.args}))}};o=l.length;var E=function(n){o>-1?(o--,A(n,o,function(e){E(e)})):(T=n.map(function(e){if(i=m.length||0){if(y={},b=t.ke.le(e))for(;i--;)y[m[i]]=b[m[i]];else y=null;return y}return t.ke.le(e)}).filter(function(e){return e}),T=t.Ee(T),t.ke.ae[t.ke.g][t.Ie]=T,e(t.ke.ae[t.ke.g][t.Ie]))};E(x);break;case"drop":case"delete":var P=[];P=x.length&&"delete"===t.Se.type?x:g,n="deleted",o=P.length;for(var C=t.ke.Z[t.ke.g].he;o--;)if(m.length)R(P[o],function(e,t){return m.indexOf(e)!==-1?null:t}),n="modified";else{var D=(t.ke.le(P[o])||{})[t.ke.Z[t.ke.g].de];t.ke.me&&D&&t.ke.me.transaction(C,"readwrite").objectStore(C).delete(D),t.ke.se[P[o]].unshift(null),k.push(P[o])}O(P.length,n)}}},e.prototype.Pe=function(e,t){var n,r=this;return e.filter(function(e){return n=r.ke.le(e),!!n&&0===r.Ce(t[2],t[1],n[t[0]])})},e.prototype.Re=function(e,t){var n,r=this,o=["and","or"],i=function(e,t){return r.ke.xe(e[0].concat(e[1]).sort().filter(function(e,n,r){return"and"!==t||n!==r.lastIndexOf(e)}))};return"string"==typeof t[0]?r.Pe(e,t):t.map(function(t){return o.indexOf(t)!==-1?t:r.Pe(e,t)}).reduce(function(e,t,r){return o.indexOf(t)===-1?0===r?t:i([e,t],n):(n=t,e)})},e.prototype.Ae=function(e,t,n,r){var o,i,s,a,c,u,l=this,_=[],f=[],d=[r[0][0],r[2][0]],h=[l.ke.Z[r[0][0]].he,l.ke.Z[r[2][0]].he],p=[l.ke.a[r[0][0]],l.ke.a[r[2][0]]],b={},y=[],v=[],m=t.length;for(m=l.ke.ce.length,a=0;m--&&!a;)l.ke.ce[m].indexOf(d[0])!==-1&&l.ke.ce[m].indexOf(d[1])!==-1&&(a=1);a||l.ke.ce.push(d);var g=function(e,t){return o=e.join("+"),i=!1,u=e.map(function(e){return l.ke._e(e)}),l.ke.ie[o]||(i=!0,l.ke.ie[o]={De:0,qe:u}),(i||u.join("+")!==l.ke.ie[o].qe.join("+"))&&(b={},p.forEach(function(n,r){s=e[r]===-1||t[r]===!1,n.forEach(function(e){b[h[r]+"."+e.key]=s?null:t[r][e.key]})}),i&&(l.ke.ie[o].De=l.je()),l.ke.se[l.ke.ie[o].De].unshift(b)),l.ke.ie[o].De};for(m=t.length;m--;){for(a=n.length,_[0]=l.ke.le(t[m])||{},y=[];a--;)_[1]=l.ke.le(n[a])||{},l.Ce(_[0][r[0][1]],r[1][0],_[1][r[2][1]])&&"cross"!==e||(y.push([n[a],_[1]]),v.push(n[a]));if(c=y.length)for(;c--;)f.push(g([t[m],y[c][0]],[_[0],y[c][1]]));else"left"===e&&f.push(g([t[m],-1],[_[0],!1]))}if("right"===e)for(m=n.length;m--;)v.indexOf(n[m])===-1&&f.push(g([-1,n[m]],[!1,l.ke.le(n[m])||{}]));return f.reverse()},e.prototype.Ce=function(e,t,n){switch(t){case"=":return n===e?0:1;case">":return n>e?0:1;case"<":return n<e?0:1;case"<=":return n<=e?0:1;case">=":return n>=e?0:1;case"IN":return e.indexOf(n)===-1?1:0;case"NOT IN":return e.indexOf(n)===-1?0:1;case"REGEX":case"LIKE":return n.search(e)===-1?1:0;default:return 0}},e.prototype.Ee=function(e){var t=this,n=t.Te.filter(function(e){return 0===e.type.indexOf("filter-")});return n.length?n.reduce(function(e,r,o){return i[n[o].type.replace("filter-","")].apply(t,[e,n[o].args])},e):e},e}()},function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t){},function(e,t,n){e.exports=n(0)}])});