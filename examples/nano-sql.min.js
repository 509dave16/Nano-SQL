!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n=t();for(var r in n)("object"==typeof exports?exports:e)[r]=n[r]}}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.e?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=14)}([function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=n(4);n(7),t.t=function(e){return JSON.parse(JSON.stringify(e))};var i=function(){function e(){var e=this;e.r={},e.a={},e._={},e.u=[],e.f=["change","delete","upsert","drop","select","error"],e.h={},e.y={},e.h["*"]={};for(var t=e.f.length;t--;)e.h["*"][e.f[t]]=[];e.b={},e.g={}}return e.prototype.table=function(e){return e&&(this.v=e),this},e.prototype.connect=function(e){var t=this,n=this;return n.backend?new o.x(function(e,t){throw t(),Error()}):(n.backend=e||new r.k,new o.x(function(e,r){n.backend.w({_:n._,r:n.r,a:n.a,b:n.b,O:n.u,S:t,I:function(t){e(t,n)},j:function(e){r&&r(e,n)}})}))},e.prototype.on=function(e,t){var n=this,r=n.v,o=0,i=e.split(" ");if(!n.h[r])for(n.h[r]={},n.h[r]["*"]=[];o--;)n.h[r][n.f[o]]=[];for(o=i.length;o--;)-1!==n.f.indexOf(i[o])&&n.h[r][i[o]].push(t);return n.N(),n},e.prototype.off=function(e){var t=this;for(var n in t.h)for(var r in t.h[n])t.h[n][r]=t.h[n][r].filter(function(t){return t!==e});return t.N(),t},e.prototype.N=function(){var e=this;this.y={},Object.keys(this._).concat(["*"]).forEach(function(t){e.y[t]=e.f.reduce(function(n,r){return n+(e.h[t]?e.h[t][r].length:0)},0)>0})},e.prototype.model=function(e){var t=this,n=t.v,r=t.f.length;if(!t.h[n])for(t.h[n]={},t.h[n]["*"]=[];r--;)t.h[n][t.f[r]]=[];return t._[n]=e,t.a[n]=[],t.r[n]=[],t},e.prototype.views=function(e){return this.a[this.v]=e,this},e.prototype.getView=function(e,t){return void 0===t&&(t={}),this.P("View",this.a[this.v],e,t)},e.prototype.cleanArgs=function(e,t){var n=this,r=(n.v,{}),o=e.length?e.length:-1;if(o>0)for(;o--;){var i=e[o].split(":");i.length>1?r[i[0]]=n.M(i[1],t[i[0]]||null):r[i[0]]=t[i[0]]||null}return r},e.prototype.M=function(e,n){var r=this,o=typeof n,i={string:"string"!==o?String(n):n,int:"number"!==o||n%1!=0?parseInt(n||0):n,float:"number"!==o?parseFloat(n||0):n,array:Array.isArray(n)?t.t(n||[]):[],"any[]":Array.isArray(n)?t.t(n||[]):[],any:n,blob:n,uudi:n,timeId:n,map:"object"===o?t.t(n||{}):{},bool:!0===n},a=i[e];if(void 0!==a)return a;if(-1!==e.indexOf("[]")){var s=e.slice(0,e.lastIndexOf("[]"));return(n||[]).map(function(e){return r.M(s,e)})}return n},e.prototype.actions=function(e){return this.r[this.v]=e,this},e.prototype.doAction=function(e,t){return this.P("Action",this.r[this.v],e,t)},e.prototype.P=function(e,t,n,r){var i=this,a=this,s=t.reduce(function(e,t){return t.name===n?t:e},null);if(!s)return new o.x(function(e,t){return t("Action/View Not Found!")});a.D=n;var _=s.args?a.cleanArgs(s.args,r):{};return a.L?new o.x(function(t,n){a.L(i.v,e,a.D||"",_,function(e){!!s&&s.call(e,a).then(function(e){t(e,a)})},function(e){n(e)})}):s.call(_,a)},e.prototype.newFunction=function(e,t,n){return this.b[e]={type:t,call:n},this},e.prototype.query=function(e,t){var n=this,r=new a(n.v,n,n.D);n.D=void 0;var o=e.toLowerCase();if(-1===["select","upsert","delete","drop","show tables","describe"].indexOf(o))throw Error;var i=t||("select"===o||"delete"===o?[]:{});if("upsert"===e){var s={};n._[n.v].forEach(function(e){i[e.key]&&(s[e.key]=n.M(e.type,i[e.key]))}),n.g[n.v]&&(s=n.g[n.v](s)),i=s}return r.T={type:o,args:i},r},e.prototype.triggerEvent=function(e,t){var n=this;setTimeout(function(){for(var r,o,i=t.length,a=0;i--;)for(r=t[i],o=n.h[e.table][r].concat(n.h[e.table]["*"]),a=o.length;a--;)e.name=r,o[a](e,n)},0)},e.prototype.default=function(e){var t={},n=this;return n._[n.v].forEach(function(r){t[r.key]=e&&e[r.key]?e[r.key]:r.default,t[r.key]||(t[r.key]=n.M(r.type,null))}),t},e.prototype.beginTransaction=function(){if(this.doingTransaction=!0,this.backend.A)return this.backend.A("start")},e.prototype.endTransaction=function(){if(this.doingTransaction=!1,this.backend.A)return this.backend.A("end")},e.prototype.queryFilter=function(e){return this.C=e,this},e.prototype.avFilter=function(e){return this.L=e,this},e.prototype.config=function(e){var t=this;return t.backend||t.u.push(e),t},e.prototype.extend=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=this;if(n.backend)return n.backend.R?(e.unshift(n),n.backend.R.apply(n.backend,e)):void 0},e.prototype.loadJS=function(e,t){var n=this;return n.beginTransaction(),new o.x(function(r,o){var i=0,a=[],s=function(){i<t.length?t[i]?n.table(e).query("upsert",t[i]).exec().then(function(e){a.push(e),i++,s()}):(i++,s()):(n.endTransaction(),r(a,n))};s()})},e.prototype.rowFilter=function(e){return this.g[this.v]=e,this},e.prototype.loadCSV=function(e,t){var n=this,r=[];return n.beginTransaction(),new o.x(function(i,a){o.x.all(t.split("\n").map(function(t,i){return new o.x(function(o,a){if(0===i)r=t.split(","),o();else{var s={},_=t.match(/(".*?"|[^",\s]+)(?=\s*,|\s*$)/g)||[];_=_.map(function(e){return e.replace(/^"(.+(?="$))"$/,"$1")});for(var c=r.length;c--;)0!==_[c].indexOf("{")&&0!==_[c].indexOf("[")||(_[c]=JSON.parse(_[c].replace(/'/g,""))),s[r[c]]=_[c];n.table(e).query("upsert",s).exec().then(function(){o()})}})})).then(function(){n.endTransaction(),i([],n)})})},e.Q=function(){if("undefined"==typeof crypto)return Math.round(Math.random()*Math.pow(2,16));if(crypto.getRandomValues){var e=new Uint16Array(1);return crypto.getRandomValues(e),e[0]}return"undefined"!==global&&global.q.randomBytes?global.q.randomBytes(2).reduce(function(e,t){return t*e}):Math.round(Math.random()*Math.pow(2,16))},e.timeid=function(e){var t=this;t.F||(t.F=6e4*(new Date).getTimezoneOffset());for(var n=Math.round(((new Date).getTime()+t.F)/(e?1:1e3)).toString();n.length<(e?13:10);)n="0"+n;return n+"-"+(t.Q()+t.Q()).toString(16)},e.uuid=function(){var e,t,n=this,r="";return[r,r,r,r,r,r,r,r,r].reduce(function(o,i,a){for(e=n.Q(),t=4===a?a:5===a?(e%16&3|8).toString(16):r,e=e.toString(16);e.length<4;)e="0"+e;return o+([3,4,5,6].indexOf(a)>=0?"-":r)+(t+e).slice(0,4)},r)},e.V=function(e){return Math.abs(e.split("").reduce(function(t,n,r){return(t<<5)+t+e.charCodeAt(r)},0))},e}();t.NanoSQLInstance=i;var a=function(){function e(e,t,n){this.B=t,this.J=[],this.H=e,this.W=n||""}return e.prototype.where=function(e){return e.length&&Array.isArray(e)||(this.K="Where condition requires an array!"),this.z("where",e)},e.prototype.range=function(e,t){return this.z("range",[e,t])},e.prototype.orderBy=function(e){return this.z("orderby",e)},e.prototype.groupBy=function(e){return this.z("groupby",e)},e.prototype.having=function(e){return e.length&&Array.isArray(e)||(this.K="Having condition requires an array!"),this.z("having",e)},e.prototype.join=function(e){return e.table&&e.type||(this.K="Join command requires table and type arguments!"),this.z("join",e)},e.prototype.limit=function(e){return this.z("limit",e)},e.prototype.trieSearch=function(e,t){return this.z("trie",[e,t])},e.prototype.offset=function(e){return this.z("offset",e)},e.prototype.z=function(e,t){return this.J.push({type:e,args:t}),this},e.prototype.toCSV=function(e){var t=this;return new o.x(function(n,r){t.exec().then(function(r){var o=t.T.args.length?t.T.args.map(function(e){return t.B._[t.H].filter(function(t){return t.key===e})[0]}):t.B._[t.H];e&&r.unshift(o.map(function(e){return e.key})),n(r.map(function(t,n){return e&&0===n?t:o.filter(function(e){return!!t[e.key]}).map(function(e){switch(e.type){case"map":case"array":return'"'+JSON.stringify(t[e.key]).replace(/"/g,"'")+'"';default:return t[e.key]}}).join(",")}).join("\n"),t)})})},e.prototype.exec=function(){var e=this,t=e.H;return e.B.y[t]&&(e.B.U=function(){switch(e.T.type){case"select":return[e.T.type];case"delete":case"upsert":case"drop":return[e.T.type,"change"];default:return[]}}()),new o.x(function(n,r){if(e.K)throw r(e.K),Error;if(!e.B.backend)throw r(),Error;var o=function(n,r,o,i,a){e.B.y[t]&&e.B.triggerEvent({name:"error",actionOrView:e.W,table:t,query:[e.T].concat(e.J),time:(new Date).getTime(),result:n,changeType:o,changedRows:i},e.B.U),r(n,e.B)},i={table:t,query:[e.T].concat(e.J),viewOrAction:e.W,onSuccess:function(t,r,i){e.B.doingTransaction?n(t,e.B):o(t,n,r,i)},onFail:function(t){e.B.doingTransaction?n(t,e.B):(e.B.U=["error"],r&&o(t,r,"error",[]))}};e.B.C?e.B.C(i,function(t){e.B.backend.$(t)}):e.B.backend.$(i)})},e}();t.X=a;var s=new i;t.nSQL=function(e){return s.table(e)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={END_WORD:"$",PERMS_MIN_LEN:2},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={objectCopy:function(e){return void 0===e?{}:JSON.parse(JSON.stringify(e))},stringify:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return void 0===e?"":JSON.stringify(e,null,t)}},e.exports=t.default},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),o=n(4),i=n(13),a=n(6);t.G=function(e){return["_utility","_historyPoints","_pointer","_historyDataRowIDs"][e]};var s=function(){function e(){var e=this;e.Y=[],e.Z={}}return e.prototype.w=function(e){var t=this;t.ee=r.NanoSQLInstance.V(JSON.stringify(e._)).toString(),t.S=e.S,t.te=new i.ne(t,e)},e.prototype.$=function(e){var t=this;new a.X(t).re(e)},e.prototype.oe=function(e,t,n,r){var o=this;o.Z[e]={},t.length&&r&&o.S.triggerEvent({name:"change",actionOrView:"",table:o.te.ae[e].ie,query:[],time:(new Date).getTime(),result:[{msg:r+" was performed.",type:r}],changedRows:t,changeType:n},["change"])},e.prototype.se=function(e,t){if(!e)return e;var n=this;return n.te._[t].forEach(function(r){var o=e[r.key];["map","array"].indexOf(typeof o)>=0&&(e[r.key]=n.se(o,t))}),Object.freeze(e)},e.prototype.A=function(e){return"start"===e&&(this.te._e={},this.te.ce=!0),"end"===e&&(this.te.ce=!1,this.te.ue()),!!this.te.ce},e.prototype.R=function(e,n){var i,a,s,_,c=this,u=function(e,n){var o={},a=c.te.fe-c.te.le;c.te.de("_historyPoints",function(e){return e.historyPoint===a},function(a){s=0;var u=function(){if(s<a.length){i=0;var f=a[s].tableID,l=c.te.ae[f],d=[],p=function(){i<a[s].rowKeys.length?(_=a[s].rowKeys[i],"int"===l.pe&&(_=parseInt(_)),c.te.de(l.ie,_,function(n){e>0&&d.push(n[0]),c.te.de("_"+l.ie+"_hist__meta",_,function(n){n=r.t(n),n[0][t.G(2)]+=e;var u=n[0][t.G(3)][n[0][t.G(2)]];c.te.he("_"+l.ie+"_hist__meta",_,n[0],function(){c.te.de("_"+l.ie+"_hist__data",u,function(t){var n=t[0]?r.t(t[0]):null;c.te.he(l.ie,_,n,function(){e<0&&d.push(n),o[f]||(o[f]={type:a[s].type,rows:[]}),o[f].rows=o[f].rows.concat(d),i++,p()})})})})})):(s++,u())};p()}else n(o)};u()})};return new o.x(function(e,t){switch(n){case"<":c.te.fe&&c.te.le!==c.te.fe?u(1,function(t){c.te.le++,c.te.ye("w","historyPoint",c.te.le),Object.keys(t).forEach(function(e){var n=t[e].type;switch(n){case"inserted":n="deleted";break;case"deleted":n="inserted"}c.oe(parseInt(e),t[e].rows,n,"undo")}),e(!0)}):e(!1);break;case">":!c.te.fe||c.te.le<1?e(!1):(c.te.le--,c.te.ye("w","historyPoint",c.te.le),u(-1,function(t){Object.keys(t).forEach(function(e){c.oe(parseInt(e),t[e].rows,t[e].type,"redo")}),e(!0)}));break;case"?":a=[c.te.fe,c.te.fe-c.te.le],c.te.be.join("+")!==a.join("+")&&(c.te.be=a),e(c.te.be);break;case"flush_history":case"flush_db":c.te.ye("w","historyPoint",0),c.te.ye("w","historyLength",0),c.te.le=0,c.te.fe=0,Object.keys(c.te.ae).forEach(function(e){var t;0===c.te.ae[parseInt(e)].ie.indexOf("_")?t=[]:(t=c.te.ae[parseInt(e)].ge,t=Object.keys(t).map(function(e){return t[e]})),c.oe(parseInt(e),t,"remove","clear")}),"flush_db"===n?c.te.ve("all",e):c.te.ve("hist",e)}})},e}();t.k=s},function(e,t,n){"use strict";function r(e,t,n){f(function(){var r;try{r=t.apply(null,n)}catch(t){return p.me(e,t)}return r===e?p.me(e,new TypeError):p.xe(e,r),null})}function o(e){var t=e&&e.then;return!e||"object"!=typeof e&&"function"!=typeof e||"function"!=typeof t?null:function(){t.apply(e,arguments)}}function i(e,t){function n(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];i||(i=!0,p.me(e,t))}function r(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];i||(i=!0,p.xe(e,t))}function o(){t(r,n)}var i=!1,s=a(o);"error"===s.ke&&n(s.we)}function a(e,t){var n={ke:null,we:null};try{n.we=e(t),n.ke="success"}catch(e){n.ke="error",n.we=e}return n}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){},_=["R"],c=["F"],u=["P"],f="undefined"!=typeof setImmediate?setImmediate:setTimeout,l=function(){function e(e){this.Oe=u,this.Se=[],this.Ie=void 0,e!==s&&i(this,e)}return e.prototype.catch=function(e){return this.then(function(){},e)},e.prototype.then=function(t,n){if("function"!=typeof t&&this.Oe===c||"function"!=typeof n&&this.Oe===_)return this;var o=new e(s);return this.Oe!==u?r(o,this.Oe===c?t:n,this.Ie):this.Se.push(new d(o,t,n)),o},e.resolve=function(t){return t instanceof this?t:p.xe(new e(s),t)},e.reject=function(t){return p.me(new e(s),t)},e.all=function(t){var n=this,r=t.length,o=!1,i=new Array(r),a=0,_=-1,c=new e(s);if(!r)return this.resolve([]);for(;++_<r;)!function(e,t){function s(e){i[t]=e,++a!==r||o||(o=!0,p.xe(c,i))}n.resolve(e).then(s,function(e){o||(o=!0,p.me(c,e))})}(t[_],_);return c},e.race=function(t){var n=this,r=t.length,o=!1,i=-1,a=new e(s);if(!1!==Array.isArray(t))return this.reject(new TypeError);if(!r)return this.resolve([]);for(;++i<r;)!function(e){n.resolve(e).then(function(e){o||(o=!0,p.xe(a,e))},function(e){o||(o=!0,p.me(a,e))})}(t[i]);return a},e}();t.x=l;var d=function(){function e(e,t,n){this.Ee=e,"function"==typeof t&&(this.je=t,this.Ne=this.Pe),"function"==typeof n&&(this.Me=n,this.De=this.Le)}return e.prototype.Ne=function(e){p.xe(this.Ee,e)},e.prototype.Pe=function(e){r(this.Ee,this.je,e)},e.prototype.De=function(e){p.me(this.Ee,e)},e.prototype.Le=function(e){r(this.Ee,this.Me,e)},e}();t.Te=d;var p=function(){function e(){}return e.xe=function(t,n){var r=a(o,n),s=r.we,_=-1,u=t.Se.length;if("error"===r.ke)return e.me(t,r.we);if(s)i(t,s);else for(t.Oe=c,t.Ie=n;++_<u;)t.Se[_].Ne(n);return t},e.me=function(e,t){e.Oe=_,e.Ie=t;for(var n=-1,r=e.Se.length;++n<r;)e.Se[n].De(t);return e},e}()},function(e,t,n){"use strict";function r(e){return e&&e.e?e:{default:e}}function o(e,t,n,r){return e[t]=e[t]||{},e=e[t],n===r.length-1&&(e[a.default.END_WORD]=1),e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=o;var i=n(1),a=r(i);r(n(2)),e.exports=t.default},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),o=n(3),i=function(e,t,n,o,i){var a=n[0];0===o[0]&&(i[a]=-1===e?Number.MAX_VALUE:Number.MIN_VALUE);var s={};if(s=(-1===e?parseFloat(t[a])<parseFloat(i[a]):parseFloat(t[a])>parseFloat(i[a]))?t:i,o[0]===o[1]){var _=r.t(s);return _[-1===e?"MIN":"MAX"]=s[a],_}return s};t.b={SUM:{type:"aggregate",call:function(e,t,n,o){if(0===n[0]&&(o=0),o+=parseInt(e[t[0]]),n[0]===n[1]){var i=r.t(e);return i.SUM=o,i}return o}},MIN:{type:"aggregate",call:function(e,t,n,r){return i(-1,e,t,n,r)}},MAX:{type:"aggregate",call:function(e,t,n,r){return i(1,e,t,n,r)}},AVG:{type:"aggregate",call:function(e,t,n,o){if(0===n[0]&&(o=0),o+=parseInt(e[t[0]]),n[0]===n[1]){var i=r.t(e);return i.AVG=o/(n[1]+1)||o,i}return o}},COUNT:{type:"aggregate",call:function(e,t,n,o){if(0===n[0]&&(o=0),"*"===t[0]?o++:o+=e[t[0]]?1:0,n[0]===n[1]){var i=r.t(e);return i.COUNT=o,i}return o}}};var a=function(){function e(e){this.B=e}return e.prototype.re=function(e){var t=this;t.Ae=r.NanoSQLInstance.V(e.table),t.Ce=[],t.Re=void 0;var n=[];if(e.query.forEach(function(o){["upsert","select","delete","drop"].indexOf(o.type)>=0?(t.Re=o,"select"===o.type&&(t.Qe=r.NanoSQLInstance.V(JSON.stringify(e.query)))):["show tables","describe"].indexOf(o.type)>=0?n.push(o):t.Ce.push(o)}),n.length)switch(n[0].type){case"show tables":e.onSuccess([{tables:Object.keys(t.B.te.ae).map(function(e){return t.B.te.ae[e].ie})}],"info",[]);break;case"describe":var o,i=t.Ae,a={};Object.keys(t.B.te.ae).forEach(function(e){parseInt(e)===t.Ae&&(o=r.t(t.B.te._[e]),i=t.B.te.ae[e].ie)}),a[i]=o,e.onSuccess([a],"info",[])}else t.qe(function(t,n,r){e.onSuccess(t,n,r)})},e.prototype.Fe=function(e){return this.Ce.filter(function(t){return t.type===e}).pop()},e.prototype.qe=function(e){var t=this;if(t.Re){var n=function(n){if(t.Re)switch(t.Re.type){case"upsert":t.he(n,e);break;case"select":t.Ve(n,e);break;case"drop":case"delete":t.Be(n,e)}},r=t.B.te.ae[t.Ae];if(t.Fe("join")||"drop"===t.Re.type)n([]);else if(t.Fe("where")){var o=t.Fe("where").args,i=function(e){return-1===["=","IN","BETWEEN"].indexOf(e[1])?1:e[0]===r.Je?0:-1!==r.He.indexOf(e[0])?0:1},a=function(e,n){var o=e[0]===r.Je?r.ie:"_"+r.ie+"_idx_"+e[0];switch(e[1]){case"=":t.B.te.de(o,e[2],function(e){n(e)});break;case"IN":var i=0,a=[],s=function(){i<e[2].length?t.B.te.de(o,e[2][i],function(e){a=a.concat(e),i++,s()}):n(a)};s();break;case"BETWEEN":t.B.te.We(o,e[0],e[2],n)}};if("string"==typeof o[0]?0===i(o):0===o.reduce(function(e,t,n){return n%2==1?e:e+i(t)},0))if("string"==typeof o[0])a(o,n);else{var s=[],_=0,c="",u=function(){_<o.length?_%2==1?(c=o[_],_++,u()):a(o[_],function(e){if("AND"===c){var t=e.map(function(e){return e[r.Je]});s=s.filter(function(e){return-1!==t.indexOf(e[r.Je])})}else s=s.concat(e);_++,u()}):n(s)};u()}else t.B.te.de(r.ie,function(e){return e&&t.Ke(e,o)},function(e){n(e)})}else if(t.Fe("range")){var f=t.Fe("range").args;t.ze(f[0],f[1],n)}else if(t.Fe("trie")){var l=t.Fe("trie").args,d=r.Ue[l[0]].getPrefix(String(l[1]).toLocaleLowerCase()),p="_"+r.ie+"_idx_"+l[0],h=0,y=[],b=function(){h<d.length?t.B.te.de(p,d[h],function(e){y=y.concat(e),h++,b()}):n(y)};b()}else"upsert"!==t.Re.type?t.B.te.de(r.ie,"all",function(e){n(e)}):n([])}},e.prototype.ze=function(e,t,n){var r=this,o=r.B.te.ae[r.Ae],i=o.$e[t],a=o.$e[t+(e-1)];r.B.te.We(o.ie,o.Je,[i,a],function(e){n(e)})},e.prototype.Xe=function(e,t){var n=this,i=n.B.te.ae[n.Ae],a=n.Re.args,s=function(){return n.Re&&"delete"===n.Re.type&&!a.length?"drop":n.Re?n.Re.type:""}(),_=function(r){"upsert"===s?(0!==i.ie.indexOf("_")&&(i.He.forEach(function(t){n.B.te.he("_"+i.ie+"_idx_"+t,String(r[t]).toLocaleLowerCase(),{id:r[t],rowPK:e},function(){})}),i.Ge.forEach(function(e){n.B.te.ae[n.Ae].Ue[e].addWord(String(r[e]).toLocaleLowerCase())})),n.B.te.he(i.ie,e,r,function(){t()})):(0!==i.ie.indexOf("_")&&(i.He.forEach(function(e){n.B.te.Ye("_"+i.ie+"_idx_"+e,r[e],function(){})}),i.Ge.forEach(function(e){n.B.te.ae[n.Ae].Ue[e].removeWord(r[e])})),n.B.te.Ye(i.ie,e,function(){t()}))};if(n.B.te.ce)return void _("upsert"===s?a:{});n.B.te.de(i.ie,e,function(t){var c={},u=t[0]||{},f=!1;switch(s){case"upsert":c=u?r.t(u):{},Object.keys(a).forEach(function(e){c[e]=a[e]});var l=n.B.te.ae[n.Ae];l.Ze.forEach(function(e,t){var n=l.et[t];!c[e]&&n&&(c[e]=n)});break;case"delete":c=u?r.t(u):{},a&&a.length?a.forEach(function(e){c[e]=null}):(f=!0,c={})}var d=function(){0!==i.ie.indexOf("_")&&n.B.te.tt&&i.Je.length&&n.B.te.de("_"+i.ie+"_hist__meta",e,function(t){t.length&&t[0]||(t[0]={},t[0][o.G(2)]=0,t[0][o.G(3)]=[],t[0].id=e),t[0][o.G(3)].unshift(p),n.B.te.he("_"+i.ie+"_hist__meta",e,t[0])}),_(c)},p=0;!f&&0!==i.ie.indexOf("_")&&n.B.te.tt?n.B.te.he("_"+i.ie+"_hist__data",null,c,function(e){p=parseInt(e),d()}):d()})},e.prototype.nt=function(e,t,n){var i=this,a=this,s=0,_=0;if(a.B.te.ce)return void n([],"trans",[]);if(e.length>0){var c=function(){if(a.B.te.tt)a.B.te.ce||0!==a.B.te.le||a.B.te.fe++,a.B.te.ye("w","historyLength",a.B.te.fe),a.B.te.ye("w","historyPoint",a.B.te.le),a.B.te.he("_historyPoints",null,{historyPoint:a.B.te.fe-a.B.te.le,tableID:a.Ae,rowKeys:e.map(function(e){return parseInt(e)}),type:t},function(r){var o=a.B.te.ae[i.Ae];a.B.oe(a.Ae,[],""),a.B.te.de(o.ie,function(t){return t&&-1!==e.indexOf(t[o.Je])},function(r){n([{msg:e.length+" row(s) "+t}],t,r)})});else{var r=a.B.te.ae[a.Ae];a.B.oe(a.Ae,[],""),a.B.te.de(r.ie,function(t){return t&&-1!==e.indexOf(t[r.Je])},function(r){n([{msg:e.length+" row(s) "+t}],t,r)})}};a.B.te.tt&&a.B.te.le>0?a.B.te.de("_historyPoints",function(e){return e.historyPoint>a.B.te.fe-a.B.te.le},function(e){_=0;var t=function(){if(!(_<e.length))return a.B.te.fe-=a.B.te.le,a.B.te.le=0,void c();var n=a.B.te.ae[e[_].tableID].ie;s=0;var i=function(){s<e[_].rowKeys.length?a.B.te.de("_"+n+"_hist__meta",e[_].rowKeys[s],function(t){t[0]=r.t(t[0]),t[0][o.G(2)]=0;var c=t[0][o.G(3)].shift();a.B.te.he("_"+n+"_hist__meta",e[_].rowKeys[s],t[0],function(){c?a.B.te.Ye("_"+n+"_hist__data",c,function(){s++,i()}):(s++,i())})}):(_++,t())};a.B.te.Ye("_historyPoints",e[_].id,function(){i()})};t()}):c()}else n([{msg:"0 rows "+t}],t,[])},e.prototype.he=function(e,t){var n,i=this,a="",s=[],_=i.Re.args||{},c=i.B.te.ae[i.Ae],u=c.Je;if(i.Fe("where")){a="modified",s=e.map(function(e){return e[c.Je]}),n=0;var f=function(){n<e.length?i.Xe(e[n][u],function(){n++,f()}):i.nt(s,a,t)};f()}else{if(a="inserted",_[u])"int"===c.pe&&(c.rt=Math.max(_[u]+1,c.rt));else switch(c.pe){case"int":_[u]=c.rt++;break;case"uuid":_[u]=r.NanoSQLInstance.uuid();break;case"timeId":_[u]=r.NanoSQLInstance.timeid();break;case"timeIdms":_[u]=r.NanoSQLInstance.timeid(!0)}var l=_[u]?_[u]:c.$e.length;if(s=[l],-1===c.$e.indexOf(l)){var d=i.B.te.ae[i.Ae].ie;if(0!==d.indexOf("_")&&i.B.te.tt){var p="_"+d+"_hist__meta",h={};h[o.G(2)]=0,h[o.G(3)]=[0],i.B.te.he(p,l,h)}c.$e.push(l)}i.Xe(l,function(){i.nt(s,a,t)})}},e.prototype.ot=function(){return this.it?this.it:this.Ae},e.prototype.Ve=function(e,n){var o=this;if(o.B.Z[o.Ae][o.Qe])return void n(o.B.Z[o.Ae][o.Qe],"none",[]);var i,a,s=["join","groupby","having","orderby","offset","limit"],_={},c=function(e,t,n){return Object.keys(n).reduce(function(r,o){return r||(e[o]===t[o]?0:(e[o]>t[o]?1:-1)*("desc"===n[o]?-1:1))},0)},u=function(e,n,a){if(i=o.Fe(s[n]),2===n){var u=[];if(f.length){var l=Object.keys(t.b).map(function(e){return e+"("}),d=[];u=f.filter(function(e){return(l.reduce(function(t,n){return(e.indexOf(n)<0?0:1)+t},0)||0)>0||(d.push(e),!1)}).map(function(e){var n=e.match(/(.*)\((.*)\)/),r=n[1].trim(),o=(e.match(/\sAS\s(.*)/)||[]).pop()||r,i=n[2].split(",").map(function(e){return e.trim()});return"simple"===t.b[r].type&&o===r&&(o=i[0]),d.push(o),{name:r,args:i,as:o.trim(),type:t.b[r].type}});var p=[];if(u.length){var h,y=function(e){return u.sort(function(e,t){return e.type>t.type?1:-1}).reduce(function(n,r){var o=n.length-1;if("aggregate"===r.type){var i=e.slice();o=i.length-1,i=[i.reduce(function(e,n,i){return t.b[r.name].call(n,r.args,[i,o],e)},{})],h&&(i[0][h]=n[0][h]),n=i,h=r.name}else n=n.map(function(e,n){return t.b[r.name].call(e,r.args,[n,o])});return r.name!==r.as?d.push(r.name+" AS "+r.as):d.push(r.name),n},e.slice())},b=Object.keys(_);p=b.length?b.map(function(e){return h=null,y(_[e])}).reduce(function(e,t){return e=e.concat(t)},[]):y(e)}else p=e;var g=d.map(function(e){return e.match(/(.*)\sAS\s(.*)/)||e}).filter(function(e){return e})||[];g.length&&(p=p.map(function(e){e=r.t(e);var t={};return g.forEach(function(n){"string"==typeof n?t[n]=e[n]:t[n[2]]=e[n[1]]}),t})),e=p}}if(!i)return a(e);switch(n){case 0:var v=void 0;"cross"!==i.args.type&&(v={at:i.args.where[0].split(".").pop(),st:i.args.where[1],_t:i.args.where[2].split(".").pop()});var m=o.Ae,x=r.NanoSQLInstance.V(i.args.table),k=o.Fe("where"),w=o.Fe("range");o.ct(i.args.type,m,x,v,function(e){k?a(e.filter(function(e){return o.Ke(e,k.args)})):w?o.ze(w.args[0],w.args[1],a):a(e)});break;case 1:var O=i.args,S={};O?(_=e.reduce(function(e,t){var n=Object.keys(O).reduce(function(e,n){return e+"."+String(t[n])},"").slice(1);return(e[n]=e[n]||[]).push(t),S[n]=Object.keys(O).reduce(function(e,n){return e[n]=t[n],e},{}),e},{}),a(Object.keys(_).sort(function(e,t){return c(S[e],S[t],O)}).reduce(function(e,t){return e.concat(_[t])},[]))):a(e);break;case 2:a(e.filter(function(e){return o.Ke(e,o.Fe("having").args)}));break;case 3:a(e.sort(function(e,t){return c(e,t,i.args)}));break;case 4:a(e.filter(function(e,t){return!i||t>=i.args}));break;case 5:a(e.filter(function(e,t){return!i||t<i.args}))}};a=-1;var f=o.Re.args||[],l=function(e){a<s.length?(a++,u(e,a,function(e){l(e)})):(e=e.filter(function(e){return e}),o.Fe("join")||(o.B.Z[o.Ae][o.Qe]=e),n(e,"none",[]))};l(e)},e.prototype.Be=function(e,t){var n,r="deleted",o=this,i=o.Re.args||[],a=o.B.te.ae[o.Ae].Je;n=0;var s=function(){n<e.length?o.Xe(e[n][a],function(){n++,s()}):(i.length&&(r="modified"),o.nt(e.map(function(e){return e[a]}),r,t))};s()},e.prototype.Ke=function(e,t){var n=this,r=["AND","OR"];if("string"!=typeof t[0]){var o;return t.reduce(function(t,i,a){if(-1!==r.indexOf(i))return o=i,t;var s=0===n.ut(i[2],i[1],e[i[0]]);return 0===a?s:"AND"===o?t&&s:t||s},!0)}return 0===n.ut(t[2],t[1],e[t[0]])},e.prototype.ct=function(e,t,n,r,o){var i="outer",a=this,s=a.B.te.ae[t],_=a.B.te.ae[n],c=function(e,t){return[s,_].reduce(function(n,r,o){return r.Ze.forEach(function(i){n[r.ie+"."+i]=((0===o?e:t)||{})[i]}),n},{})},u=[],f=[];a.B.te.de(s.ie,"all",function(t){a.B.te.de(_.ie,"all",function(n){t.forEach(function(t){var o=n.filter(function(e){if(!r)return!0;var n=c(t,e),o=a.Ke(n,[r.at,r.st,r._t]);return o&&f.push(e[_.Je]),o});o.length?u=u.concat(o):["left",i].indexOf(e)>=0&&u.push(c(t,null))}),f=f.sort().filter(function(e,t,n){return!t||e!==n[t-1]}),["right",i].indexOf(e)>=0&&n.filter(function(e){return-1===f.indexOf(e[_.Je])}).forEach(function(e){u.push(c(null,e))}),o(u)})})},e.prototype.ut=function(e,t,n){var r=function(e){return"LIKE"!==t?e:"string"==typeof e?String(e).toLowerCase():Array.isArray(e)?e.map(function(e){return r(e)}):e},o=r(n),i=r(e);switch(t){case"=":return o===i?0:1;case">":return o>i?0:1;case"<":return o<i?0:1;case"<=":return o<=i?0:1;case">=":return o>=i?0:1;case"IN":return i.indexOf(o)<0?1:0;case"NOT IN":return i.indexOf(o)<0?0:1;case"REGEX":case"LIKE":return o.search(i)<0?1:0;case"BETWEEN":return i[0]<=o&&i[1]>=o?0:1;case"HAVE":return(o||[]).indexOf(i)<0?1:0;default:return 0}},e}();t.X=a},function(e,t){!function(e,t){"use strict";function n(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),n=0;n<t.length;n++)t[n]=arguments[n+1];var r={callback:e,args:t};return _[s]=r,a(s),s++}function r(e){delete _[e]}function o(e){var n=e.callback,r=e.args;switch(r.length){case 0:n();break;case 1:n(r[0]);break;case 2:n(r[0],r[1]);break;case 3:n(r[0],r[1],r[2]);break;default:n.apply(t,r)}}function i(e){if(c)setTimeout(i,0,e);else{var t=_[e];if(t){c=!0;try{o(t)}finally{r(e),c=!1}}}}if(!e.setImmediate){var a,s=1,_={},c=!1,u=e.document,f=Object.getPrototypeOf&&Object.getPrototypeOf(e);f=f&&f.setTimeout?f:e,"[object process]"==={}.toString.call(e.process)?function(){a=function(e){process.nextTick(function(){i(e)})}}():function(){if(e.postMessage&&!e.importScripts){var t=!0,n=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=n,t}}()?function(){var t="setImmediate$"+Math.random()+"$",n=function(n){n.source===e&&"string"==typeof n.data&&0===n.data.indexOf(t)&&i(+n.data.slice(t.length))};e.addEventListener?e.addEventListener("message",n,!1):e.attachEvent("onmessage",n),a=function(n){e.postMessage(t+n,"*")}}():e.MessageChannel?function(){var e=new MessageChannel;e.port1.onmessage=function(e){i(e.data)},a=function(t){e.port2.postMessage(t)}}():u&&"onreadystatechange"in u.createElement("script")?function(){var e=u.documentElement;a=function(t){var n=u.createElement("script");n.onreadystatechange=function(){i(t),n.onreadystatechange=null,e.removeChild(n),n=null},e.appendChild(n)}}():function(){a=function(e){setTimeout(i,0,e)}}(),f.setImmediate=n,f.clearImmediate=r}}("undefined"==typeof self?"undefined"==typeof global?this:global:self)},function(e,t,n){"use strict";function r(e,t){return{prefixFound:t.toLowerCase().split("").every(function(t,n){return!!e[t]&&(e=e[t])}),prefixNode:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=r;var o=n(2);!function(e){e&&e.e}(o),e.exports=t.default},function(e,t,n){"use strict";function r(e){if(!Array.isArray(e))throw"Expected parameter Array, received "+(void 0===e?"undefined":o(e));return e.reduce(function(e,t){return t.toLowerCase().split("").reduce(a.default,e),e},{})}Object.defineProperty(t,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};t.default=r;var i=n(5),a=function(e){return e&&e.e?e:{default:e}}(i);e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.e?e:{default:e}}function o(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}Object.defineProperty(t,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};t.default=function(e){if(!Array.isArray(e))throw"Expected parameter Array, received "+(void 0===e?"undefined":i(e));var t=(0,s.default)([].concat(o(e)));return{dump:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return h.default.stringify(t,e)},addWord:function(e){if("string"!=typeof e||""===e)throw"Expected parameter string, received "+(void 0===e?"undefined":i(e));var n=function(){return c.default.apply(void 0,arguments)};return e.toLowerCase().split("").reduce(n,t),this},removeWord:function(e){if("string"!=typeof e||""===e)throw"Expected parameter string, received "+(void 0===e?"undefined":i(e));var n=(0,f.default)(t,e),r=n.prefixFound,o=n.prefixNode;return r&&delete o[b.default.END_WORD],this},isPrefix:function(e){if("string"!=typeof e||""===e)throw"Expected string prefix, received "+(void 0===e?"undefined":i(e));return(0,f.default)(t,e).prefixFound},getPrefix:function(e){if("string"!=typeof e||""===e)throw"Expected string prefix, received "+(void 0===e?"undefined":i(e));if(!this.isPrefix(e))return[];var n=(0,f.default)(t,e),r=n.prefixNode;return(0,d.default)(r,e)},countPrefix:function(e){return this.getPrefix(e).length},getWords:function(){return(0,d.default)(t,"")},hasWord:function(e){if("string"!=typeof e)throw"Expected string word, received "+(void 0===e?"undefined":i(e));var n=(0,f.default)(t,e),r=n.prefixFound,o=n.prefixNode;return!!r&&1===o[b.default.END_WORD]},getAnagrams:function(e){if("string"!=typeof e)throw"Anagrams expected string letters, received "+(void 0===e?"undefined":i(e));if(e.length<m)throw"getAnagrams expects at least "+m+" letters";return(0,v.default)(e,t,{type:"anagram"})},getSubAnagrams:function(e){if("string"!=typeof e)throw"Expected string letters, received "+(void 0===e?"undefined":i(e));if(e.length<m)throw"getSubAnagrams expects at least "+m+" letters";return(0,v.default)(e,t,{type:"sub-anagram"})}}};var a=n(9),s=r(a),_=n(5),c=r(_),u=n(8),f=r(u),l=n(12),d=r(l),p=n(2),h=r(p),y=n(1),b=r(y),g=n(11),v=r(g),m=b.default.PERMS_MIN_LEN;e.exports=t.default},function(e,t,n){"use strict";function r(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{type:"anagram"};if("string"!=typeof e)throw"Permutations expects string letters, received "+(void 0===e?"undefined":o(e));var r=[];return function e(t,o){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",s=0===t.length,_=-1!==r.indexOf(i),c=1===o[a.default.END_WORD];s&&c&&!_&&r.push(i);for(var u=0,f=t.length;u<f;u++){var l=t[u];"sub-anagram"===n.type&&c&&-1===r.indexOf(i)&&r.push(i),o[l]&&e(t.substring(0,u)+t.substring(u+1,f),o[l],i+l,r)}return r.sort()}(e,t)}Object.defineProperty(t,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};t.default=r;var i=n(1),a=function(e){return e&&e.e?e:{default:e}}(i);e.exports=t.default},function(e,t,n){"use strict";function r(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],o=t;for(var a in e)a===i.default.END_WORD&&(n.push(o),o=""),r(e[a],t+a,n);return n.sort()}Object.defineProperty(t,"__esModule",{value:!0}),t.default=r;var o=n(1),i=function(e){return e&&e.e?e:{default:e}}(o);e.exports=t.default},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),o=n(3),i=n(6),a=n(10),s=function(){function e(e,t){this.ft=t,this.init(e,t)}return e.prototype.init=function(e,t){var n=this,a=this;a._={},a.ae={},a.lt={},a.le=0,a.fe=0,a.be=[0,0],a.ce=!1,a.tt=!0,a.dt=!0,a.pt=!1,a.ht={},a.yt=0,a.S=e,t.O.length&&(a.pt=void 0!==t.O[0].persistent&&t.O[0].persistent,a.tt=void 0===t.O[0].history||t.O[0].history,a.dt=void 0===t.O[0].memory||t.O[0].memory,t.O[0].size,a.yt={IDB:1,LS:2,LVL:4}[t.O[0].mode]||0,t.O[0].rebuildIndexes&&(a.bt=!0),t.O[0].id&&(a.S.ee=String(t.O[0].id)));var s=!1,_=0,c=!0;Object.keys(t._).forEach(function(e){var n={key:"x",type:"x"},o=[];t._[e].forEach(function(e){e.props&&-1!==e.props.indexOf("pk")&&(n=r.t(e)),!e.props||-1===e.props.indexOf("idx")&&-1===e.props.indexOf("trie")||o.push(e)}),"x"!==n.key&&"x"!==n.type&&(t._["_"+e+"_hist__data"]=r.t(t._[e]).map(function(e){return delete e.props,e}),t._["_"+e+"_hist__meta"]=[n,{key:"_pointer",type:"int"},{key:"_historyDataRowIDs",type:"array"}]),o.length&&"x"!==n.key&&"x"!==n.type&&o.forEach(function(r){t._["_"+e+"_idx_"+r.key]=[{key:"id",type:r.type,props:["pk"]},{key:"rowPK",type:n.type}]})}),t._[o.G(0)]=[{key:"key",type:"string",props:["pk"]},{key:"value",type:"blob"}],t._[o.G(1)]=[{key:"id",type:"int",props:["ai","pk"]},{key:"tableID",type:"int"},{key:"historyPoint",type:"int"},{key:"rowKeys",type:"array"},{key:"type",type:"string"}];var u,f,l=Object.keys(t._);Object.keys(t._).forEach(function(e){a.gt(e,t._[e])}),Object.keys(t.b||[]).forEach(function(e){i.b[e]=t.b[e]});var d=function(){var e={},n=0;if(Object.keys(t._).forEach(function(t){if(0!==t.indexOf("_")){var o=r.NanoSQLInstance.V(t);a.ae[o].Ge.length&&(e[t]=a.ae[o].Ge,n++)}}),0===n)t.I();else{var o=Object.keys(e),i=0,s=function(){if(i<o.length){var n=r.NanoSQLInstance.V(o[i]);a.de(o[i],"all",function(t){t.forEach(function(t,r){e[o[i]].forEach(function(e){t[e]&&a.ae[n].Ue[e].addWord(String(t[e]).toLocaleLowerCase())})}),i++,s()})}else t.I()};s()}},p=function(){if(a.bt){var e={};Object.keys(t._).forEach(function(t){if(0!==t.indexOf("_")){var n=r.NanoSQLInstance.V(t);a.ae[n].He.length&&(e[t]=a.ae[n].He)}});var o=Object.keys(e),i=0,s=function(){if(i<o.length){var t=r.NanoSQLInstance.V(o[i]),_=0;n.de(o[i],"all",function(n){var r=a.ae[t].Je,c=function(){if(_<n.length){var t=0,u=function(){if(t<e[o[i]].length){var s=e[o[i]][t],f="_"+o[i]+"_idx_"+s;a.he(f,String(n[_][s]).toLocaleLowerCase(),{id:n[_][s],rowPK:n[_][r]},function(){t++,u()})}else _++,c()};u()}else i++,s()};c()})}else d()};s()}else d()},h=function(){var e=Object.keys(t._),n=0;if(a.yt=f,u&&a.de(o.G(0),"all",function(e){e.forEach(function(e){a.ye("w",e.key,e.value),"historyPoint"===e.key&&(a.le=e.value||0),"historyLength"===e.key&&(a.fe=e.value||0)})}),c){var r=function(){n<e.length?-1!==e[n].indexOf("_hist__data")?a.he(e[n],0,null,function(){n++,r()}):(n++,r()):(a.tt=u,p())};r()}else a.tt=u,p()};if(f=a.yt,a.pt)if(0!==a.yt)switch(a.yt){case 1:"undefined"==typeof indexedDB&&(a.yt=0);break;case 2:"undefined"==typeof localStorage&&(a.yt=0);break;case 4:"undefined"!=typeof window&&(a.yt=0)}else"undefined"!=typeof window&&("undefined"!=typeof localStorage&&(a.yt=2),"undefined"!=typeof indexedDB&&(a.yt=1)),"undefined"!=typeof global&&void 0!==global.vt&&void 0!==global.mt&&(a.yt=4);else a.yt=0,h();u=a.tt,f=a.yt,a.yt=0,a.tt=!1;var y=function(e,t){var n=function(){if(_<l.length){var o=r.NanoSQLInstance.V(l[_]);e(l[_],o,a.ae[o]),_++,n()}else t()};n()},b=function(e){c=!1;var t=0,n=function(){if(!(t<l.length))return void(e.cleanup?e.cleanup(function(){h()}):h());var o=r.NanoSQLInstance.V(l[t]);if(!u&&(-1!==l[t].indexOf("_hist__data")||-1!==l[t].indexOf("_hist__meta")))return t++,void n();a.dt?e.requestTable(l[t],function(e){-1!==l[t].indexOf("_hist__data")?(a.ae[o].$e.push("0"),a.ae[o].ge[0]=null,a.ae[o].rt++,a.S.S.loadJS(l[t],e).then(function(){t++,n()})):a.S.S.loadJS(l[t],e).then(function(){t++,n()})}):a.dt&&!e.forceIndex||e.requestIndex(l[t],function(e){a.S.te.ae[o].$e=e,a.S.te.ae[o].rt=e.reduce(function(e,t){return Math.max(e,parseInt(t)||0)},0),a.S.te.ae[o].rt++,t++,n()})};n()};switch(f){case 0:h();break;case 1:var g=indexedDB.open(a.S.ee,1);g.onupgradeneeded=function(e){s=!0;var t=e.target.result,n=e.target.transaction;a.xt=t,y(function(e,n,r){var o=r.Je?{keyPath:r.Je}:{};t.createObjectStore(e,o)},function(){n.oncomplete=function(){h()}})},g.onsuccess=function(e){if(a.xt=e.target.result,!s){var t=function(e,t){var n=[],r=a.xt.transaction(e,"readonly");r.objectStore(e).openCursor().onsuccess=function(e){var t=e.target.result;t&&(n.push(a.dt?t.value:t.key),t.continue())},r.oncomplete=function(){t(n)}};b({requestIndex:function(e,n){t(e,n)},requestTable:function(e,n){t(e,n)}})}};break;case 2:localStorage.getItem("dbID")!==a.S.ee?(localStorage.setItem("dbID",a.S.ee),y(function(e,t,n){localStorage.setItem(e,JSON.stringify([]))},function(){h()})):b({forceIndex:!0,requestIndex:function(e,t){t(JSON.parse(localStorage.getItem(e)||"[]"))},requestTable:function(e,t){var n=[];JSON.parse(localStorage.getItem(e)||"[]").forEach(function(t){n.push(JSON.parse(localStorage.getItem(e+"-"+t)||""))}),t(n)}})}},e.prototype.ue=function(){this.yt},e.prototype.ve=function(e,t){var n=this,i=Object.keys(n.ae).map(function(e){return n.ae[e].ie}),a=0,s=function(){var e=0,a=function(){if(e<i.length)if(-1!==i[e].indexOf("_hist__meta")){var s=String(i[e]).slice(1).replace("_hist__meta",""),_=r.NanoSQLInstance.V(s),c=n.ae[_].Je;n.de(s,"all",function(t){t.forEach(function(t,r){var a={};a[o.G(2)]=0,a[o.G(3)]=[r+1],n.he(i[e],t[c],a),n.he("_"+s+"_hist__data",r+1,t)}),e++,a()})}else e++,a();else t()};a()},_=function(){if(a<i.length){var r=!1;"hist"!==e||"_historyPoints"!==i[a]&&-1===i[a].indexOf("_hist__meta")&&-1===i[a].indexOf("_hist__data")||(r=!0),"all"===e&&"_utility"!==i[a]&&(r=!0),r?n.Ye(i[a],"all",function(){-1!==i[a].indexOf("_hist__data")&&n.he(i[a],0,null),a++,_()}):(a++,_())}else"hist"===e?s():t()};_()},e.prototype.Ye=function(e,t,n){var o=this,i=r.NanoSQLInstance.V(e),a=[];if("all"===t?(a=o.ae[i].$e.slice(),o.ae[i].$e=[]):(a.push(t),o.ae[i].$e.splice(o.ae[i].$e.indexOf(t),1)),o.dt)if("all"===t)o.ae[i].ge={};else if(delete o.ae[i].ge[t],0===o.yt&&n)return n(!0);if(o.yt>0){var s=0,_=function(){if(s<a.length)switch(o.yt){case 1:o.xt.transaction(e,"readwrite").objectStore(e).delete(parseInt(a[s])),s++,_();break;case 2:localStorage.setItem(e,JSON.stringify(o.ae[i].$e)),localStorage.removeItem(e+"-"+String(a[s])),s++,_();break;default:s++,_()}else n&&n(!0)};_()}},e.prototype.he=function(e,t,n,o){var i=this,a=r.NanoSQLInstance.V(e);void 0!==t&&null!==t||(i._[a].forEach(function(e){e.props&&-1!==e.props.indexOf("pk")&&(t="uuid"===e.type?r.NanoSQLInstance.uuid():i.ae[a].rt++)}),t||(t=parseInt(i.ae[a].$e[i.ae[a].$e.length-1]||"0")+1)),"int"===i.ae[a].pe&&(t=parseInt(t));var s=i.ae[a].Je;switch(s&&s.length&&n&&!n[s]&&(n[s]=t),-1===i.ae[a].$e.indexOf(t)&&i.ae[a].$e.push(t),i.yt){case 0:if(i.ae[a].ge[t]=i.S.se(n,a),o)return o(t);break;case 1:var _=i.xt.transaction(e,"readwrite"),c=_.objectStore(e);s.length&&n?c.put(n):-1!==e.indexOf("_hist__data")?c.put(n,t):(n&&c.put(n),n||c.delete(t)),_.oncomplete=function(){o&&o(t)};break;case 2:localStorage.setItem(e+"-"+String(t),n?JSON.stringify(n):""),localStorage.setItem(e,JSON.stringify(i.ae[a].$e)),o&&o(t)}},e.prototype.kt=function(e,t,n){var r=this,o=0===e.indexOf("_")&&-1!==e.indexOf("_idx_"),i=o?e.slice(1,e.indexOf("_idx_")):"";if(o){var a=[],s=0,_=function(){s<t.length?r.de(i,t[s].rowPK,function(e){a=a.concat(e),s++,_()}):n(a)};_()}else n(t)},e.prototype.We=function(e,t,n,o){var i=this,a=this,s=r.NanoSQLInstance.V(e);if(0===a.yt||2===a.yt){var _=a.ae[s].$e.indexOf(n[0]),c=[],u=function(){var t=a.ae[s].$e[_];t<=n[1]?i.de(e,t,function(e){c=c.concat(e),_++,u()}):i.kt(e,c,o)};return void u()}var f=[];switch(a.yt){case 1:var l=a.xt.transaction(e,"readonly"),d=l.objectStore(e),p=d.openCursor(IDBKeyRange.bound(n[0],n[1]));l.oncomplete=function(){i.kt(e,f,o)},p.onsuccess=function(e){var t=e.target.result;t&&(f.push(t.value),t.continue())}}},e.prototype.de=function(e,t,n){var o=this,i=this,a=r.NanoSQLInstance.V(e);switch(i.yt){case 0:var s=i.ae[a].ge;if("all"===t||"function"==typeof t){var _=Object.keys(s).map(function(e){return s[e]});"all"===t?this.kt(e,_.filter(function(e){return e}),n):this.kt(e,_.filter(function(e){return t(e)}),n)}else this.kt(e,[s[t]].filter(function(e){return e}),n);break;case 1:var c=i.xt.transaction(e,"readonly"),u=c.objectStore(e);if("all"===t||"function"==typeof t){var f=u.openCursor(),l=[];c.oncomplete=function(){o.kt(e,l,n)},f.onsuccess=function(e){var n=e.target.result;n&&("all"!==t?t(n.value)&&l.push(n.value):l.push(n.value),n.continue())}}else{var d=u.get(t);d.onsuccess=function(t){o.kt(e,[d.result],n)}}break;case 2:if("all"===t||"function"==typeof t){var p=i.ae[a].$e.map(function(t){var n=localStorage.getItem(e+"-"+t);return n&&n.length?JSON.parse(n):null});"all"!==t?this.kt(e,p.filter(function(e){return t(e)}),n):this.kt(e,p,n)}else{var h=localStorage.getItem(e+"-"+t);this.kt(e,[h&&h.length?JSON.parse(h):null],n)}}},e.prototype.ye=function(e,t,n){var r=this;return"r"===e?r.ht[t]?r.ht[t].value:null:(r.he(o.G(0),t,{key:t,value:n}),r.ye[t]={key:t,value:n},n)},e.prototype.gt=function(e,t){var n=this,o=r.NanoSQLInstance.V(e);n._[o]=t,n.S.Z[o]={},n.ae[o]={Je:"",pe:"",Ze:[],et:[],He:[],Ge:[],Ue:{},ie:e,rt:1,$e:[],ge:{}};for(var i=n._[o].length;i--;){var s=n._[o][i];n.ae[o].Ze.unshift(s.key),n.ae[o].et[i]=s.default,s.props&&s.props.indexOf("pk")>=0&&(n.ae[o].Je=s.key,n.ae[o].pe=s.type),s.props&&(s.props.indexOf("idx")>=0||s.props.indexOf("trie")>=0)&&n.ae[o].He.push(s.key),s.props&&s.props.indexOf("trie")>=0&&(n.ae[o].Ge.push(s.key),n.ae[o].Ue[s.key]=a([]))}return e},e}();t.ne=s},function(e,t,n){e.exports=n(0)}])});