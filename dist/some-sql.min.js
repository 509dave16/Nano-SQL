!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var n=e();for(var r in n)("object"==typeof exports?exports:t)[r]=n[r]}}(this,function(){return function(t){function e(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return t[r].call(i.exports,i,i.exports,e),i.loaded=!0,i.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){"use strict";function r(t){return f.init(t)}var i=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},o=n(1),s=n(2),c=n(3),u=function(){function t(){var t=this;t._callbacks=new o.tsMap,t._callbacks.set("*",new o.tsMap),t._actions=new o.tsMap,t._views=new o.tsMap,t._models=new o.tsMap,t._query=[],t._events=["change","delete","upsert","drop","select"],t._events.forEach(function(e){t._callbacks.get("*").set(e,[])})}return t.prototype.init=function(t){return t&&(this._selectedTable=t),this},t.prototype.connect=function(t){var e=this;return e._backend=t||new c.someSQL_MemDB,new a(e,function(t,n){e._backend.connect(e._models,t,n)})},t.prototype.on=function(t,e){var n=this;return t.split(" ").forEach(function(t){if(n._events.indexOf(t)==-1)throw new Error(t+"ins't a valid attachable event!");n._callbacks.get(n._selectedTable).get(t).push(e)}),this},t.prototype.model=function(t){var e=this,n=e._selectedTable;return e._callbacks.set(n,new o.tsMap),e._events.forEach(function(t){e._callbacks.get("*").set(t,[])}),e._models.set(n,t),e._views.set(n,{}),e._actions.set(n,{}),this},t.prototype.views=function(t){return this._views.set(this._selectedTable,t),this},t.prototype.getView=function(t,e){var n=this,r=n._selectedTable,i=n._views.get(r)[t];return i[1].apply(n,[n._cleanArgs(i[0],e)])},t.prototype._cleanArgs=function(t,e){var n=this,r=(n._selectedTable,{});return t.forEach(function(t){var i=t.split(":");i.length>1?r[i[0]]=n._cast(i[1],e[i[0]]):r[i[0]]=e[i[0]]}),r},t.prototype._cast=function(t,e){switch(["string","int","float","array","map"].indexOf(t)){case 0:return String(e);case 1:return parseInt(e);case 2:return parseFloat(e);case 3:case 4:return JSON.parse(JSON.stringify(e));default:return""}},t.prototype.actions=function(t){return this._actions.set(this._selectedTable,t),this},t.prototype.doAction=function(t,e){var n=this,r=n._selectedTable,i=n._actions.get(r)[t];return i[1].apply(n,[n._cleanArgs(i[0],e)])},t.prototype.query=function(t,e){this._query=[];var n=t.toLowerCase();return["select","upsert","delete","drop"].indexOf(n)!=-1&&this._query.push(new o.tsMap([["type",n],["args",e]])),this},t.prototype.where=function(t){return this._addCmd("where",t),this},t.prototype.andWhere=function(t){return this._addCmd("andWhere",t),this},t.prototype.orWhere=function(t){return this._addCmd("orWhere",t),this},t.prototype.orderBy=function(t){return this._addCmd("orderby",t),this},t.prototype.limit=function(t){return this._addCmd("limit",t),this},t.prototype.offset=function(t){return this._addCmd("offset",t),this},t.prototype._addCmd=function(t,e){this._query.push(new o.tsMap([["type",t],["args",e]]))},t.prototype.exec=function(){var t=this,e=t._selectedTable;return t._triggerEvents=[],this._query.map(function(t){switch(t.get("type")){case"select":return[t.get("type")];case"delete":case"upsert":case"drop":return[t.get("type"),"change"];default:return[]}}).forEach(function(e){e.forEach(function(e){t._triggerEvents.push(e)})}),new a(this,function(n,r){t._backend.exec(e,t._query,function(r){t._triggerEvents.forEach(function(n){t._callbacks.get(e).get(n).concat(t._callbacks.get("*").get(n)).forEach(function(i){i.apply(t,[{type:n,table:e,query:t._query,time:(new Date).getTime(),result:r}])})}),n(r)},function(t){r(t)})})},t.prototype.custom=function(t,e){var n=this;return new a(n,function(r,i){n._backend.custom?n._backend.custom(t,e,r,i):r()})},t.prototype.loadJS=function(t){var e=this;return s.tsPromise.all(t.map(function(t){return e.init(e._selectedTable).query("upsert",t).exec()}))},t.prototype.loadCSV=function(t){var e=this,n=[];return new a(e,function(r,i){s.tsPromise.all(t.split("\n").map(function(t,r){return new a(e,function(i,o){if(0==r)n=t.split(","),i();else{var s={},c=t.match(/(".*?"|[^",\s]+)(?=\s*,|\s*$)/g).map(function(t){return t.replace(/^"(.+(?="$))"$/,"$1")});n.forEach(function(t,e){0!=c[e].indexOf("{")&&0!=c[e].indexOf("[")||(c[e]=JSON.parse(c[e].replace(/'/g,'"'))),s[t]=c[e]}),e.init(e._selectedTable).query("upsert",c).exec().then(function(){i()})}})})).then(function(){r()})})},t.prototype.toCSV=function(t){var e=this;return new a(e,function(n,r){e.exec().then(function(r){var i=e._query.filter(function(t){return"select"==t.get("type")}).map(function(t){return t.get("args")?t.get("args").map(function(t){return e._models[e._selectedTable].filter(function(e){return e.key==t})[0]}):e._models[e._selectedTable]})[0];t&&r.unshift(i.map(function(t){return t.key})),n(r.map(function(e,n){return t&&0==n?e:i.filter(function(t){return!!e[t.key]}).map(function(t){switch(t.type){case"map":return'"'+JSON.stringify(e[t.key]).replace(/"/g,"'")+'"';case"array":return'"'+JSON.stringify(e[t.key]).replace(/"/g,"'")+'"';default:return JSON.stringify(e[t.key])}}).join(",")}).join("\n"))})})},t.uuid=function(t){return t?t:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0,n="x"==t?e:3&e|8;return n.toString(16)})}()},t}();e.someSQL_Instance=u;var a=function(t){function e(e,n){var r=t.call(this,n)||this;return r.scope=e,r}return i(e,t),e.prototype.then=function(t,n){var r=this;return new e(r.scope,function(e,i){r.done(function(n){if("function"==typeof t)try{n=t.apply(r.scope,[n])}catch(t){return void i(t)}e(n)},function(t){if("function"==typeof n){try{t=n.apply(r.scope,[t])}catch(t){return void i(t)}e(t)}else i(t)})})},e}(s.tsPromise),f=new u;e.someSQL=r},function(t,e){t.exports=function(t){function e(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return t[r].call(i.exports,i,i.exports,e),i.loaded=!0,i.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e){"use strict";var n=function(){function t(t){var e=this;e._items=[],e._keys=[],e._values=[],e.length=0,t&&t.forEach(function(t,n){e.set(n[0],n[1])})}return t.prototype.fromJSON=function(t){for(var e in t)t.hasOwnProperty(e)&&this.set(e,t[e])},t.prototype.toJSON=function(){var t={},e=this;return e.keys().forEach(function(n){t[String(n)]=e.get(n)}),t},t.prototype.entries=function(){return[].slice.call(this._items)},t.prototype.keys=function(){return[].slice.call(this._keys)},t.prototype.values=function(){return[].slice.call(this._values)},t.prototype.has=function(t){return this._keys.indexOf(t)>-1},t.prototype.get=function(t){var e=this._keys.indexOf(t);return e>-1?this._values[e]:void 0},t.prototype.set=function(t,e){var n=this,r=this._keys.indexOf(t);r>-1?(n._items[r][1]=e,n._values[r]=e):(n._items.push([t,e]),n._keys.push(t),n._values.push(e)),n.length=n.size()},t.prototype.size=function(){return this._items.length},t.prototype.clear=function(){var t=this;t._keys.length=t._values.length=t._items.length=0,t.length=t.size()},t.prototype.delete=function(t){var e=this,n=e._keys.indexOf(t);return n>-1&&(e._keys.splice(n,1),e._values.splice(n,1),e._items.splice(n,1),e.length=e.size(),!0)},t.prototype.forEach=function(t){var e=this;e._keys.forEach(function(n){t(e.get(n),n)})},t.prototype.map=function(t){var e=this;return this._keys.map(function(n){return t(e.get(n),n)})},t.prototype.filter=function(t){var e=this;return e._keys.forEach(function(n){0==t(e.get(n),n)&&e.delete(n)}),this},t.prototype.clone=function(){return new t(JSON.parse(JSON.stringify(this._items)))},t}();e.tsMap=n}])},function(t,e){t.exports=function(t){function e(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return t[r].call(i.exports,i,i.exports,e),i.loaded=!0,i.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e){"use strict";var n=function(){function t(t){this._callbacks=[],this._failed=!1,this._resolved=!1,this._settled=!1,t(this._resolve.bind(this),this._reject.bind(this))}return t.resolve=function(e){return new t(function(t){t(e)})},t.reject=function(e){return new t(function(t,n){n(e)})},t.race=function(e){var n=!1;return new t(function(t,r){e.forEach(function(e){e.then(function(e){n||(t(e),n=!0)}).catch(function(t){r(t),n=!0})})})},t.all=function(e){return new t(function(t,n){var r=e.length,i=[],o=!1;e.forEach(function(e,s){e.then(function(e){o||(r--,i[s]=e,0==r&&t(i))}).catch(function(t){n(t),o=!0})})})},t.prototype.done=function(t,e){this._settled?setTimeout(this._release.bind(this,t,e),0):this._callbacks.push({onSuccess:t,onFail:e})},t.prototype.then=function(e,n){var r=this;return new t(function(t,i){r.done(function(n){if("function"==typeof e)try{n=e(n)}catch(t){return void i(t)}t(n)},function(e){if("function"==typeof n){try{e=n(e)}catch(t){return void i(t)}t(e)}else i(e)})})},t.prototype.catch=function(t){return this.then(null,t)},t.prototype._release=function(t,e){if(this._failed){if("function"!=typeof e)throw this._value;e(this._value)}else"function"==typeof t&&t(this._value)},t.prototype._resolve=function(e){this._resolved||(this._resolved=!0,e instanceof t?e.done(this._settle.bind(this),function(t){this._failed=!0,this._settle(t)}.bind(this)):this._settle(e))},t.prototype._reject=function(t){this._resolved||(this._resolved=!0,this._failed=!0,this._settle(t))},t.prototype._settle=function(t){this._settled=!0,this._value=t,setTimeout(this._callbacks.forEach.bind(this._callbacks,function(t){this._release(t.onSuccess,t.onFail)},this),0)},t}();e.tsPromise=n}])},function(t,e,n){"use strict";var r=n(4),i=n(2),o=n(1),s=function(){function t(){var t=this;t._tables=new o.tsMap,t._tIndex=new o.tsMap,t._models=new o.tsMap,t._tCacheI=new o.tsMap,t._immu=new o.tsMap,t._i=new o.tsMap}return t.prototype.connect=function(t,e){for(var n in t)this._newModel(n,t.get(n));e()},t.prototype._newModel=function(t,e){this._models.set(t,e),this._tables.set(t,[]),this._tIndex.set(t,[]),this._i.set(t,1)},t.prototype.exec=function(t,e,n){var r=this;r._sT=t,r._mod=[],r._act=null,r._cacheKey=r._hash(JSON.stringify(e)),i.tsPromise.all(e.map(function(t){return new i.tsPromise(function(e,n){r._query(t,e)})})).then(function(){r._exec(n)})},t.prototype._hash=function(t){for(var e=5381,n=0;n<t.length;n++){var r=t.charCodeAt(n);e=(e<<5)+e+r}return String(e)},t.prototype._query=function(t,e){["upsert","select","delete","drop"].indexOf(t.get("type"))!=-1&&(this._act=t),["where","orderby","limit","offset","andWhere","orWhere"].indexOf(t.get("type"))!=-1&&this._mod.push(t),e()},t.prototype._exec=function(t){var e=this;switch(e._act.get("type")){case"upsert":var n,i=e._mod.filter(function(t){return["where","andWhere","orWhere"].indexOf(t.get("type"))!=-1});if(i.length){n=[];var o=e._where(e._tIndex.get(e._sT)),s=e._tables.get(e._sT);o.forEach(function(t,r){for(var i in e._act.get("args"))s[t][i]=e._act.get("args")[i],n.push(JSON.parse(JSON.stringify(e._act.get("args")[i])));e._tCacheI.forEach(function(t,n){t&&t.indexOf(r)!=-1&&(e._tCacheI.delete(n),e._immu.delete(n))})})}else{var c="";e._models.get(e._sT).forEach(function(t){"uuid"!=t.type||e._act.get("args")[t.key]||(e._act.get("args")[t.key]=r.someSQL_Instance.uuid()),t.props&&t.props.indexOf("pk")!=-1&&(c=t.key,t.props.indexOf("ai")==-1||e._act.get("args")[t.key]||(e._act.get("args")[t.key]=e._i.get(e._sT),e._i.set(e._sT,e._i.get(e._sT)+1)))});var u=e._act.get("args")[c];e._tIndex.get(e._sT).indexOf(u)==-1?e._tIndex.get(e._sT).push(u):e._tCacheI.forEach(function(t,n){t&&t.indexOf(u)!=-1&&(e._tCacheI.delete(n),e._immu.delete(n))}),e._tables.get(e._sT)[u]=e._act.get("args"),n=JSON.parse(JSON.stringify(e._act.get("args")))}t(n);break;case"select":if(!e._immu.get(e._cacheKey)){var a=e._tables.get(e._sT);e._tCacheI.set(e._cacheKey,[]),e._immu.set(e._cacheKey,JSON.parse(JSON.stringify(e._where(e._tIndex.get(e._sT).sort(function(t,n){return e._mod.filter(function(t){return"orderby"==t.type}).map(function(e){for(var r in e.get("args")){if(a[t][r]==a[n][r])return 0;var i=a[t][r]>a[n][r]?1:-1;return"asc"==e.get("args")[r]?i:-i}}).reduce(function(t,e){return t+e},0)||0}).filter(function(t,n){var r=0;return!e._mod.filter(function(t){return["limit","offset"].indexOf(t.type)!=-1}).sort(function(t,e){return t.type<e.type?1:-1}).map(function(t,e){switch(t.type){case"offset":return r=t.get("args"),n>=t.get("args")?0:1;case"limit":return n<r+t.get("args")?0:1}}).reduce(function(t,e){return t+e},0)}).map(function(t,n){if(e._tCacheI.get(e._cacheKey).push(n),e._act.get("args")&&e._act.get("args").length){var r=JSON.parse(JSON.stringify(a[t]));return e._models.get(e._sT).forEach(function(t){e._act.get("args").indexOf(t.key)==-1&&delete r[t.key]}),r}return a[t]})))))}t(e._immu.get(e._cacheKey));break;case"delete":var f=e._where(e._tIndex.get(e._sT)),p=e._tables.get(e._sT);f.forEach(function(t,n){delete p[t],e._tIndex.get(e._sT).splice(e._tIndex.get(e._sT).indexOf(t),1),e._tCacheI.forEach(function(n,r){n&&n.indexOf(t)!=-1&&(e._tCacheI.delete(r),e._immu.delete(r))})}),t(f.length+" row(s) deleted");break;case"drop":e._tables.set(e._sT,[]),e._tIndex.set(e._sT,[]),e._i.set(e._sT,1),t("Success")}},t.prototype._where=function(t){var e=this,n=e._tables.get(e._sT);return t.filter(function(t,r){var i=[];return e._mod.filter(function(t){return"andWhere"==t.get("type")}).forEach(function(t){t.get("args").forEach(function(t){i.push({type:"where",args:t})})}),0==e._mod.filter(function(t){return"where"==t.type}).concat(i).map(function(r){return e._models.get(e._sT).map(function(i){return i.key==r.get("args")[0]?e._compare(r.get("args")[2],r.get("args")[1],n[t][i.key]):0}).reduce(function(t,e){return t+e},0)}).reduce(function(t,e){return t+e},0)}).filter(function(t){var r=[];return e._mod.map(function(t){"orWhere"==t.type&&t.get("args").forEach(function(t){r.push(t)})}),0==r.length||e._models.get(e._sT).map(function(i){return r.filter(function(r){return 1!=e._compare(r[2],r[1],n[t][i.key])}).length}).filter(function(t){return t>0}).length>0})},t.prototype._compare=function(t,e,n){switch(e){case"=":return n==t?0:1;case">":return n>t?0:1;case"<":return n<t?0:1;case"<=":return n<=t?0:1;case">=":return n>=t?0:1;case"IN":return t.indexOf(n)==-1?1:0;case"NOT IN":return t.indexOf(n)==-1?0:1;case"LIKE":return n.search(t)==-1?1:0;default:return 0}},t}();e.someSQL_MemDB=s},function(t,e){t.exports=function(t){function e(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return t[r].call(i.exports,i,i.exports,e),i.loaded=!0,i.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){"use strict";function r(t){return a.init(t)}var i=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},o=n(1),s=n(2),c=function(){function t(){var t=this;t._callbacks={"*":{}},t._actions={},t._views={},t._models={},t._query=[],t._events=["change","delete","upsert","drop","select"],t._events.forEach(function(e){t._callbacks["*"][e]=[]})}return t.prototype.init=function(t){return t&&(this._selectedTable=t),this},t.prototype.connect=function(t){var e=this;return e._backend=t||new s.someSQL_MemDB,new u(e,function(t,n){e._backend.connect(e._models,t,n)})},t.prototype.on=function(t,e){var n=this;return t.split(" ").forEach(function(t){if(n._events.indexOf(t)==-1)throw new Error(t+"ins't a valid attachable event!");n._callbacks[n._selectedTable][t].push(e)}),this},t.prototype.model=function(t){var e=this,n=e._selectedTable;return e._callbacks[n]={},e._events.forEach(function(t){e._callbacks[n][t]=[]}),e._models[n]=t,e._views[n]={},e._actions[n]={},this},t.prototype.views=function(t){return this._views[this._selectedTable]=t,this},t.prototype.getView=function(t,e){var n=this,r=n._selectedTable,i=n._views[r][t];return i[1](n.init(r),n._cleanArgs(i,e))},t.prototype._cleanArgs=function(t,e){var n=this,r=(n._selectedTable,{}),i=t;return i[0].forEach(function(t){var i=t.split(":");i.length>1?r[i[0]]=n._cast(i[1],e[i[0]]):r[i[0]]=e[i[0]]}),r},t.prototype._cast=function(t,e){switch(["string","int","float","array","map"].indexOf(t)){case 0:return String(e);case 1:return parseInt(e);case 2:return parseFloat(e);case 3:case 4:return JSON.parse(JSON.stringify(e));default:return e}},t.prototype.actions=function(t){return this._actions[this._selectedTable]=t,this},t.prototype.doAction=function(t,e){var n=this,r=n._selectedTable,i=n._actions[r][t];return i[1](n.init(r),n._cleanArgs(i,e))},t.prototype.query=function(t,e){this._query=[];var n=t.toLowerCase();return["select","upsert","delete","drop"].indexOf(n)!=-1&&this._query.push({type:n,args:e}),this},t.prototype.where=function(t){return this._query.push({type:"where",args:t}),this},t.prototype.andWhere=function(t){return this._query.push({type:"andWhere",args:t}),this},t.prototype.orWhere=function(t){return this._query.push({type:"orWhere",args:t}),this},t.prototype.orderBy=function(t){return this._query.push({type:"orderby",args:t}),this},t.prototype.limit=function(t){return this._query.push({type:"limit",args:t}),this},t.prototype.offset=function(t){return this._query.push({type:"offset",args:t}),this},t.prototype.exec=function(){var t=this,e=t._selectedTable;return t._triggerEvents=[],this._query.map(function(t){switch(t.type){case"select":return[t.type];case"delete":case"upsert":case"drop":return[t.type,"change"];default:return[]}}).forEach(function(e){e.forEach(function(e){t._triggerEvents.push(e)})}),new u(this,function(n,r){t._backend.exec(e,t._query,function(r){t._triggerEvents.forEach(function(n){t._callbacks[e][n].concat(t._callbacks["*"][n]).forEach(function(i){i({type:n,table:e,query:t._query,time:(new Date).getTime(),result:r})})}),n(r)})})},t.prototype.custom=function(t,e){var n=this;return new u(n,function(r,i){n._backend.custom?n._backend.custom(t,e,r):r()})},t.prototype.loadJS=function(t){var e=this;return o.tsPromise.all(t.map(function(t){return e.init(e._selectedTable).query("upsert",t).exec()}))},t.prototype.loadCSV=function(t){var e=this,n=[];return new u(e,function(r,i){o.tsPromise.all(t.split("\n").map(function(t,r){return new u(e,function(i,o){if(0==r)n=t.split(","),i();else{var s={},c=t.match(/(".*?"|[^",\s]+)(?=\s*,|\s*$)/g).map(function(t){return t.replace(/^"(.+(?="$))"$/,"$1")});n.forEach(function(t,e){0!=c[e].indexOf("{")&&0!=c[e].indexOf("[")||(c[e]=JSON.parse(c[e].replace(/'/g,'"'))),s[t]=c[e]}),e.init(e._selectedTable).query("upsert",c).exec().then(function(){i()})}})})).then(function(){r()})})},t.prototype.toCSV=function(t){var e=this;return new u(e,function(n,r){e.exec().then(function(r){var i=e._query.filter(function(t){return"select"==t.type}).map(function(t){return t.args?t.args.map(function(t){return e._models[e._selectedTable].filter(function(e){return e.key==t})[0]}):e._models[e._selectedTable]})[0];t&&r.unshift(i.map(function(t){return t.key})),n(r.map(function(e,n){return t&&0==n?e:i.filter(function(t){return!!e[t.key]}).map(function(t){switch(t.type){case"map":return'"'+JSON.stringify(e[t.key]).replace(/"/g,"'")+'"';case"array":return'"'+JSON.stringify(e[t.key]).replace(/"/g,"'")+'"';default:return JSON.stringify(e[t.key])}}).join(",")}).join("\n"))})})},t.uuid=function(t){return t?t:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0,n="x"==t?e:3&e|8;return n.toString(16)})}()},t}();e.someSQL_Instance=c;var u=function(t){function e(e,n){var r=t.call(this,n)||this;return r.scope=e,r}return i(e,t),e.prototype.then=function(t,n){var r=this;return new e(r.scope,function(e,i){r.done(function(n){if("function"==typeof t)try{n=t.apply(r.scope,[n])}catch(t){return void i(t)}e(n)},function(t){if("function"==typeof n){try{t=n.apply(r.scope,[t])}catch(t){return void i(t)}e(t)}else i(t)})})},e}(o.tsPromise),a=new c;e.someSQL=r},function(t,e){t.exports=function(t){function e(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return t[r].call(i.exports,i,i.exports,e),i.loaded=!0,i.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e){"use strict";var n=function(){function t(t){this._callbacks=[],this._failed=!1,this._resolved=!1,this._settled=!1,t(this._resolve.bind(this),this._reject.bind(this))}return t.resolve=function(e){return new t(function(t){t(e)})},t.reject=function(e){return new t(function(t,n){n(e)})},t.race=function(e){var n=!1;return new t(function(t,r){e.forEach(function(e){e.then(function(e){n||(t(e),n=!0)}).catch(function(t){r(t),n=!0})})})},t.all=function(e){return new t(function(t,n){var r=e.length,i=[],o=!1;e.forEach(function(e,s){e.then(function(e){o||(r--,i[s]=e,0==r&&t(i))}).catch(function(t){n(t),o=!0})})})},t.prototype.done=function(t,e){this._settled?setTimeout(this._release.bind(this,t,e),0):this._callbacks.push({onSuccess:t,onFail:e})},t.prototype.then=function(e,n){var r=this;return new t(function(t,i){r.done(function(n){if("function"==typeof e)try{n=e(n)}catch(t){return void i(t)}t(n)},function(e){if("function"==typeof n){try{e=n(e)}catch(t){return void i(t)}t(e)}else i(e)})})},t.prototype.catch=function(t){return this.then(null,t)},t.prototype._release=function(t,e){if(this._failed){if("function"!=typeof e)throw this._value;e(this._value)}else"function"==typeof t&&t(this._value)},t.prototype._resolve=function(e){this._resolved||(this._resolved=!0,e instanceof t?e.done(this._settle.bind(this),function(t){this._failed=!0,this._settle(t)}.bind(this)):this._settle(e))},t.prototype._reject=function(t){this._resolved||(this._resolved=!0,this._failed=!0,this._settle(t))},t.prototype._settle=function(t){this._settled=!0,this._value=t,setTimeout(this._callbacks.forEach.bind(this._callbacks,function(t){this._release(t.onSuccess,t.onFail)},this),0)},t}();e.tsPromise=n}])},function(t,e,n){"use strict";var r=n(3),i=n(1),o=function(){function t(){var t=this;t._tables={},t._tIndex={},t._models={},t._tCacheI={},t._immu={},t._i={}}return t.prototype.connect=function(t,e){for(var n in t)this._newModel(n,t[n]);e()},t.prototype._newModel=function(t,e){this._models[t]=e,this._tables[t]={},this._tIndex[t]=[],this._i[t]=1},t.prototype.exec=function(t,e,n){var r=this;r._sT=t,r._mod=[],r._act=null,r._cacheKey=r._hash(JSON.stringify(e)),i.tsPromise.all(e.map(function(t){return new i.tsPromise(function(e,n){r._query(t,e)})})).then(function(){r._exec(n)})},t.prototype._hash=function(t){for(var e=5381,n=0;n<t.length;n++){var r=t.charCodeAt(n);e=(e<<5)+e+r}return String(e)},t.prototype._query=function(t,e){["upsert","select","delete","drop"].indexOf(t.type)!=-1&&(this._act=t),["where","orderby","limit","offset","andWhere","orWhere"].indexOf(t.type)!=-1&&this._mod.push(t),e()},t.prototype._exec=function(t){var e=this;switch(e._act.type){case"upsert":var n,i=e._mod.filter(function(t){return["where","andWhere","orWhere"].indexOf(t.type)!=-1});if(i.length){n=[];var o=e._where(e._tIndex[e._sT]),s=e._tables[e._sT];o.forEach(function(t,r){for(var i in e._act.args)s[t][i]=e._act.args[i],n.push(JSON.parse(JSON.stringify(e._act.args[i])));for(var o=0,c=e._tCacheI;o<c.length;o++){var u=c[o];e._tCacheI[u]&&e._tCacheI[u].indexOf(r)!=-1&&(delete e._tCacheI[u],delete e._immu[u])}})}else{var c="";e._models[e._sT].forEach(function(t){"uuid"!=t.type||e._act.args[t.key]||(e._act.args[t.key]=r.someSQL_Instance.uuid()),t.props&&t.props.indexOf("pk")!=-1&&(c=t.key,t.props.indexOf("ai")==-1||e._act.args[t.key]||(e._act.args[t.key]=e._i[e._sT],e._i[e._sT]++))});var u=e._act.args[c];if(e._tIndex[e._sT].indexOf(u)==-1)e._tIndex[e._sT].push(u);else for(var a=0,f=e._tCacheI;a<f.length;a++){var p=f[a];e._tCacheI[p]&&e._tCacheI[p].indexOf(u)!=-1&&(delete e._tCacheI[p],delete e._immu[p])}e._tables[e._sT][u]=e._act.args,n=[JSON.parse(JSON.stringify(e._act.args))]}t(n);break;case"select":if(!e._immu[e._cacheKey]){var h=e._tables[e._sT];e._tCacheI[e._cacheKey]=[],e._immu[e._cacheKey]=JSON.parse(JSON.stringify(e._where(e._tIndex[e._sT]).sort(function(t,n){return e._mod.filter(function(t){return"orderby"==t.type}).map(function(e){for(var r in e.args){if(h[t][r]==h[n][r])return 0;var i=h[t][r]>h[n][r]?1:-1;return"asc"==e.args[r]?i:-i}}).reduce(function(t,e){return t+e},0)||0}).filter(function(t,n){var r=0;return!e._mod.filter(function(t){return["limit","offset"].indexOf(t.type)!=-1}).sort(function(t,e){return t.type<e.type?1:-1}).map(function(t,e){switch(t.type){case"offset":return r=t.args,n>=t.args?0:1;case"limit":return n<r+t.args?0:1}}).reduce(function(t,e){return t+e},0)}).map(function(t,n){if(e._tCacheI[e._cacheKey].push(n),e._act.args&&e._act.args.length){var r=JSON.parse(JSON.stringify(h[t]));return e._models[e._sT].forEach(function(t){e._act.args.indexOf(t.key)==-1&&delete r[t.key]}),r}return h[t]})))}t(e._immu[e._cacheKey]);break;case"delete":var l=e._where(e._tIndex[e._sT]),_=e._tables[e._sT];l.forEach(function(t,n){delete _[t],e._tIndex[e._sT].splice(e._tIndex[e._sT].indexOf(t),1);for(var r=0,i=e._tCacheI;r<i.length;r++){var o=i[r];e._tCacheI[o]&&e._tCacheI[o].indexOf(t)!=-1&&(delete e._tCacheI[o],delete e._immu[o])}}),t(l.length+" row(s) deleted");break;case"drop":e._tables[e._sT]={},e._tIndex[e._sT]=[],e._i[e._sT]=1,t("Success")}},t.prototype._where=function(t){var e=this,n=e._tables[e._sT];return t.filter(function(t,r){var i=[];return e._mod.filter(function(t){return"andWhere"==t.type}).forEach(function(t){t.args.forEach(function(t){i.push({type:"where",args:t})})}),0==e._mod.filter(function(t){return"where"==t.type}).concat(i).map(function(r){return e._models[e._sT].map(function(i){return i.key==r.args[0]?e._compare(r.args[2],r.args[1],n[t][i.key]):0}).reduce(function(t,e){return t+e},0)}).reduce(function(t,e){return t+e},0)}).filter(function(t){var r=[];return e._mod.map(function(t){"orWhere"==t.type&&t.args.forEach(function(t){r.push(t)})}),0==r.length||e._models[e._sT].map(function(i){return r.filter(function(r){return 1!=e._compare(r[2],r[1],n[t][i.key])}).length}).filter(function(t){return t>0}).length>0})},t.prototype._compare=function(t,e,n){switch(e){case"=":return n==t?0:1;case">":return n>t?0:1;case"<":return n<t?0:1;case"<=":return n<=t?0:1;case">=":return n>=t?0:1;case"IN":return t.indexOf(n)==-1?1:0;case"NOT IN":return t.indexOf(n)==-1?0:1;case"LIKE":return n.search(t)==-1?1:0;default:return 0}},t}();e.someSQL_MemDB=o},function(t,e){t.exports=function(t){function e(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return t[r].call(i.exports,i,i.exports,e),i.loaded=!0,i.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){"use strict";function r(t){return u.init(t)}var i=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},o=n(1),s=function(){function t(){var t=this;t._callbacks={"*":{}},t._actions={},t._views={},t._models={},t._query=[],t._events=["change","delete","upsert","drop","select"],t._events.forEach(function(e){t._callbacks["*"][e]=[]})}return t.prototype.init=function(t){return this._selectedTable=t||"",this},t.prototype.connect=function(t){var e=this;return this._backend=t,new c(this,function(n,r){t.connect(e._models,n,r)})},t.prototype.on=function(t,e){var n=this;return t.split(" ").forEach(function(t){if(n._events.indexOf(t)==-1)throw new Error(t+"ins't a valid attachable event!");n._callbacks[n._selectedTable][t].push(e)}),this},t.prototype.model=function(t){var e=this,n=e._selectedTable;return e._callbacks[n]={},e._events.forEach(function(t){e._callbacks[n][t]=[]}),e._models[n]=t,e._views[n]={},e._actions[n]={},this},t.prototype.views=function(t){return this._views[this._selectedTable]=t,this},t.prototype.getView=function(t,e){var n=this,r=n._selectedTable,i=n._views[r][t];return i[1](n.init(r),n._cleanArgs(i,e))},t.prototype._cleanArgs=function(t,e){var n=this,r=(n._selectedTable,{}),i=t;return i[0].forEach(function(t){var i=t.split(":");i.length>1?r[i[0]]=n._cast(i[1],e[i[0]]):r[i[0]]=e[i[0]]}),r},t.prototype._cast=function(t,e){switch(["string","int","float","array","map"].indexOf(t)){case 0:return String(e);case 1:return parseInt(e);case 2:return parseFloat(e);case 3:case 4:return JSON.parse(JSON.stringify(e));default:return e}},t.prototype.actions=function(t){return this._actions[this._selectedTable]=t,this},t.prototype.doAction=function(t,e){var n=this,r=n._selectedTable,i=n._actions[r][t];return i[1](n.init(r),n._cleanArgs(i,e))},t.prototype.query=function(t,e){this._query=[];var n=t.toLowerCase();return["select","upsert","delete","drop"].indexOf(n)!=-1&&this._query.push({type:n,args:e}),this},t.prototype.where=function(t){return this._query.push({type:"where",args:t}),this},t.prototype.andWhere=function(t){return this._query.push({type:"andWhere",args:t}),this},t.prototype.orWhere=function(t){return this._query.push({type:"orWhere",args:t}),this},t.prototype.orderBy=function(t){return this._query.push({type:"orderby",args:t}),this},t.prototype.limit=function(t){return this._query.push({type:"limit",args:t}),this},t.prototype.offset=function(t){return this._query.push({type:"offset",args:t}),this},t.prototype.exec=function(){var t=this,e=t._selectedTable;return t._triggerEvents=[],this._query.map(function(t){switch(t.type){case"select":return[t.type];case"delete":case"upsert":case"drop":return[t.type,"change"];default:return[]}}).forEach(function(e){e.forEach(function(e){t._triggerEvents.push(e)})}),new c(this,function(n,r){t._backend.exec(e,t._query,function(r){t._triggerEvents.forEach(function(n){t._callbacks[e][n].concat(t._callbacks["*"][n]).forEach(function(i){i({type:n,table:e,query:t._query,time:(new Date).getTime(),result:r})})}),n(r)})})},t.prototype.custom=function(t,e){var n=this;return new c(n,function(r,i){n._backend.custom?n._backend.custom(t,e,r):r()})},t.prototype.loadJS=function(t){var e=this;return o.tsPromise.all(t.map(function(t){return e.init(e._selectedTable).query("upsert",t).exec()}))},t.prototype.loadCSV=function(t){var e=this,n=[];return new c(e,function(r,i){o.tsPromise.all(t.split("\n").map(function(t,r){return new c(e,function(i,o){if(0==r)n=t.split(","),i();else{var s={},c=t.match(/(".*?"|[^",\s]+)(?=\s*,|\s*$)/g).map(function(t){return t.replace(/^"(.+(?="$))"$/,"$1")});n.forEach(function(t,e){0!=c[e].indexOf("{")&&0!=c[e].indexOf("[")||(c[e]=JSON.parse(c[e].replace(/'/g,'"'))),s[t]=c[e]}),e.init(e._selectedTable).query("upsert",c).exec().then(function(){i()})}})})).then(function(){r()})})},t.prototype.toCSV=function(t){var e=this;return new c(e,function(n,r){e.exec().then(function(r){var i=e._query.filter(function(t){return"select"==t.type}).map(function(t){return t.args?t.args.map(function(t){return e._models[e._selectedTable].filter(function(e){return e.key==t})[0]}):e._models[e._selectedTable]})[0];t&&r.unshift(i.map(function(t){return t.key})),n(r.map(function(e,n){return t&&0==n?e:i.filter(function(t){return!!e[t.key]}).map(function(t){switch(t.type){case"map":return'"'+JSON.stringify(e[t.key]).replace(/"/g,"'")+'"';case"array":return'"'+JSON.stringify(e[t.key]).replace(/"/g,"'")+'"';default:return JSON.stringify(e[t.key])}}).join(",")}).join("\n"))})})},t.uuid=function(t){return t?t:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0,n="x"==t?e:3&e|8;return n.toString(16)})}()},t}();e.someSQL_Instance=s;var c=function(t){function e(e,n){var r=t.call(this,n)||this;return r.scope=e,r}return i(e,t),e.prototype.then=function(t,n){var r=this;return new e(r.scope,function(e,i){r.done(function(n){if("function"==typeof t)try{n=t.apply(r.scope,[n])}catch(t){return void i(t)}e(n)},function(t){if("function"==typeof n){try{t=n.apply(r.scope,[t])}catch(t){return void i(t)}e(t)}else i(t)})})},e}(o.tsPromise),u=new s;e.someSQL=r},function(t,e){t.exports=function(t){function e(r){if(n[r])return n[r].exports;
var i=n[r]={exports:{},id:r,loaded:!1};return t[r].call(i.exports,i,i.exports,e),i.loaded=!0,i.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e){"use strict";var n=function(){function t(t){this._callbacks=[],this._failed=!1,this._resolved=!1,this._settled=!1,t(this._resolve.bind(this),this._reject.bind(this))}return t.resolve=function(e){return new t(function(t){t(e)})},t.reject=function(e){return new t(function(t,n){n(e)})},t.race=function(e){var n=!1;return new t(function(t,r){e.forEach(function(e){e.then(function(e){n||(t(e),n=!0)}).catch(function(t){r(t),n=!0})})})},t.all=function(e){return new t(function(t,n){var r=e.length,i=[],o=!1;e.forEach(function(e,s){e.then(function(e){o||(r--,i[s]=e,0==r&&t(i))}).catch(function(t){n(t),o=!0})})})},t.prototype.done=function(t,e){this._settled?setTimeout(this._release.bind(this,t,e),0):this._callbacks.push({onSuccess:t,onFail:e})},t.prototype.then=function(e,n){var r=this;return new t(function(t,i){r.done(function(n){if("function"==typeof e)try{n=e(n)}catch(t){return void i(t)}t(n)},function(e){if("function"==typeof n){try{e=n(e)}catch(t){return void i(t)}t(e)}else i(e)})})},t.prototype.catch=function(t){return this.then(null,t)},t.prototype._release=function(t,e){if(this._failed){if("function"!=typeof e)throw this._value;e(this._value)}else"function"==typeof t&&t(this._value)},t.prototype._resolve=function(e){this._resolved||(this._resolved=!0,e instanceof t?e.done(this._settle.bind(this),function(t){this._failed=!0,this._settle(t)}.bind(this)):this._settle(e))},t.prototype._reject=function(t){this._resolved||(this._resolved=!0,this._failed=!0,this._settle(t))},t.prototype._settle=function(t){this._settled=!0,this._value=t,setTimeout(this._callbacks.forEach.bind(this._callbacks,function(t){this._release(t.onSuccess,t.onFail)},this),0)},t}();e.tsPromise=n}])}])}])}])});