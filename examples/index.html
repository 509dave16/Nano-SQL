<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Page Title</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="nano-sql.min.js"></script>
    <script>
        nSQL("personnelLocation")
            .model([{
                    "key": "id",
                    "type": "uuid",
                    "props": [
                        "pk"
                    ]
                },
                {
                    "key": "client_id",
                    "type": "uuid",
                    "props": [
                        "idx"
                    ]
                },
                {
                    "key": "client_location_id",
                    "type": "uuid",
                    "props": [
                        "idx"
                    ]
                },
                {
                    "key": "personnel_id",
                    "type": "string",
                    "props": [
                        "idx"
                    ]
                },
                {
                    "key": "created_date",
                    "type": "string",
                    "props": []
                },
                {
                    "key": "modified_date",
                    "type": "string",
                    "props": []
                }
            ])
            .config({
                id: 'test-cache'
            }).connect().then(() => {

                const data = [{
                        'id': '1',
                        'personnel_id': '2596'
                    },
                    {
                        'id': '2',
                        'personnel_id': '2596'
                    },
                    {
                        'id': '3',
                        'personnel_id': '2596'
                    },
                    {
                        'id': '4',
                        'personnel_id': '2596'
                    }
                ];

                const promises = [];

                data.forEach(row => {
                    promises.push(nSQL("personnelLocation").query("upsert", row).exec());
                });

                return Promise.all(promises);

            }).then(() => {
                // performing select on a secondary index uses that secondary index for the query...
                return nSQL("personnelLocation").query("select").where(["personnel_id", "=", "2596"]).exec();
            }).then((rows) => {
                const pre = document.createElement("pre");
                document.body.appendChild(pre);
                pre.innerHTML = JSON.stringify(rows, null, 4);
            })
    </script>
</head>

<body>

</body>

</html>