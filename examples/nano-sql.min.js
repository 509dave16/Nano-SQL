!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n=t();for(var r in n)("object"==typeof exports?exports:e)[r]=n[r]}}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.e?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=6)}([function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(1);t.t=function(e){return JSON.parse(JSON.stringify(e))};var i=function(){function e(){var e=this;e.r={},e.a={},e._={},e.u=[],e.f=[],e.h=["change","delete","upsert","drop","select","error"],e.y={},e.b={},e.y["*"]={};for(var t=e.h.length;t--;)e.y["*"][e.h[t]]=[];e.g={},e.v={}}return e.prototype.table=function(e){return e&&(this.x=e),this},e.prototype.connect=function(e){var t=this,n=this;return n.backend?new o.k(function(e,t){throw t(),Error()}):(n.backend=e||new r.w,new o.k(function(e,r){n.backend.I({_:n._,r:n.r,a:n.a,g:n.g,O:n.u,S:t,P:function(t){e(t,n)},j:function(e){r&&r(e,n)}})}))},e.prototype.on=function(e,t){var n=this,r=n.x,o=0,i=e.split(" ");if(!n.y[r])for(n.y[r]={},n.y[r]["*"]=[];o--;)n.y[r][n.h[o]]=[];for(o=i.length;o--;)-1!==n.h.indexOf(i[o])&&n.y[r][i[o]].push(t);return n.T(),n},e.prototype.off=function(e){var t=this;for(var n in t.y)for(var r in t.y[n])t.y[n][r]=t.y[n][r].filter(function(t){return t!==e});return t.T(),t},e.prototype.T=function(){var e=this;this.b={},Object.keys(this._).concat(["*"]).forEach(function(t){e.b[t]=e.h.reduce(function(n,r){return n+(e.y[t]?e.y[t][r].length:0)},0)>0})},e.prototype.model=function(e){var t=this,n=t.x,r=t.h.length;if(!t.y[n])for(t.y[n]={},t.y[n]["*"]=[];r--;)t.y[n][t.h[r]]=[];return t._[n]=e,t.a[n]=[],t.r[n]=[],t},e.prototype.views=function(e){return this.a[this.x]=e,this},e.prototype.getView=function(e,t){return void 0===t&&(t={}),this.N("View",this.a[this.x],e,t)},e.prototype.cleanArgs=function(e,t){var n=this,r=(n.x,{}),o=e.length?e.length:-1;if(o>0)for(;o--;){var i=e[o].split(":");i.length>1?r[i[0]]=n.D(i[1],t[i[0]]||null):r[i[0]]=t[i[0]]||null}return r},e.prototype.D=function(e,n){var r=this,o=typeof n,i={string:null===o?"":"string"!==o?String(n):n,int:"number"!==o||n%1!=0?parseInt(n||0):n,float:"number"!==o?parseFloat(n||0):n,array:Array.isArray(n)?t.t(n||[]):[],"any[]":Array.isArray(n)?t.t(n||[]):[],any:n,blob:n,uudi:n,timeId:n,map:"object"===o?t.t(n||{}):{},bool:!0===n},a=i[e];if(void 0!==a)return a;if(-1!==e.indexOf("[]")){var s=e.slice(0,e.lastIndexOf("[]"));return(n||[]).map(function(e){return r.D(s,e)})}return n},e.prototype.actions=function(e){return this.r[this.x]=e,this},e.prototype.doAction=function(e,t){return this.N("Action",this.r[this.x],e,t)},e.prototype.N=function(e,t,n,r){var i=this,a=this,s=t.reduce(function(e,t){return t.name===n?t:e},null);if(!s)return new o.k(function(e,t){return t("Action/View Not Found!")});a.L=n;var _=s.args?a.cleanArgs(s.args,r):{};return a.A?new o.k(function(t,n){a.A(i.x,e,a.L||"",_,function(e){!!s&&s.call(e,a).then(function(e){t(e,a)})},function(e){n(e)})}):s.call(_,a)},e.prototype.newFunction=function(e,t,n){return this.g[e]={type:t,call:n},this},e.prototype.query=function(e,t){var n=this,r=new a(n.x,n,n.L);n.L=void 0;var o=e.toLowerCase();if(-1===["select","upsert","delete","drop","show tables","describe"].indexOf(o))throw Error;var i=t||("select"===o||"delete"===o?[]:{});if(-1!==["upsert","delete","drop"].indexOf(o)&&this.f.push(n.x),"upsert"===e){var s={};n._[n.x].forEach(function(e){i[e.key]&&(s[e.key]=n.D(e.type,i[e.key]))}),n.v[n.x]&&(s=n.v[n.x](s)),i=s}return r.C={type:o,args:i},r},e.prototype.triggerEvent=function(e,t){var n=this;setTimeout(function(){for(var r,o,i=t.length,a=0;i--;)for(r=t[i],o=n.y[e.table][r].concat(n.y[e.table]["*"]),a=o.length;a--;)e.name=r,o[a](e,n)},0)},e.prototype.default=function(e){var t={},n=this;return n._[n.x].forEach(function(r){t[r.key]=e&&e[r.key]?e[r.key]:r.default,t[r.key]||(t[r.key]=n.D(r.type,null))}),t},e.prototype.beginTransaction=function(){if(this.doingTransaction=!0,this.f=[],this.backend.M)return this.backend.M("start")},e.prototype.endTransaction=function(){var e=this;if(this.doingTransaction=!1,this.f.forEach(function(t){0!==t.indexOf("_")&&e.triggerEvent({table:t,query:[],time:(new Date).getTime(),result:[],name:"change",actionOrView:"",changeType:"transaction",changedRows:[]},["change"])}),this.backend.M)return this.backend.M("end")},e.prototype.queryFilter=function(e){return this.R=e,this},e.prototype.avFilter=function(e){return this.A=e,this},e.prototype.config=function(e){var t=this;return t.backend||t.u.push(e),t},e.prototype.extend=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=this;if(n.backend)return n.backend.q?(e.unshift(n),n.backend.q.apply(n.backend,e)):void 0},e.prototype.loadJS=function(e,t){var n=this;return n.beginTransaction(),new o.k(function(r,o){var i=0,a=[],s=function(){i<t.length?t[i]?n.table(e).query("upsert",t[i]).exec().then(function(e){a.push(e),i++,s()}):(i++,s()):(n.endTransaction(),r(a,n))};s()})},e.prototype.rowFilter=function(e){return this.v[this.x]=e,this},e.prototype.loadCSV=function(e,t){var n=this,r=[];return n.beginTransaction(),new o.k(function(i,a){o.k.all(t.split("\n").map(function(t,i){return new o.k(function(o,a){if(0===i)r=t.split(","),o();else{var s={},_=t.match(/(".*?"|[^",\s]+)(?=\s*,|\s*$)/g)||[];_=_.map(function(e){return e.replace(/^"(.+(?="$))"$/,"$1")});for(var c=r.length;c--;)0!==_[c].indexOf("{")&&0!==_[c].indexOf("[")||(_[c]=JSON.parse(_[c].replace(/'/g,""))),s[r[c]]=_[c];n.table(e).query("upsert",s).exec().then(function(){o()})}})})).then(function(){n.endTransaction(),i([],n)})})},e.Q=function(){if("undefined"==typeof crypto)return Math.round(Math.random()*Math.pow(2,16));if(crypto.getRandomValues){var e=new Uint16Array(1);return crypto.getRandomValues(e),e[0]}return"undefined"!==global&&global.F.randomBytes?global.F.randomBytes(2).reduce(function(e,t){return t*e}):Math.round(Math.random()*Math.pow(2,16))},e.timeid=function(e){var t=this;t.V||(t.V=6e4*(new Date).getTimezoneOffset());for(var n=Math.round(((new Date).getTime()+t.V)/(e?1:1e3)).toString();n.length<(e?13:10);)n="0"+n;return n+"-"+(t.Q()+t.Q()).toString(16)},e.uuid=function(){var e,t,n=this,r="";return[r,r,r,r,r,r,r,r,r].reduce(function(o,i,a){for(e=n.Q(),t=4===a?a:5===a?(e%16&3|8).toString(16):r,e=e.toString(16);e.length<4;)e="0"+e;return o+([3,4,5,6].indexOf(a)>=0?"-":r)+(t+e).slice(0,4)},r)},e.B=function(e){return Math.abs(e.split("").reduce(function(t,n,r){return(t<<5)+t+e.charCodeAt(r)},0))},e}();t.NanoSQLInstance=i;var a=function(){function e(e,t,n){this.K=t,this.J=[],this.H=e,this.W=n||""}return e.prototype.where=function(e){return e.length&&Array.isArray(e)||(this.z="Where condition requires an array!"),this.U("where",e)},e.prototype.range=function(e,t){return this.U("range",[e,t])},e.prototype.orderBy=function(e){return this.U("orderby",e)},e.prototype.groupBy=function(e){return this.U("groupby",e)},e.prototype.having=function(e){return e.length&&Array.isArray(e)||(this.z="Having condition requires an array!"),this.U("having",e)},e.prototype.join=function(e){return e.table&&e.type||(this.z="Join command requires table and type arguments!"),this.U("join",e)},e.prototype.limit=function(e){return this.U("limit",e)},e.prototype.trieSearch=function(e,t){return this.U("trie",[e,t])},e.prototype.offset=function(e){return this.U("offset",e)},e.prototype.U=function(e,t){return this.J.push({type:e,args:t}),this},e.prototype.toCSV=function(e){var t=this;return new o.k(function(n,r){t.exec().then(function(r){var o=t.C.args.length?t.C.args.map(function(e){return t.K._[t.H].filter(function(t){return t.key===e})[0]}):t.K._[t.H];e&&r.unshift(o.map(function(e){return e.key})),n(r.map(function(t,n){return e&&0===n?t:o.filter(function(e){return!!t[e.key]}).map(function(e){switch(e.type){case"map":case"array":return'"'+JSON.stringify(t[e.key]).replace(/"/g,"'")+'"';default:return t[e.key]}}).join(",")}).join("\n"),t)})})},e.prototype.exec=function(){var e=this,t=e.H;return e.K.b[t]&&(e.K.$=function(){switch(e.C.type){case"select":return[e.C.type];case"delete":case"upsert":case"drop":return[e.C.type,"change"];default:return[]}}()),new o.k(function(n,r){if(e.z)throw r(e.z),Error;if(!e.K.backend)throw r(),Error;var o=function(n,r,o,i,a){e.K.b[t]&&e.K.triggerEvent({name:"error",actionOrView:e.W,table:t,query:[e.C].concat(e.J),time:(new Date).getTime(),result:n,changeType:o,changedRows:i},e.K.$),r(n,e.K)},i={table:t,query:[e.C].concat(e.J),viewOrAction:e.W,onSuccess:function(t,r,i){e.K.doingTransaction?n(t,e.K):o(t,n,r,i)},onFail:function(t){e.K.doingTransaction?n(t,e.K):(e.K.$=["error"],r&&o(t,r,"error",[]))}};e.K.R?e.K.R(i,function(t){e.K.backend.X(t)}):e.K.backend.X(i)})},e}();t.G=a;var s=new i;t.nSQL=function(e){return s.table(e)}},function(e,t,n){"use strict";function r(e,n,r){t.setFast(function(){var t;try{t=n.apply(null,r)}catch(t){return m.Y(e,t)}return t===e?m.Y(e,new TypeError):m.Z(e,t),null})}function o(e){var t=e&&e.then;return!e||"object"!=typeof e&&"function"!=typeof e||"function"!=typeof t?null:function(){t.apply(e,arguments)}}function i(e,t){function n(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];i||(i=!0,m.Y(e,t))}function r(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];i||(i=!0,m.Z(e,t))}function o(){t(r,n)}var i=!1,s=a(o);"error"===s.ee&&n(s.te)}function a(e,t){var n={ee:null,te:null};try{n.te=e(t),n.ee="success"}catch(e){n.ee="error",n.te=e}return n}Object.defineProperty(t,"__esModule",{value:!0});var s=0,_={},c=!0,u=Array.prototype.slice,f=function(e){var t=e[0];switch(e.length){case 1:return t();case 2:return t(e[1]);case 3:return t(e[1],e[2])}return t.apply(window,u.call(e,1))},l=function(e){var t,n=e.data;"string"==typeof n&&0==n.indexOf("setIlMessage")&&(t=_[n])&&(delete _[n],f(t))},d=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=s++,r="setIlMessage"+n;return _[r]=e,c&&(c=!1,window.addEventListener("message",l)),window.postMessage(r,"*"),n};t.setFast="undefined"==typeof process?d:setImmediate;var p=function(){},h=["R"],y=["F"],b=["P"],g=function(){function e(e){this.ne=b,this.re=[],this.oe=void 0,e!==p&&i(this,e)}return e.prototype.catch=function(e){return this.then(function(){},e)},e.prototype.then=function(t,n){if("function"!=typeof t&&this.ne===y||"function"!=typeof n&&this.ne===h)return this;var o=new e(p);return this.ne!==b?r(o,this.ne===y?t:n,this.oe):this.re.push(new v(o,t,n)),o},e.resolve=function(t){return t instanceof this?t:m.Z(new e(p),t)},e.reject=function(t){return m.Y(new e(p),t)},e.all=function(t){var n=this,r=t.length,o=!1,i=new Array(r),a=0,s=-1,_=new e(p);if(!r)return this.resolve([]);for(;++s<r;)!function(e,t){function s(e){i[t]=e,++a!==r||o||(o=!0,m.Z(_,i))}n.resolve(e).then(s,function(e){o||(o=!0,m.Y(_,e))})}(t[s],s);return _},e.race=function(t){var n=this,r=t.length,o=!1,i=-1,a=new e(p);if(!1!==Array.isArray(t))return this.reject(new TypeError);if(!r)return this.resolve([]);for(;++i<r;)!function(e){n.resolve(e).then(function(e){o||(o=!0,m.Z(a,e))},function(e){o||(o=!0,m.Y(a,e))})}(t[i]);return a},e}();t.k=g;var v=function(){function e(e,t,n){this.ie=e,"function"==typeof t&&(this.ae=t,this.se=this._e),"function"==typeof n&&(this.ce=n,this.ue=this.fe)}return e.prototype.se=function(e){m.Z(this.ie,e)},e.prototype._e=function(e){r(this.ie,this.ae,e)},e.prototype.ue=function(e){m.Y(this.ie,e)},e.prototype.fe=function(e){r(this.ie,this.ce,e)},e}();t.le=v;var m=function(){function e(){}return e.Z=function(t,n){var r=a(o,n),s=r.te,_=-1,c=t.re.length;if("error"===r.ee)return e.Y(t,r.te);if(s)i(t,s);else for(t.ne=y,t.oe=n;++_<c;)t.re[_].se(n);return t},e.Y=function(e,t){e.ne=h,e.oe=t;for(var n=-1,r=e.re.length;++n<r;)e.re[n].ue(t);return e},e}()},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),o=n(1),i=n(5),a=n(3);t.de=function(e){return["_utility","_historyPoints","_pointer","_historyDataRowIDs","_id"][e]};var s=function(){function e(){var e=this;e.pe=[],e.he={}}return e.prototype.I=function(e){var t=this;t.ye=r.NanoSQLInstance.B(JSON.stringify(e._)).toString(),t.S=e.S,t.be=new i.ge(t,e)},e.prototype.X=function(e){var t=this;new a.G(t).ve(e)},e.prototype.me=function(e,t,n,r){var o=this;o.he[e]={},t.length&&r&&o.S.triggerEvent({name:"change",actionOrView:"",table:o.be.ke[e].xe,query:[],time:(new Date).getTime(),result:[{msg:r+" was performed.",type:r}],changedRows:t,changeType:n},["change"])},e.prototype.we=function(e,t){if(!e)return e;var n=this;return t&&n.be._[t].forEach(function(t){var r=e[t.key];(["map","array"].indexOf(t.type)>=0||t.type.indexOf("[]")>=0)&&(e[t.key]=n.we(r))}),Object.freeze(e)},e.prototype.M=function(e){var t=this;return"start"===e&&(t.be.Ie={},t.be.Oe=!0),"end"===e&&(t.be.Oe=!1,t.be.Se()),!!t.be.Oe},e.prototype.q=function(e,n){var i,a,s,_,c=this,u=function(e,n){var o={},a=c.be.Pe-c.be.je;c.be.Ee(t.de(1),c.be.Te[a],function(a){s=0;var u=function(){if(s<a.length){i=0;var f=a[s].tableID,l=c.be.ke[f],d=[],p=function(){i<a[s].rowKeys.length?(_=a[s].rowKeys[i],"int"===l.Ne&&(_=parseInt(_)),c.be.De(l.xe,_,function(n){e>0&&d.push(n[0]),c.be.De("_"+l.xe+"_hist__meta",_,function(n){n=r.t(n),n[0][t.de(2)]=(n[0][t.de(2)]||0)+e;var u=n[0][t.de(3)][n[0][t.de(2)]];c.be.Le("_"+l.xe+"_hist__meta",_,n[0],function(){c.be.De("_"+l.xe+"_hist__data",u,function(n){var u=n[0]?r.t(n[0]):null;u&&delete u[t.de(4)],c.be.Le(l.xe,_,u,function(){e<0&&d.push(u),o[f]||(o[f]={type:a[s].type,rows:[]}),o[f].rows=o[f].rows.concat(d),i++,p()})})})})})):(s++,u())};p()}else n(o)};u()})};return new o.k(function(e,t){switch(n){case"<":c.be.Pe&&c.be.je!==c.be.Pe?u(1,function(t){c.be.je++,c.be.Ae("w","historyPoint",c.be.je),Object.keys(t).forEach(function(e){var n=t[e].type;switch(n){case"inserted":n="deleted";break;case"deleted":n="inserted"}c.me(parseInt(e),t[e].rows,n,"undo")}),e(!0)}):e(!1);break;case">":!c.be.Pe||c.be.je<1?e(!1):(c.be.je--,c.be.Ae("w","historyPoint",c.be.je),u(-1,function(t){Object.keys(t).forEach(function(e){c.me(parseInt(e),t[e].rows,t[e].type,"redo")}),e(!0)}));break;case"?":a=[c.be.Pe,c.be.Pe-c.be.je],c.be.Ce.join("+")!==a.join("+")&&(c.be.Ce=a),e(c.be.Ce);break;case"flush_history":case"flush_db":c.be.Ae("w","historyPoint",0),c.be.Ae("w","historyLength",0),c.be.je=0,c.be.Pe=0,Object.keys(c.be.ke).forEach(function(e){var t;0===c.be.ke[parseInt(e)].xe.indexOf("_")?t=[]:(t=c.be.ke[parseInt(e)].Me,t=Object.keys(t).map(function(e){return t[e]})),c.me(parseInt(e),t,"remove","clear")}),"flush_db"===n?c.be.Re("all",e):c.be.Re("hist",e)}})},e}();t.w=s},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),o=n(2),i=function(e,t,n,o,i){var a=n[0];0===o[0]&&(i[a]=-1===e?Number.MAX_VALUE:Number.MIN_VALUE);var s={};if(s=(-1===e?parseFloat(t[a])<parseFloat(i[a]):parseFloat(t[a])>parseFloat(i[a]))?t:i,o[0]===o[1]){var _=r.t(s);return _[-1===e?"MIN":"MAX"]=s[a],_}return s};t.g={SUM:{type:"aggregate",call:function(e,t,n,o){if(0===n[0]&&(o=0),o+=parseInt(e[t[0]]),n[0]===n[1]){var i=r.t(e);return i.SUM=o,i}return o}},MIN:{type:"aggregate",call:function(e,t,n,r){return i(-1,e,t,n,r)}},MAX:{type:"aggregate",call:function(e,t,n,r){return i(1,e,t,n,r)}},AVG:{type:"aggregate",call:function(e,t,n,o){if(0===n[0]&&(o=0),o+=parseInt(e[t[0]]),n[0]===n[1]){var i=r.t(e);return i.AVG=o/(n[1]+1)||o,i}return o}},COUNT:{type:"aggregate",call:function(e,t,n,o){if(0===n[0]&&(o=0),"*"===t[0]?o++:o+=e[t[0]]?1:0,n[0]===n[1]){var i=r.t(e);return i.COUNT=o,i}return o}}};var a=function(){function e(e){this.K=e}return e.prototype.ve=function(e){var t=this;t.qe=r.NanoSQLInstance.B(e.table),t.Qe=[],t.Fe=void 0;var n=[];if(e.query.forEach(function(o){["upsert","select","delete","drop"].indexOf(o.type)>=0?(t.Fe=o,"select"===o.type&&(t.Ve=r.NanoSQLInstance.B(JSON.stringify(e.query)))):["show tables","describe"].indexOf(o.type)>=0?n.push(o):t.Qe.push(o)}),n.length)switch(n[0].type){case"show tables":e.onSuccess([{tables:Object.keys(t.K.be.ke).map(function(e){return t.K.be.ke[e].xe})}],"info",[]);break;case"describe":var o,i=t.qe,a={};Object.keys(t.K.be.ke).forEach(function(e){parseInt(e)===t.qe&&(o=r.t(t.K.be._[e]),i=t.K.be.ke[e].xe)}),a[i]=o,e.onSuccess([a],"info",[])}else t.Be(function(t,n,r){e.onSuccess(t,n,r)})},e.prototype.Ke=function(e){return this.Qe.filter(function(t){return t.type===e}).pop()},e.prototype.Be=function(e){var t=this;if(t.Fe){var n=function(n){if(t.Fe)switch(t.Fe.type){case"upsert":t.Le(n,e);break;case"select":t.Je(n,e);break;case"drop":case"delete":t.He(n,e)}},r=t.K.be.ke[t.qe];if(t.Ke("join")||"drop"===t.Fe.type)n([]);else if(t.Ke("where")){var o=t.Ke("where").args,i=function(e){return-1===["=","IN","BETWEEN"].indexOf(e[1])||e[0]!==r.We&&-1===r.ze.indexOf(e[0])?1:0},a=function(e,n){var o=e[0]===r.We?r.xe:"_"+r.xe+"_idx_"+e[0];switch(e[1]){case"=":t.K.be.De(o,e[2],function(e){n(e)});break;case"IN":t.K.be.Ee(o,e[2],function(e){n(e)});break;case"BETWEEN":t.K.be.Ue(o,e[0],e[2],n)}};if("string"==typeof o[0]?0===i(o):0===o.reduce(function(e,t,n){return n%2==1?e:e+i(t)},0))if("string"==typeof o[0])a(o,n);else{var s=[],_=0,c="",u=function(){_<o.length?_%2==1?(c=o[_],_++,u()):a(o[_],function(e){if("AND"===c){var t=e.map(function(e){return e[r.We]});s=s.filter(function(e){return-1!==t.indexOf(e[r.We])})}else s=s.concat(e);_++,u()}):n(s)};u()}else t.K.be.De(r.xe,function(e){return e&&t.$e(e,o)},function(e){n(e)})}else if(t.Ke("range")){var f=t.Ke("range").args;t.Xe(f[0],f[1],n)}else if(t.Ke("trie")){var l=t.Ke("trie").args,d=r.Ge[l[0]].getPrefix(l[1]),p="_"+r.xe+"_idx_"+l[0];t.K.be.Ee(p,d,function(e){n(e)})}else"upsert"!==t.Fe.type?t.K.be.De(r.xe,"all",function(e){n(e)}):n([])}},e.prototype.Xe=function(e,t,n){var r=this,o=r.K.be.ke[r.qe],i=o.Ye[t],a=o.Ye[t+(e-1)];r.K.be.Ue(o.xe,o.We,[i,a],function(e){n(e)})},e.prototype.Ze=function(e,t){var n=this,i=n.K.be.ke[n.qe],a=n.Fe.args,s={},_=function(){return n.Fe&&"delete"===n.Fe.type&&!a.length?"drop":n.Fe?n.Fe.type:""}(),c=function(e,t){if(0!==i.xe.indexOf("_")){var o=[],a=function(r,a,s){n.K.be.De(r,a,function(_){var c=[];_.length&&_[0].rowPK&&(c=c.concat(_[0].rowPK)),t||c.push(e[i.We]),c=c.filter(function(n,r){return c.indexOf(n)===r||!(t&&n===e[i.We])}),c.length?n.K.be.Le(r,a,{id:a,rowPK:c},function(){}):(o.push(s),n.K.be.et(r,a))},!0)};i.ze.forEach(function(t){var o="_"+i.xe+"_idx_"+t,_=String(e[t]).toLowerCase(),c=String(s[t]).toLowerCase();_!==c&&s[t]?n.K.be.De(o,c,function(e){var s=e[0]?r.t(e[0].rowPK||[]):[],u=s.indexOf(c[i.We]);-1!==u&&s.splice(u,1),n.K.be.Le(o,c,{id:c,rowPK:s},function(){a(o,_,t)})}):void 0!==e[t]&&a(o,_,t)}),i.tt.forEach(function(t){var r=String(e[t]).toLocaleLowerCase();-1!==o.indexOf(t)?n.K.be.ke[n.qe].Ge[t].removeWord(r):n.K.be.ke[n.qe].Ge[t].addWord(r)})}},u=function(r){"upsert"===_?n.K.be.Le(i.xe,e,r,function(){t()}):n.K.be.et(i.xe,e,function(){t()})};if(n.K.be.Oe)return void u("upsert"===_?a:{});n.K.be.De(i.xe,e,function(t){s=t[0]||{};var f=r.t(t[0]||{}),l=!1;switch(_){case"upsert":Object.getOwnPropertyNames(a).forEach(function(e){f[e]=a[e]});var d=n.K.be.ke[n.qe];d.nt.forEach(function(e,t){var n=d.rt[t];!f[e]&&n&&(f[e]=n)});break;case"delete":a&&a.length?a.forEach(function(e){f[e]=null}):(l=!0,f={})}var p=function(t){0!==i.xe.indexOf("_")&&n.K.be.ot&&i.We.length&&n.K.be.De("_"+i.xe+"_hist__meta",e,function(a){a.length&&a[0]?a=r.t(a):(a[0]={},a[0][o.de(2)]=0,a[0][o.de(3)]=[],a[0].id=e),a[0][o.de(3)].unshift(t),n.K.be.Le("_"+i.xe+"_hist__meta",e,a[0])}),c("upsert"===_?f:{}),u(f)};if(!l&&0!==i.xe.indexOf("_")&&n.K.be.ot){var h="_"+i.xe+"_hist__data",y=r.NanoSQLInstance.B(h);f[o.de(4)]=n.K.be.ke[y].Ye.length,n.K.be.Le(h,null,f,function(e){p(e)})}else p(0)})},e.prototype.it=function(e,t,n){var i=this,a=this,s=0,_=0;if(a.K.be.Oe)return void n([],"trans",[]);if(e.length>0){var c=function(){var r=a.K.be.ke[i.qe];a.K.me(a.qe,[],""),a.K.be.Ee(r.xe,e,function(r){n([{msg:e.length+" row(s) "+t}],t,r)})},u=function(){if(a.K.be.ot){a.K.be.Oe||0!==a.K.be.je||a.K.be.Pe++,a.K.be.Ae("w","historyLength",a.K.be.Pe),a.K.be.Ae("w","historyPoint",a.K.be.je);var n=a.K.be.Pe-a.K.be.je;a.K.be.Le(o.de(1),null,{historyPoint:n,tableID:a.qe,rowKeys:e,type:t},function(e){a.K.be.Te[n]||(a.K.be.Te[n]=[]),a.K.be.Te[n].push(e),c()})}else c()};if(a.K.be.ot)if(a.K.be.je>0){for(var f=[],l=a.K.be.Pe-a.K.be.je+1;a.K.be.Te[l];)f=f.concat(a.K.be.Te[l].slice()),delete a.K.be.Te[l],l++;a.K.be.Ee(o.de(1),f,function(e){_=0;var t=function(){if(!(_<e.length))return a.K.be.Pe-=a.K.be.je,a.K.be.je=0,void u();var n=a.K.be.ke[e[_].tableID].xe;s=0;var i=function(){s<e[_].rowKeys.length?a.K.be.De("_"+n+"_hist__meta",e[_].rowKeys[s],function(t){t[0]=r.t(t[0]),t[0][o.de(2)]=0;var c=t[0][o.de(3)].shift();a.K.be.Le("_"+n+"_hist__meta",e[_].rowKeys[s],t[0],function(){c?a.K.be.et("_"+n+"_hist__data",c,function(){s++,i()}):(s++,i())})}):(_++,t())};a.K.be.et(o.de(1),e[_].id,function(){i()})};t()})}else u();else u()}else n([{msg:"0 rows "+t}],t,[])},e.prototype.Le=function(e,t){var n,i=this,a="",s=[],_=i.Fe.args||{},c=i.K.be.ke[i.qe],u=c.We;if(i.Ke("where")){a="modified",s=e.map(function(e){return e[c.We]}),n=0;var f=function(){n<e.length?i.Ze(e[n][u],function(){n++,f()}):i.it(s,a,t)};f()}else{if(a="inserted",_[u])"int"===c.Ne&&(c.at=Math.max(_[u]+1,c.at));else switch(c.Ne){case"int":_[u]=c.at++;break;case"uuid":_[u]=r.NanoSQLInstance.uuid();break;case"timeId":_[u]=r.NanoSQLInstance.timeid();break;case"timeIdms":_[u]=r.NanoSQLInstance.timeid(!0)}var l=_[u]?_[u]:c.Ye.length;if(s=[l],!c.st.getPrefix(String(l)).length){var d=i.K.be.ke[i.qe].xe;if(0!==d.indexOf("_")&&i.K.be.ot){var p="_"+d+"_hist__meta",h={};h[o.de(2)]=0,h[o.de(3)]=[0],i.K.be.Le(p,l,h)}}i.Ze(l,function(){i.it(s,a,t)})}},e.prototype._t=function(){return this.ct?this.ct:this.qe},e.prototype.Je=function(e,n){var o=this;if(o.K.he[o.qe][o.Ve])return void n(o.K.he[o.qe][o.Ve],"none",[]);var i,a,s=["join","groupby","having","orderby","offset","limit"],_={},c=function(e,t,n){return Object.keys(n).reduce(function(r,o){return r||(e[o]===t[o]?0:(e[o]>t[o]?1:-1)*("desc"===n[o]?-1:1))},0)},u=function(e,n,a){if(i=o.Ke(s[n]),2===n){var u=[];if(f.length){var l=Object.keys(t.g).map(function(e){return e+"("}),d=[];u=f.filter(function(e){return(l.reduce(function(t,n){return(e.indexOf(n)<0?0:1)+t},0)||0)>0||(d.push(e),!1)}).map(function(e){var n=e.match(/(.*)\((.*)\)/),r=n[1].trim(),o=(e.match(/\sAS\s(.*)/)||[]).pop()||r,i=n[2].split(",").map(function(e){return e.trim()});return"simple"===t.g[r].type&&o===r&&(o=i[0]),d.push(o),{name:r,args:i,as:o.trim(),type:t.g[r].type}});var p=[];if(u.length){var h,y=function(e){return u.sort(function(e,t){return e.type>t.type?1:-1}).reduce(function(n,r){var o=n.length-1;if("aggregate"===r.type){var i=e.slice();o=i.length-1,i=[i.reduce(function(e,n,i){return t.g[r.name].call(n,r.args,[i,o],e)},{})],h&&(i[0][h]=n[0][h]),n=i,h=r.name}else n=n.map(function(e,n){return t.g[r.name].call(e,r.args,[n,o])});return r.name!==r.as?d.push(r.name+" AS "+r.as):d.push(r.name),n},e.slice())},b=Object.keys(_);p=b.length?b.map(function(e){return h=null,y(_[e])}).reduce(function(e,t){return e=e.concat(t)},[]):y(e)}else p=e;var g=d.map(function(e){return e.match(/(.*)\sAS\s(.*)/)||e}).filter(function(e){return e})||[];g.length&&(p=p.map(function(e){e=r.t(e);var t={};return g.forEach(function(n){"string"==typeof n?t[n]=e[n]:t[n[2]]=e[n[1]]}),t})),e=p}}if(!i)return a(e);switch(n){case 0:var v=void 0;"cross"!==i.args.type&&(v={ut:i.args.where[0],ft:i.args.where[1],lt:i.args.where[2]});var m=o.qe,x=r.NanoSQLInstance.B(i.args.table),k=o.Ke("where"),w=o.Ke("range");o.dt(i.args.type,m,x,v,function(e){k?a(e.filter(function(e){return o.$e(e,k.args)})):w?o.Xe(w.args[0],w.args[1],a):a(e)});break;case 1:var I=i.args,O={};I?(_=e.reduce(function(e,t){var n=Object.keys(I).reduce(function(e,n){return e+"."+String(t[n])},"").slice(1);return(e[n]=e[n]||[]).push(t),O[n]=Object.keys(I).reduce(function(e,n){return e[n]=t[n],e},{}),e},{}),a(Object.keys(_).sort(function(e,t){return c(O[e],O[t],I)}).reduce(function(e,t){return e.concat(_[t])},[]))):a(e);break;case 2:a(e.filter(function(e){return o.$e(e,o.Ke("having").args)}));break;case 3:a(e.sort(function(e,t){return c(e,t,i.args)}));break;case 4:a(e.filter(function(e,t){return!i||t>=i.args}));break;case 5:a(e.filter(function(e,t){return!i||t<i.args}))}};a=-1;var f=o.Fe.args||[],l=function(e){a<s.length?(a++,u(e,a,function(e){l(e)})):(e=e.filter(function(e){return e}),o.Ke("join")||(o.K.he[o.qe][o.Ve]=e),n(e,"none",[]))};l(e)},e.prototype.He=function(e,t){var n,r="deleted",o=this,i=o.Fe.args||[],a=o.K.be.ke[o.qe].We;n=0;var s=function(){n<e.length?o.Ze(e[n][a],function(){n++,s()}):(i.length&&(r="modified"),o.it(e.map(function(e){return e[a]}),r,t))};s()},e.prototype.$e=function(e,t){var n=this,r=["AND","OR"];if("string"!=typeof t[0]){var o;return t.reduce(function(t,i,a){if(-1!==r.indexOf(i))return o=i,t;var s=0===n.pt(i[2],i[1],e[i[0]]);return 0===a?s:"AND"===o?t&&s:t||s},!0)}return 0===n.pt(t[2],t[1],e[t[0]])},e.prototype.dt=function(e,t,n,r,o){var i="outer",a=this,s=a.K.be.ke[t],_=a.K.be.ke[n],c=function(e,t){return[s,_].reduce(function(n,r,o){return r.nt.forEach(function(i){n[r.xe+"."+i]=((0===o?e:t)||{})[i]}),n},{})},u=[],f=[];a.K.be.De(s.xe,"all",function(t){a.K.be.De(_.xe,"all",function(n){t.forEach(function(t){var o=n.map(function(e){var n=c(t,e);if(!r)return n;var o=a.$e(n,[r.ut,r.ft,n[r.lt]]);return o&&f.push(e[_.We]),o?n:null}).filter(function(e){return e});o.length?u=u.concat(o):["left",i].indexOf(e)>=0&&u.push(c(t,null))}),f=f.sort().filter(function(e,t,n){return!t||e!==n[t-1]}),["right",i].indexOf(e)>=0&&n.filter(function(e){return-1===f.indexOf(e[_.We])}).forEach(function(e){u.push(c(null,e))}),o(u)})})},e.prototype.pt=function(e,t,n){var r=function(e){return"LIKE"===t&&"string"==typeof e?e.toLowerCase():e},o=r(n),i=r(e);switch(t){case"=":return o===i?0:1;case">":return o>i?0:1;case"<":return o<i?0:1;case"<=":return o<=i?0:1;case">=":return o>=i?0:1;case"IN":return i.indexOf(o)<0?1:0;case"NOT IN":return i.indexOf(o)<0?0:1;case"REGEX":return o.search(i)<0?1:0;case"LIKE":return o.indexOf(i)<0?1:0;case"BETWEEN":return i[0]<=o&&i[1]>=o?0:1;case"HAVE":return(o||[]).indexOf(i)<0?1:0;default:return 1}},e}();t.G=a},function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n={END_WORD:"$",PERMS_MIN_LEN:2},r=function(){function e(t){this.ht=e.yt(t)}return e.prototype.addWord=function(t){var n=function(t,n,r,o){return e.bt(t,n,r,o)};return t.toLowerCase().split("").reduce(n,this.ht),this},e.prototype.removeWord=function(t){var r=e.gt(this.ht,t),o=r.prefixFound,i=r.prefixNode;return o&&delete i[n.END_WORD],this},e.prototype.getWords=function(){return e.vt(this.ht,"")},e.prototype.getPrefix=function(t){if(t=t.toLowerCase(),!this.mt(t))return[];var n=e.gt(this.ht,t).prefixNode;return e.vt(n,t)},e.prototype.mt=function(t){return e.gt(this.ht,t).prefixFound},e.bt=function(e,t,r,o){return e[t]=e[t]||{},e=e[t],r===o.length-1&&(e[n.END_WORD]=1),e},e.gt=function(e,t){return{prefixFound:t.toLowerCase().split("").every(function(t,n){return!!e[t]&&(e=e[t])}),prefixNode:e}},e.yt=function(t){return t.reduce(function(t,n){return n.toLowerCase().split("").reduce(e.bt,t),t},{})},e.vt=function(t,r,o){void 0===o&&(o=[]);var i=r;for(var a in t)a===n.END_WORD&&(o.push(i),i=""),e.vt(t[a],r+a,o);return o.sort()},e}();t.Trie=r},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),o=n(2),i=n(3),a=n(1),s=n(4),_=function(){function e(e,t){this.xt=t,this.init(e,t)}return e.prototype.init=function(e,t){var n=this;n._={},n.ke={},n.kt={},n.je=0,n.Pe=0,n.Ce=[0,0],n.Oe=!1,n.ot=!0,n.wt=!0,n.It=!1,n.Ot={},n.Te={},n.St=0,n.S=e,t.O.length&&(n.It=void 0!==t.O[0].persistent&&t.O[0].persistent,n.ot=void 0===t.O[0].history||t.O[0].history,n.wt=void 0===t.O[0].memory||t.O[0].memory,t.O[0].size,n.St={IDB:1,LS:2,LVL:4}[t.O[0].mode]||0,t.O[0].rebuildIndexes&&(n.Pt=!0),t.O[0].id&&(n.S.ye=String(t.O[0].id)));var s=!1,_=0,c=!0;Object.keys(t._).forEach(function(e){var n={key:"x",type:"x"},i=[];t._[e].forEach(function(e){e.props&&-1!==e.props.indexOf("pk")&&(n=r.t(e)),!e.props||-1===e.props.indexOf("idx")&&-1===e.props.indexOf("trie")||i.push(e)}),"x"!==n.key&&"x"!==n.type&&(t._["_"+e+"_hist__data"]=r.t(t._[e]).map(function(e){return delete e.props,e}),t._["_"+e+"_hist__data"].unshift({key:o.de(4),type:"int"}),t._["_"+e+"_hist__meta"]=[n,{key:"_pointer",type:"int",default:0},{key:"_historyDataRowIDs",type:"array"}]),i.length&&"x"!==n.key&&"x"!==n.type&&i.forEach(function(r){t._["_"+e+"_idx_"+r.key]=[{key:"id",type:r.type,props:["pk"]},{key:"rowPK",type:n.type}]})}),t._[o.de(1)]=[{key:"id",type:"int",props:["ai","pk"]},{key:"tableID",type:"int"},{key:"historyPoint",type:"int"},{key:"rowKeys",type:"array"},{key:"type",type:"string"}],t._[o.de(0)]=[{key:"key",type:"string",props:["pk"]},{key:"value",type:"blob"}];var u,f,l=Object.keys(t._);Object.keys(t._).forEach(function(e){n.jt(e,t._[e])}),Object.keys(t.g||{}).forEach(function(e){i.g[e]=t.g[e]});var d=function(){n.Pt?a.k.all(Object.keys(t._).map(function(e){return new a.k(function(t,r){n.Et(e,function(){t()})})})).then(function(){n.Tt(t.P)}):n.Tt(t.P)},p=function(){var e=Object.keys(t._),r=0;if(n.St=f,u&&(n.De(o.de(0),"all",function(e){e.forEach(function(e){n.Ae("w",e.key,e.value),"historyPoint"===e.key&&(n.je=e.value||0),"historyLength"===e.key&&(n.Pe=e.value||0)})}),n.De(o.de(1),"all",function(e){e.forEach(function(e){n.Te[e.historyPoint]||(n.Te[e.historyPoint]=[]),n.Te[e.historyPoint].push(e.id)})})),c){var i=function(){r<e.length?-1!==e[r].indexOf("_hist__data")?n.Le(e[r],0,null,function(){r++,i()}):(r++,i()):(n.ot=u,d())};i()}else n.ot=u,d()};if(f=n.St,n.It)if(0!==n.St)switch(n.St){case 1:"undefined"==typeof indexedDB&&(n.St=0);break;case 2:"undefined"==typeof localStorage&&(n.St=0);break;case 4:"undefined"!=typeof window&&(n.St=0)}else"undefined"!=typeof window&&("undefined"!=typeof localStorage&&(n.St=2),"undefined"!=typeof indexedDB&&(n.St=1)),"undefined"!=typeof global&&void 0!==global.Nt&&void 0!==global.Dt&&(n.St=4);else n.St=0,p();u=n.ot,f=n.St,n.St=0,n.ot=!1;var h=function(e,t){var o=function(){if(_<l.length){var i=r.NanoSQLInstance.B(l[_]);e(l[_],i,n.ke[i]),_++,o()}else t()};o()},y=function(e){c=!1;var t=0,o=function(){if(!(t<l.length))return void(e.cleanup?e.cleanup(function(){p()}):p());var i=r.NanoSQLInstance.B(l[t]);if(!u&&(-1!==l[t].indexOf("_hist__data")||-1!==l[t].indexOf("_hist__meta")))return t++,void o();n.wt?e.requestTable(l[t],function(e){-1!==l[t].indexOf("_hist__data")?(n.ke[i].Ye.push(0),n.ke[i].st.addWord("0"),n.ke[i].Me[0]=null,n.ke[i].at++,n.S.S.loadJS(l[t],e).then(function(){t++,o()})):n.S.S.loadJS(l[t],e).then(function(){t++,o()})}):n.wt&&!e.forceIndex||e.requestIndex(l[t],function(e){n.S.be.ke[i].Ye=e,n.S.be.ke[i].at=e.reduce(function(e,t){return Math.max(e,parseInt(t)||0)},0),n.S.be.ke[i].at++,t++,o()})};o()};switch(f){case 0:p();break;case 1:var b=indexedDB.open(n.S.ye,1);b.onupgradeneeded=function(e){s=!0;var t=e.target.result,r=e.target.transaction;n.Lt=t,h(function(e,n,r){var o=r.We?{keyPath:r.We}:{};t.createObjectStore(e,o)},function(){r.oncomplete=function(){p()}})},b.onsuccess=function(e){if(n.Lt=e.target.result,!s){var t=function(e,t){var r=[],o=n.Lt.transaction(e,"readonly");o.objectStore(e).openCursor().onsuccess=function(e){var t=e.target.result;t&&(r.push(n.wt?t.value:t.key),t.continue())},o.oncomplete=function(){t(r)}};y({requestIndex:function(e,n){t(e,n)},requestTable:function(e,n){t(e,n)}})}};break;case 2:localStorage.getItem("dbID")!==n.S.ye?(localStorage.setItem("dbID",n.S.ye),h(function(e,t,n){localStorage.setItem(e,JSON.stringify([]))},function(){p()})):y({forceIndex:!0,requestIndex:function(e,t){t(JSON.parse(localStorage.getItem(e)||"[]"))},requestTable:function(e,t){var n=[];JSON.parse(localStorage.getItem(e)||"[]").forEach(function(t){n.push(JSON.parse(localStorage.getItem(e+"-"+t)||""))}),t(n)}})}},e.prototype.Et=function(e,t){var n=this,o=r.NanoSQLInstance.B(e),i=0,s=n.ke[o].ze;this.De(e,"all",function(r){var _=n.ke[o].We,c=function(){if(i<r.length){var o=0,u=function(){if(o<s.length){var t=s[o],f="_"+e+"_idx_"+t,l=String(r[i][t]).toLowerCase();n.De(f,l,function(e){var s=[r[i][_]];e.length&&e[0].rowPK&&(s=s.concat(e[0].rowPK).filter(function(e,t){return s.indexOf(e)===t})),n.Le(f,l,{id:r[i][t],rowPK:s},function(){o++,a.setFast(u)})},!0)}else i++,a.setFast(c)};u()}else t()};c()})},e.prototype.Tt=function(e){var t={},n=0,o=this;if(Object.keys(o.ke).forEach(function(e){var r=o.ke[e].xe;0!==r.indexOf("_")&&o.ke[e].tt.length&&(t[r]=o.ke[e].tt,n++)}),0===n)e();else{var i=Object.keys(t),a=0,s=function(){if(a<i.length){var n=r.NanoSQLInstance.B(i[a]);o.De(i[a],"all",function(e){e.forEach(function(e,r){t[i[a]].forEach(function(t){e[t]&&o.ke[n].Ge[t].addWord(e[t])})}),a++,s()})}else e()};s()}},e.prototype.Se=function(){var e=this;4!==e.St&&function(){Object.keys(e.Ie).forEach(function(t){e.Et(t,function(){})})}(),e.St},e.prototype.Re=function(e,t){var n=this,i=Object.keys(n.ke).map(function(e){return n.ke[e].xe}),a=0,s=function(){var e=0,a=function(){if(e<i.length)if(-1!==i[e].indexOf("_hist__meta")){var s=String(i[e]).slice(1).replace("_hist__meta",""),_=r.NanoSQLInstance.B(s),c=n.ke[_].We;n.De(s,"all",function(t){t.forEach(function(t,r){var a={};a[o.de(2)]=0,a[o.de(3)]=[r+1],n.Le(i[e],t[c],a),n.Le("_"+s+"_hist__data",r+1,t)}),e++,a()})}else e++,a();else t()};a()},_=function(){if(a<i.length){var r=!1;"hist"!==e||i[a]!==o.de(1)&&-1===i[a].indexOf("_hist__meta")&&-1===i[a].indexOf("_hist__data")||(r=!0),"all"===e&&"_utility"!==i[a]&&(r=!0),r?n.et(i[a],"all",function(){-1!==i[a].indexOf("_hist__data")&&n.Le(i[a],0,null),a++,_()}):(a++,_())}else"hist"===e?s():t()};_()},e.prototype.et=function(e,t,n){var o=this,i=r.NanoSQLInstance.B(e),a=[];if("all"===t?(a=o.ke[i].Ye.slice(),o.ke[i].Ye=[],o.ke[i].st=new s.Trie([])):(a.push(t),o.ke[i].st.removeWord(String(t)),o.ke[i].Ye.splice(o.ke[i].Ye.indexOf(t),1)),o.wt&&("all"===t?o.ke[i].Me={}:delete o.ke[i].Me[t],0===o.St&&n))return n(!0);if(o.St>0){var _=0,c=function(){if(_<a.length)switch(o.St){case 1:o.Lt.transaction(e,"readwrite").objectStore(e).delete(parseInt(a[_])),_++,c();break;case 2:localStorage.setItem(e,JSON.stringify(o.ke[i].Ye)),localStorage.removeItem(e+"-"+String(a[_])),_++,c();break;default:_++,c()}else n&&n(!0)};c()}},e.prototype.Le=function(e,t,n,i){var a=this,s=r.NanoSQLInstance.B(e);void 0!==t&&null!==t||(a._[s].forEach(function(e){e.props&&-1!==e.props.indexOf("pk")&&(t="uuid"===e.type?r.NanoSQLInstance.uuid():a.ke[s].at++)}),t||(t=parseInt(a.ke[s].Ye[a.ke[s].Ye.length-1]||"0")+1)),-1!==e.indexOf("_hist__data")&&n&&(t=n[o.de(4)]),"int"===a.ke[s].Ne&&(t=parseInt(t));var _=a.ke[s].We;if(_&&_.length&&n&&!n[_]&&(n[_]=t),a.ke[s].st.getPrefix(String(t)).length||a.ke[s].Ye.push(t),a.wt&&(a.ke[s].Me[t]=a.S.we(n,s),0===a.St&&i))return i(t);switch(a.St){case 1:var c=a.Lt.transaction(e,"readwrite"),u=c.objectStore(e);_.length&&n?u.put(n):-1!==e.indexOf("_hist__data")?u.put(n,t):(n&&u.put(n),n||u.delete(t)),c.oncomplete=function(){i&&i(t)};break;case 2:localStorage.setItem(e+"-"+String(t),n?JSON.stringify(n):""),localStorage.setItem(e,JSON.stringify(a.ke[s].Ye)),i&&i(t)}},e.prototype.At=function(e,t,n,r){var o=this,i=0===e.indexOf("_")&&-1!==e.indexOf("_idx_");if(!i||r)n(t);else{var a=i?e.slice(1,e.indexOf("_idx_")):"",s=t.reduce(function(e,t){return e.concat(t.rowPK)},[]),_=[],c=0,u=function(){c<s.length?o.De(a,s[c],function(e){_=_.concat(e),c++,u()}):n(_)};u()}},e.prototype.Ee=function(e,t,n){var r=this,o=[],i=0,a=function(){i<t.length?r.De(e,t[i],function(e){o=o.concat(e),i++,a()}):n(o)};a()},e.prototype.Ue=function(e,t,n,o){var i=this,a=this,s=r.NanoSQLInstance.B(e);if(0===a.St||2===a.St){var _=a.ke[s].Ye.indexOf(n[0]),c=[],u=function(){var t=a.ke[s].Ye[_];t<=n[1]?i.De(e,t,function(e){c=c.concat(e),_++,u()}):o(c)};return void u()}var f=[];switch(a.St){case 1:var l=a.Lt.transaction(e,"readonly"),d=l.objectStore(e),p=d.openCursor(IDBKeyRange.bound(n[0],n[1]));l.oncomplete=function(){i.At(e,f,o)},p.onsuccess=function(e){var t=e.target.result;t&&(f.push(t.value),t.continue())}}},e.prototype.De=function(e,t,n,o){var i=this,a=this,s=r.NanoSQLInstance.B(e);if(a.wt){var _=a.ke[s].Me;if("all"===t||"function"==typeof t){var c=Object.keys(_).map(function(e){return _[e]});"all"===t?a.At(e,c.filter(function(e){return e}),n,o):a.At(e,c.filter(function(e){return t(e)}),n,o)}else a.At(e,[_[t]].filter(function(e){return e}),n,o)}else switch(a.St){case 1:var u=a.Lt.transaction(e,"readonly"),f=u.objectStore(e);if("all"===t||"function"==typeof t){var l=f.openCursor(),d=[];u.oncomplete=function(){i.At(e,d,n,o)},l.onsuccess=function(e){var n=e.target.result;n&&("all"!==t?t(n.value)&&d.push(n.value):d.push(n.value),n.continue())}}else{var p=f.get(t);p.onsuccess=function(t){i.At(e,[p.result],n,o)}}break;case 2:if("all"===t||"function"==typeof t){var h=a.ke[s].Ye.map(function(t){var n=localStorage.getItem(e+"-"+t);return n&&n.length?JSON.parse(n):null});"all"!==t?this.At(e,h.filter(function(e){return t(e)}),n,o):this.At(e,h,n,o)}else{var y=localStorage.getItem(e+"-"+t);this.At(e,[y&&y.length?JSON.parse(y):null],n,o)}}},e.prototype.Ae=function(e,t,n){var r=this;return"r"===e?r.Ot[t]?r.Ot[t].value:null:(r.Le(o.de(0),t,{key:t,value:n}),r.Ae[t]={key:t,value:n},n)},e.prototype.jt=function(e,t){var n=this,o=r.NanoSQLInstance.B(e);n._[o]=t,n.S.he[o]={},n.ke[o]={We:"",Ne:"",nt:[],rt:[],ze:[],tt:[],Ge:{},xe:e,at:1,Ye:[],st:new s.Trie([]),Me:{}};for(var i=n._[o].length;i--;){var a=n._[o][i];n.ke[o].nt.unshift(a.key),n.ke[o].rt[i]=a.default,a.props&&a.props.indexOf("pk")>=0&&(n.ke[o].We=a.key,n.ke[o].Ne=a.type),a.props&&(a.props.indexOf("idx")>=0||a.props.indexOf("trie")>=0)&&n.ke[o].ze.push(a.key),a.props&&a.props.indexOf("trie")>=0&&(n.ke[o].tt.push(a.key),n.ke[o].Ge[a.key]=new s.Trie([]))}return e},e}();t.ge=_},function(e,t,n){e.exports=n(0)}])});