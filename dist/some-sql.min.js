!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n=t();for(var r in n)("object"==typeof exports?exports:e)[r]=n[r]}}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={exports:{},id:r,loaded:!1};return e[r].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){e.exports=n(1)},function(e,t,n){function r(e){return a.table(e)}var o=n(2),i=n(3),s=function(){function e(){var e=this;e.e={},e.t={},e.n={},e.r=[],e.o=[],e.i=["change","delete","upsert","drop","select","error"],e.s={},e.s["*"]={};for(var t=e.i.length;t--;)e.s["*"][e.i[t]]=[];e.a={},e._=[]}return e.prototype.table=function(e){return e&&(this.u=e,this.activeTable=e),this},e.prototype.connect=function(e){var t=this,n=this;return n.backend=e||new i.l,new o.f(function(e,r){n.backend.d({n:n.n,e:n.e,t:n.t,a:n.a,h:n.o,y:t,b:function(t){e(t,n)},v:function(e){r&&r(e,n)}})})},e.prototype.on=function(e,t){var n=this,r=n.u,o=0;if(!n.s[r])for(o=n.i.length;o--;)n.s[r][n.i[o]]=[];var i=e.split(" ");for(o=i.length;o--;)n.i.indexOf(i[o])!==-1&&n.s[r][i[o]].push(t);return n},e.prototype.off=function(e){var t=this;for(var n in t.s)for(var r in t.s[n])t.s[n][r].filter(function(t){return t!==e});return t},e.prototype.alwaysApplyFilter=function(e){return this._.indexOf(e)===-1&&this._.push(e),this},e.prototype.model=function(e){var t=this,n=t.u;t.s[n]={},t.s[n]["*"]=[];for(var r=t.i.length;r--;)t.s[n][t.i[r]]=[];return t.n[n]=e,t.t[n]=[],t.e[n]=[],t},e.prototype.views=function(e){return this.t[this.u]=e,this},e.prototype.getView=function(e,t){void 0===t&&(t={});for(var n,r=this,o=r.u,i=r.t[o].length;i--;)r.t[o][i].name===e&&(n=r.t[o][i]);if(!n)throw Error;return r.g=e,n.call.apply(r,[r.w(n.args?n.args:[],t),r])},e.prototype.w=function(e,t){var n=this,r=(n.u,{}),o=e.length?e.length:-1;if(o>0)for(;o--;){var i=e[o].split(":");i.length>1?r[i[0]]=n.x(i[1],t[i[0]]||null):r[i[0]]=t[i[0]]||null}return r},e.prototype.x=function(e,t){var n=JSON.parse(JSON.stringify(t)),r={string:String(t),int:parseInt(t),float:parseFloat(t),array:n,map:n,bool:t===!0};return r[e]||t},e.prototype.actions=function(e){return this.e[this.u]=e,this},e.prototype.doAction=function(e,t){void 0===t&&(t={});for(var n,r=this,o=r.u,i=r.e[o].length;i--;)r.e[o][i].name===e&&(n=r.e[o][i]);if(!n)throw Error;return r.g=e,n.call.apply(r,[r.w(n.args?n.args:[],t),r])},e.prototype.addFilter=function(e,t){return this.a[e]=t,this},e.prototype.query=function(e,t){this.r=[];var n=e.toLowerCase();if(["select","upsert","delete","drop"].indexOf(n)===-1)throw Error;return this.r.push({type:n,args:t}),this},e.prototype.where=function(e){return this.k("where",e)},e.prototype.orderBy=function(e){return this.k("orderby",e)},e.prototype.join=function(e){return this.k("join",e)},e.prototype.limit=function(e){return this.k("limit",e)},e.prototype.offset=function(e){return this.k("offset",e)},e.prototype.filter=function(e,t){return this.k("filter-"+e,t)},e.prototype.k=function(e,t){return this.r.push({type:e,args:t}),this},e.prototype.triggerEvent=function(e,t){for(var n,r,o=this,i=t.length,s=0;i--;)for(n=t[i],r=o.s[o.u][n].concat(o.s[o.u]["*"]),s=r.length;s--;)e.name=n,e.actionOrView=o.g||"",r[s].apply(o,[e,o]);o.g=void 0},e.prototype.exec=function(){var e=this,t=e.u;return e.T=e.r.map(function(e){switch(e.type){case"select":return[e.type];case"delete":case"upsert":case"drop":return[e.type,"change"];default:return[]}}).reduce(function(e,t){return e.concat(t)}),new o.f(function(n,r){var o=function(n,r,o){e._.length&&o!==!0&&(n=e._.reduce(function(t,r,o){return e.a[e._[o]].apply(e,[n])},n)),e.triggerEvent({name:"error",actionOrView:"",table:t,query:e.r,time:(new Date).getTime(),result:n},e.T),r(n,e)};e.backend.I({j:t,r:e.r,O:e.g||"",b:function(e){o(e,n,!1)},v:function(t){e.T=["error"],r&&o(t,r,!0)}})})},e.prototype.config=function(e){var t=this;return t.backend||t.o.push(e),t},e.prototype.extend=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=this;if(n.backend)return n.backend.S?(e.unshift(n),n.backend.S.apply(n.backend,e)):void 0},e.prototype.loadJS=function(e){var t=this;return new o.f(function(n,r){o.f.all(e.map(function(e){return t.table(t.u).query("upsert",e).exec()})).then(function(e){n(e,t)})})},e.prototype.loadCSV=function(e){var t=this,n=[];return new o.f(function(r,i){o.f.all(e.split("\n").map(function(e,r){return new o.f(function(o,i){if(0===r)n=e.split(","),o();else{var s={},a=e.match(/(".*?"|[^",\s]+)(?=\s*,|\s*$)/g)||[];a=a.map(function(e){return e.replace(/^"(.+(?="$))"$/,"$1")});for(var c=n.length;c--;)0!==a[c].indexOf("{")&&0!==a[c].indexOf("[")||(a[c]=JSON.parse(a[c].replace(/'/g,""))),s[n[c]]=a[c];t.table(t.u).query("upsert",s).exec().then(function(){o()})}})})).then(function(){r([],t)})})},e.prototype.toCSV=function(e){var t=this;return new o.f(function(n,r){t.exec().then(function(r){var o=t.r.filter(function(e){return"select"===e.type}).map(function(e){return e.args?e.args.map(function(e){return t.n[t.u].filter(function(t){return t.key===e})[0]}):t.n[t.u]})[0];e&&r.unshift(o.map(function(e){return e.key})),n(r.map(function(t,n){return e&&0===n?t:o.filter(function(e){return!!t[e.key]}).map(function(e){switch(e.type){case"map":case"array":return'"'+JSON.stringify(t[e.key]).replace(/"/g,"'")+'"';default:return JSON.stringify(t[e.key])}}).join(",")}).join("\n"),t)})})},e}();t.SomeSQLInstance=s;var a=new s;t.SomeSQL=r},function(e,t){"use strict";var n="function",r=function(){function e(e){var t=this;e&&e(function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];t.resolve.apply(t,e)},function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];t.reject.apply(t,e)})}return e.prototype.resolve=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.R(1,e)},e.prototype.reject=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.R(-1,e)},e.prototype.R=function(t,r){var o=this;if(!o.P&&r[0]!==o){if(1===t&&r[0]&&(typeof r[0]===n||"object"==typeof r[0])&&typeof r[0].then===n)return void r[0].then.call(r[0],function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];o.resolve.apply(o,e)},function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];o.reject.apply(o,e)});o.P=t,o.q=r,o.C&&o.C.forEach(function(n){1===t&&e.F(n,o.q),t===-1&&e.A(n,o.q)})}},e.prototype.then=function(t,n){var r=new e,o=this,i={promise:r,successFunc:t,failFunc:n};return o.P?1===o.P?e.F(i,o.q):e.A(i,o.q):o.C?o.C.push(i):o.C=[i],r},e.prototype.catch=function(e){return this.then(function(){},e)},e.all=function(t){var n=[];return new e(function(e,r){t&&t.length?t.forEach(function(r){r.then(function(){for(var r=[],o=0;o<arguments.length;o++)r[o]=arguments[o];n.push(r),n.length===t.length&&e(n)})}):e([])})},e.chain=function(t){var n=0,r=[];return new e(function(e){var o=function(i){n===t.length?e(r):i.then(function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];r.push(e),n++,o(t[n])})};o(t[n])})},e.race=function(t){return new e(function(e,n){t&&t.length?t.forEach(function(t){t.then(function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];e.apply(t,n)})}):e()})},e.F=function(t,n){e.R(1,t.successFunc,t,n)},e.A=function(t,n){t.failFunc&&e.R(-1,t.failFunc,t,n)},e.R=function(e,t,r,o){if(typeof t===n)try{r.promise.resolve(t.apply(r.promise,o))}catch(e){r.promise.reject(e)}else 1===e&&r.promise.resolve.apply(r.promise,o),e===-1&&r.promise.reject.apply(r.promise,o)},e}();t.f=r},function(e,t,n){var r=n(2),o={sum:function(e){return[{sum:e.map(function(e){for(var t in e)return e[t]}).reduce(function(e,t){return e+t},0)}]},min:function(e){return[{min:e.map(function(e){for(var t in e)return e[t]}).sort(function(e,t){return e<t?-1:1})[0]}]},max:function(e){return[{max:e.map(function(e){for(var t in e)return e[t]}).sort(function(e,t){return e>t?-1:1})[0]}]},average:function(e){return[{average:o.sum(e)[0].sum/e.length}]},count:function(e){return[{count:e.length}]}},i=function(){function e(){var e=this;e.n={},e.D={},e.Q=[],e.N=[[]],e.V=0,e.J={},e.H=[0,0],e.L={},e.$=[],e.B={},e.M=[]}return e.prototype.d=function(t){var n,r=this,i=0;r.y=t.y;for(var s in t.n){var a=e.z(s);for(r.n[a]=t.n[s],r.B[a]={},r.D[a]={G:"",K:s,X:1,U:[],W:{}},i=r.n[a].length;i--;)n=r.n[a][i],n.props&&n.props.indexOf("pk")!==-1&&(r.D[a].G=n.key)}if(r.Y=e.z(JSON.stringify(t.n)),t.a)for(var c in t.a)o[c]=t.a[c];t.b()},e.prototype.I=function(t){var n=this;n.Q.length?n.Q.push(t):(n.u=e.z(t.j),new s(n).Z(t).then(function(e){n.Q.length&&n.I(n.Q.pop())}))},e.prototype.ee=function(e){for(var t=this,n=[t.u],r=t.M.length;r--;)t.M[r].indexOf(t.u)!==-1&&n.concat(t.M[r]);t.te(n.sort()).forEach(function(n){t.B[n]={},e&&t.y.triggerEvent({name:"change",actionOrView:"",table:t.D[n].K,query:[],time:(new Date).getTime(),result:[]},["change"])})},e.prototype.te=function(e){return e.filter(function(e,t,n){return!t||e!==n[t-1]})},e.prototype.S=function(e,t){var n,o,i=this,s=function(e){for(n=i.N[i.V].length;n--;)i.J[i.N[i.V][n]]+=e,i.J[i.N[i.V][n]]<0&&(i.J[i.N[i.V][n]]=0)};return new r.f(function(e,n){if(!i.N.length&&["<",">"].indexOf(t)!==-1)return void e(!1);switch(t){case"<":i.V===i.N.length-1?e(!1):(s(1),i.V++,i.ee(!0),e(!0));break;case">":i.V<1?e(!1):(i.V--,s(-1),i.ee(!0),e(!0));break;case"?":o=[i.N.length-1,i.V],i.H.join("+")!==o.join("+")&&(i.H=o),e(i.H)}})},e.z=function(e){return Math.abs(e.split("").reduce(function(t,n,r){return(t<<5)+t+e.charCodeAt(r)},0))},e}();t.l=i;var s=function(){function e(e){this.ne=e}return e.prototype.Z=function(e){var t=this;return new r.f(function(n,o){t.re=[],t.oe=void 0,t.ne.u=i.z(e.j),t.ie=i.z(JSON.stringify(e.r)),r.f.all(e.r.map(function(e){return new r.f(function(n,r){["upsert","select","delete","drop"].indexOf(e.type)!==-1?t.oe=e:t.re.push(e),n()})})).then(function(){t.se(function(r){e.b(r),n(t)})})})},e.prototype.ae=function(){var e=this,t=e.ne.$.length;return e.ne.$.push([null]),e.ne.D[e.ne.u].U.push(t),e.ne.J[t]=0,t},e.prototype.se=function(e){var t=this;if(t.oe){var n,o,s,a,c,_,u,l,f,d,p,h,y,b,v,g=t.ne.D[t.ne.u].G,m=t.oe.args||[],w=0,x=[],k=[],T=t.ne.D[t.ne.u].U.slice(),I=[],j=t.re.filter(function(e){return"where"===e.type}),O=function(e){return t.re.filter(function(t){return t.type===e}).pop()},S=function(n,r){n>0?(t.ne.V>0&&(t.ne.N=t.ne.N.filter(function(e,n){if(n<t.ne.V){for(s=e.length;s--;)t.ne.J[e[s]]=0,t.ne.$[e[s]].shift();return!1}return!0}),t.ne.V=0),t.ne.N.unshift(k),t.ne.ee(!1),e([{msg:n+" row(s) "+r}])):e([{msg:"0 rows "+r}])},R=function(e,n){k.push(e);var r=JSON.parse(JSON.stringify(t.ce(e)||{}));for(var o in m)r[o]=n(o,r[o]);t.ne.$[e].unshift(Object.freeze(r))};switch("drop"!==t.oe.type&&(x=j.length&&!O("join")?t._e(T,j[0].args):T),t.oe.type){case"upsert":if(n="updated",o=x.length,j.length)for(w=o,n="modified";o--;)R(x[o],function(e,t){return e!==g?m[e]:t});else{if(a=0,m[g])t.ne.D[t.ne.u].W[m[g]]?a=t.ne.D[t.ne.u].W[m[g]]:(a=t.ae(),t.ne.D[t.ne.u].X=Math.max(m[g],t.ne.D[t.ne.u].X),t.ne.D[t.ne.u].W[m[g]]=a);else for(c=t.ne.n[t.ne.u].length;c--;)_=t.ne.n[t.ne.u][c],_.props&&_.props.indexOf("pk")!==-1&&"int"===_.type&&(m[g]=t.ne.D[t.ne.u].X++,a=t.ae(),t.ne.D[t.ne.u].W[m[g]]=a);R(a,function(e,t){return m[e]||t}),w=1,n="inserted"}S(w,n);break;case"select":if(t.ne.B[t.ne.u][t.ie]){e(t.ne.B[t.ne.u][t.ie]);break}u=["join","orderby","offset","limit"];var P=function(e,n){return new r.f(function(r,o){if(l=O(u[n]),!l)return r(e),!1;switch(n){case 0:t.ne.y.table(l.args.table).query("select").exec().then(function(n,o){if(l){f=l.args.where.map(function(e,t){return e.split(".").map(function(e,n){return 1!==t&&0===n?i.z(e):e})});var s=t.ne.D[f[2][0]];n=n.map(function(e){return s.W[e[s.G]]}).filter(function(e){return e}),e=t.ue(l.args.type,e,n,f),j.length&&(e=t._e(e,j[0].args)),r(e)}});break;case 1:r(e.sort(function(e,n){if(l){d=[];for(var r in l.args)d.push(r);return d.reduce(function(r,o,i){if(l)return p=d[i],h=t.ce(e)||{},y=t.ce(n)||{},(h[p]>y[p]?1:-1)*("asc"===l.args[p]?1:-1)+r},0)}}));break;case 2:r(e.filter(function(e,t){return!l||t>=l.args}));break;case 3:r(e.filter(function(e,t){return!l||t<l.args}))}})};o=u.length;var q=function(n){o>-1?(o--,P(n,o).then(function(e){q(e)})):(n.forEach(function(e){if(m.length)if(s=m.length,b=t.ce(e))for(v={};s--&&v&&b;)v[m[s]]=b[m[s]];else v=null;else v=t.ce(e);v&&I.push(v)}),I=t.le(I),t.ne.B[t.ne.u][t.ie]=I,e(t.ne.B[t.ne.u][t.ie]))};q(x);break;case"drop":case"delete":var C=[];for(C=x.length&&"delete"===t.oe.type?x:T,n="deleted",o=C.length;o--;)m.length?(R(C[o],function(e,t){return m.indexOf(e)!==-1?null:t}),n="modified"):t.ne.$[C[o]].unshift(null);S(o,n)}}},e.prototype.ce=function(e){return this.ne.$[e][this.fe(e)]},e.prototype.fe=function(e){return this.ne.J[e]},e.prototype.de=function(e,t){var n,r=this;return e.filter(function(e){return n=r.ce(e),!!n&&0===r.pe(t[2],t[1],n[t[0]])})},e.prototype._e=function(e,t){var n,r=this,o=["and","or"],i=function(e,t){return r.ne.te(e[0].concat(e[1]).sort().filter(function(e,n,r){return"and"!==t||n!==r.lastIndexOf(e)}))};return"string"==typeof t[0]?r.de(e,t):t.map(function(t){return o.indexOf(t)!==-1?t:r.de(e,t)}).reduce(function(e,t,r){return o.indexOf(t)===-1?0===r?t:i([e,t],n):(n=t,e)})},e.prototype.ue=function(e,t,n,r){var o,i,s,a,c,_,u=this,l=[],f=[],d=[r[0][0],r[2][0]],p=[u.ne.D[r[0][0]].K,u.ne.D[r[2][0]].K],h=[u.ne.n[r[0][0]],u.ne.n[r[2][0]]],y={},b=[],v=[],g=t.length;for(g=u.ne.M.length,a=0;g--&&!a;)u.ne.M[g].indexOf(d[0])!==-1&&u.ne.M[g].indexOf(d[1])!==-1&&(a=1);a||u.ne.M.push(d);var m=function(e,t){return o=e.join("+"),i=!1,_=e.map(function(e){return u.fe(e)}),u.ne.L[o]||(i=!0,u.ne.L[o]={he:0,ye:_}),(i||_.join("+")!==u.ne.L[o].ye.join("+"))&&(y={},h.forEach(function(n,r){s=e[r]===-1||t[r]===!1,n.forEach(function(e){y[p[r]+"."+e.key]=s?null:t[r][e.key]})}),i&&(u.ne.L[o].he=u.ae()),u.ne.$[u.ne.L[o].he].unshift(y)),u.ne.L[o].he};for(g=t.length;g--;){for(a=n.length,l[0]=u.ce(t[g])||{},b=[];a--;)l[1]=u.ce(n[a])||{},u.pe(l[0][r[0][1]],r[1][0],l[1][r[2][1]])&&"cross"!==e||(b.push([n[a],l[1]]),v.push(n[a]));if(c=b.length)for(;c--;)f.push(m([t[g],b[c][0]],[l[0],b[c][1]]));else"left"===e&&f.push(m([t[g],-1],[l[0],!1]))}if("right"===e)for(g=n.length;g--;)v.indexOf(n[g])===-1&&f.push(m([-1,n[g]],[!1,u.ce(n[g])||{}]));return f.reverse()},e.prototype.pe=function(e,t,n){switch(t){case"=":return n===e?0:1;case">":return n>e?0:1;case"<":return n<e?0:1;case"<=":return n<=e?0:1;case">=":return n>=e?0:1;case"IN":return e.indexOf(n)===-1?1:0;case"NOT IN":return e.indexOf(n)===-1?0:1;case"REGEX":case"LIKE":return n.search(e)===-1?1:0;default:return 0}},e.prototype.le=function(e){var t=this,n=t.re.filter(function(e){return 0===e.type.indexOf("filter-")});return n.length?n.reduce(function(e,r,i){return o[n[i].type.replace("filter-","")].apply(t,[e,n[i].args])},e):e},e}()}])});