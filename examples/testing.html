<html>
    <head>
        <script src="some-sql.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/alasql/0.3.7/alasql.min.js"></script>
    </head>
    <body>
        <script>
            let blank = () => {
                return {
                    title: "Hello, world!",
                    name: Math.round(Math.random()*100000).toString(16)
                }
            }

            SomeSQL("test").model([
                {key:"id",type:"int",props:["ai","pk"]},
                {key: "title", type: "string"},
                {key: "name", type: "string"}
            ]).connect().then(() => {
                //SomeSQL().extend("disable");
                console.time("DB");
                let i = 0
                let upsert = () => {
                    SomeSQL("test").query("upsert",blank()).exec().then((rows, db) => {
                        i++;
                        if(i < 1000) {
                            upsert();
                        } else {
                            console.timeEnd("DB");
                        }
                    });
                }

                upsert();
            });
        /* This file used to run tests and play with the lib */
  
/*
            SomeSQL('users') // <= Table Name
            .model([ // <= create table model before you can use it
                {key:'id',type:'int',props:['pk','ai']},
                {key:'name',type:'string'},
            ])
            .connect()
            .then(function() {
                this.query('upsert',{id:null,name:'Scott'}).exec() // <= drop in some data
                .then(function(response) {
                    return this.query('select').exec(); // <= Select entire table
                })
                .then(function(response) {
                    console.log(response) // <= [{id:1,name:'Scott'}]
                    return this.query('select').toCSV(); //<= convert the table to CSV
                })
                .then(function(response) {
                    console.log(response); //<= 1,"Scott"
                })
            });
*/


/*

            //spec for dbs like MySQL:
            var mySQL = new mySQLDriver({
                address:'localhost',
                user:'username',
                pass:'password',
                db:'dbname';
            });

            //Mysql Index View
            {
                name: 'get_user_by_name',
                args: ['name:string'],
                extend: {
                    mysql-index:['name:asc','age']
                },
                call: function(args, db) {
                    return db.query('select').where(['name','=',args.name]).exec();
                }
            },
            
            //Declare models, actions, and views

            SomeSQL().connect(mySQL).then(function() {
                //database ready
            })            
            
            for(let i = 0; i < 10; i++) {
                console.log(SomeSQLInstance.uuid().replace(/-/g,"").match(/.{1,4}/g).map((v) => {
                    return parseInt(v,16);
                }));
            }
*/
/*

            SomeSQL('users')//Table/Store Name
            .model([ //Data Model
                {key:'id',type:'int',props:['pk','ai']},
                {key:'name',type:'string'},
                {key:'age',type:'int'},
                {key:'balance',type:'float'},
                {key:'postIDs',type:'array'},
                {key:'meta',type:'map'}
            ])
            .views([ //Cached views to show specific data
                {
                    name: 'get_user_by_name',
                    args: ['name:string'],
                    call: function(args, db) {
                        return db.query('select').where(['name','=',args.name]).exec();
                    }
                },
                {
                    name: 'list_all_users',
                    args: ['page:int'],
                    call: function(args, db) {
                        return db.query('select',['id','name']).exec();
                    }
                }                    
            ])
            .actions([ //Cached actions to update specific data
                {
                    name:'add_new_user',
                    args:['user:map'],
                    call:function(args, db) {
                        return db.query('upsert',args.user).exec();
                    }
                },
                {
                    name:'login',
                    args:['username:string','password:string'],
                    call:function(args, db) {
                        return db.query('select',['id']).where([['username','=',args.username],'and',['password','=',args.password]]).exec();
                    }
                }
            ])
            SomeSQL("orders").model([
                {key:'id',type:'int',props:['pk','ai']},
                {key:'title',type:'string'},
                {key:'userID',type:'int'}
            ])
            .config({persistent: true})
            .connect().then(() => {

                SomeSQL("orders").loadJS([
                    {id:1,title:"Test",userID:1},
                    {id:2,title:"Test",userID:1},
                    {id:3,title:"Test",userID:3}
                ]);
            

                SomeSQL('*').on('change',function(e) {
                    //console.log(e);
                });

                SomeSQL('users').loadJS([
                    {
                        id:null,
                        name:'bob',
                        age:20,
                        balance:25.02,
                        postIDs:[0,20,5],
                        meta:{
                            favorteColor:'blue'
                        }
                    },
                    {
                        id:null,
                        name:'jeb',
                        age:25,
                        balance:25.02,
                        postIDs:[0,20,5],
                        meta:{
                            favorteColor:'blue'
                        }
                    },
                    {
                        id:null,
                        name:'kevin',
                        age:50,
                        balance:22.02,
                        postIDs:[0,20,5],
                        meta:{
                            favorteColor:'blue'
                        }
                    },
                    {
                        id:null,
                        name:'scott',
                        age:21,
                        balance:25.02,
                        postIDs:[0,20,5],
                        meta:{
                            favorteColor:'blue'
                        }
                    }
                ]).then(function() {
    
                    SomeSQL('users').query("select").exec()
                    .then(function(result, db) {
                        return db.query('upsert',{balance:50}).where(['name','=','jeb']).exec();
                    })         
                    .then(function(result, db) {
                        console.log(result);
                        //return this.query('select').orderBy({name:'desc'}).where([['age','>',25],'and',['id','>',2]]).toCSV();
                        return db.query('select',['name']).orderBy({name:'asc'}).exec();
                    })
                    .then(function(result, db) {
                        db.query('select',['name']).orderBy({name:'asc'}).exec().then(function(result2) {
                            console.log('immuTest: ' + (result === result2));
                        });
                        console.log(result);
            
                        return db.query('select').toCSV(true);
                    })  
                    .then(function(result, db) {
                        console.log(result);
                        // return db.query('drop').exec();
                    })

                    SomeSQL("orders").query("select").join({
                        type: "inner",
                        table: "users",
                        where: ["orders.userID","=","users.id"]      
                    }).exec().then(function(rows) {
                        console.log("JOIN", rows);
                    });
                });
            });




            /*
            //Possible ORM Api  

            SomeSQL("posts")
            .model([
                {key:'id',type:'int',props:['pk','ai']},
                {key:'title',type:'string'}
            ])
            SomeSQL("dog")
            .model([
                {key:'id',type:'int',props:['pk','ai']},
                {key:'name',type:'string'}
            ])
            SomeSQL("users")
            .model([
                {key:'id',type:'int,props:['pk','ai']},
                {key:'posts',type:'relation',props:['many::posts']}
                {key:'dog',type:'relation',props:['one::dog']}
            ])
            .connect()
           

            possible new select syntax:

            .query("select",["max(col1) as hello","col2"]).groupBy(["hello"])

            */
        </script>
        Everything is in the console, not much to see here just a scratchpad to test queries with.
    </body>
</html> 