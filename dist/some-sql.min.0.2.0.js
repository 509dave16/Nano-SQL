!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n=t();for(var r in n)("object"==typeof exports?exports:e)[r]=n[r]}}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={exports:{},id:r,loaded:!1};return e[r].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){e.exports=n(1)},function(e,t,n){"use strict";function r(e){return a.table(e)}var o=n(2),i=n(3),c=function(){function e(){var e=this;e.e={},e.t={},e.n={},e.r=[],e.o=[],e.i=["change","delete","upsert","drop","select","error"],e.a={},e.a["*"]={},e.i.forEach(function(t){e.a["*"][t]=[]}),e.s={},e.u=[]}return e.prototype.table=function(e){return e&&(this.f=e),this},e.prototype.connect=function(e){var t=this;return t.l=e||new i._,new o.TSPromise(function(e,n){t.l.connect(t.n,t.e,t.t,t.s,t.o,function(n){e(n,t)},function(e){n&&n(e,t)})})},e.prototype.on=function(e,t){var n=this,r=n.f;return n.a[r]||n.i.forEach(function(e){n.a[r][e]=[]}),e.split(" ").forEach(function(e){n.i.indexOf(e)!==-1&&n.a[r][e].push(t)}),n},e.prototype.off=function(e){for(var t in this.a)for(var n in this.a[t])this.a[t][n].filter(function(t){return t!==e});return this},e.prototype.alwaysApplyFilter=function(e){return this.u.indexOf(e)===-1&&this.u.push(e),this},e.prototype.model=function(e){var t=this,n=t.f;return t.a[n]={},t.a[n]["*"]=[],t.i.forEach(function(e){t.a[n][e]=[]}),t.n[n]=e,t.t[n]=[],t.e[n]=[],t},e.prototype.views=function(e){return this.t[this.f]=e,this},e.prototype.getView=function(e,t){void 0===t&&(t={});var n,r=this,o=r.f;if(r.t[o].forEach(function(t){t.name===e&&(n=t)}),!n)throw Error("View does not exist");return r.h=e,n.call.apply(r,[r.d(n.args?n.args:[],t),r])},e.prototype.d=function(e,t){var n=this,r=(n.f,{});return e&&e.forEach(function(e){var o=e.split(":");o.length>1?r[o[0]]=n.y(o[1],t[o[0]]||null):r[o[0]]=t[o[0]]||null}),r},e.prototype.y=function(e,t){var n=JSON.parse(JSON.stringify(t)),r={string:String(t),int:parseInt(t),float:parseFloat(t),array:n,map:n,bool:t===!0};return r[e]},e.prototype.actions=function(e){return this.e[this.f]=e,this},e.prototype.doAction=function(e,t){void 0===t&&(t={});var n,r=this,o=r.f;if(r.e[o].forEach(function(t){t.name===e&&(n=t)}),!n)throw Error("Action does not exist");return r.h=e,n.call.apply(r,[r.d(n.args?n.args:[],t),r])},e.prototype.addFilter=function(e,t){return this.s[e]=t,this},e.prototype.query=function(e,t){this.r=[];var n=e.toLowerCase();return["select","upsert","delete","drop"].indexOf(n)!==-1?this.r.push({type:n,args:t}):console.error("Invalid query '"+e+"'!"),this},e.prototype.where=function(e){return this.v("where",e)},e.prototype.orderBy=function(e){return this.v("orderby",e)},e.prototype.limit=function(e){return this.v("limit",e)},e.prototype.offset=function(e){return this.v("offset",e)},e.prototype.filter=function(e,t){return this.v("filter-"+e,t)},e.prototype.v=function(e,t){return this.r.push({type:e,args:t}),this},e.prototype.exec=function(){var e=this,t=e.f;e.x=e.r.map(function(e){switch(e.type){case"select":return[e.type];case"delete":case"upsert":case"drop":return[e.type,"change"];default:return[]}}).reduce(function(e,t){return e.concat(t)});var n=function(n){e.x.forEach(function(r){e.a[t][r].concat(e.a[t]["*"]).forEach(function(t){n.name=r,n.actionOrView=e.h||"",t.apply(e,[n,e])})}),e.h=void 0};return new o.TSPromise(function(r,o){var i=function(r,o,i){e.u.length&&i!==!0&&(r=e.u.reduce(function(t,n,o){return e.s[e.u[o]].apply(e,[r])},r)),n({name:"error",actionOrView:"",table:t,query:e.r,time:(new Date).getTime(),result:r}),o(r,e)};e.l.exec(t,e.r,e.h||"",function(e){i(e,r,!1)},function(t){e.x=["error"],o&&i(t,o,!0)})})},e.prototype.extend=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=this;return n.l?n.l.extend?n.l.extend.apply(n,e):void 0:(n.o.push(e),this)},e.prototype.loadJS=function(e){var t=this;return o.TSPromise.all(e.map(function(e){return t.table(t.f).query("upsert",e).exec()}))},e.prototype.loadCSV=function(e){var t=this,n=[];return new o.TSPromise(function(r,i){o.TSPromise.all(e.split("\n").map(function(e,r){return new o.TSPromise(function(o,i){if(0===r)n=e.split(","),o();else{var c={},a=e.match(/(".*?"|[^",\s]+)(?=\s*,|\s*$)/g)||[];a=a.map(function(e){return e.replace(/^"(.+(?="$))"$/,"$1")}),n.forEach(function(e,t){0!==a[t].indexOf("{")&&0!==a[t].indexOf("[")||(a[t]=JSON.parse(a[t].replace(/'/g,""))),c[e]=a[t]}),t.table(t.f).query("upsert",c).exec().then(function(){o()})}})})).then(function(){r([],t)})})},e.prototype.toCSV=function(e){var t=this;return new o.TSPromise(function(n,r){t.exec().then(function(r){var o=t.r.filter(function(e){return"select"===e.type}).map(function(e){return e.args?e.args.map(function(e){return t.n[t.f].filter(function(t){return t.key===e})[0]}):t.n[t.f]})[0];e&&r.unshift(o.map(function(e){return e.key})),n(r.map(function(t,n){return e&&0===n?t:o.filter(function(e){return!!t[e.key]}).map(function(e){switch(e.type){case"map":return'"'+JSON.stringify(t[e.key]).replace(/"/g,"'")+'"';case"array":return'"'+JSON.stringify(t[e.key]).replace(/"/g,"'")+'"';default:return JSON.stringify(t[e.key])}}).join(",")}).join("\n"),t)})})},e.uuid=function(e){return e?e:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,n="x"===e?t:3&t|8;return n.toString(16)})}()},e.hash=function(e){for(var t=5381,n=0;n<e.length;n++){var r=e.charCodeAt(n);t=(t<<5)+t+r}return String(t)},e}();t.SomeSQLInstance=c;var a=new c;t.SomeSQL=r},function(e,t){"use strict";var n="function",r=function(){function e(e){var t=this;e&&e(function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];t.resolve.apply(t,e)},function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];t.reject.apply(t,e)})}return e.prototype.resolve=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.g(1,e)},e.prototype.reject=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.g(-1,e)},e.prototype.g=function(t,r){var o=this;if(!o.b&&r[0]!==o){if(1===t&&r[0]&&(typeof r[0]===n||"object"==typeof r[0])&&typeof r[0].then===n)return void r[0].then.call(r[0],function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];o.resolve.apply(o,e)},function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];o.reject.apply(o,e)});o.b=t,o.w=r,o.T&&o.T.forEach(function(n){1===t&&e.k(n,o.w),t===-1&&e.S(n,o.w)})}},e.prototype.then=function(t,n){var r=new e,o=this,i={promise:r,successFunc:t,failFunc:n};return o.b?1===o.b?e.k(i,o.w):e.S(i,o.w):o.T?o.T.push(i):o.T=[i],r},e.prototype.catch=function(e){return this.then(function(){},e)},e.all=function(t){var n=[];return new e(function(e,r){t&&t.length?t.forEach(function(r){r.then(function(){for(var r=[],o=0;o<arguments.length;o++)r[o]=arguments[o];n.push(r),n.length===t.length&&e(n)})}):e([])})},e.chain=function(t){var n=0,r=[];return new e(function(e){var o=function(i){n===t.length?e(r):i.then(function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];r.push(e),n++,o(t[n])})};o(t[n])})},e.race=function(t){return new e(function(e,n){t&&t.length?t.forEach(function(t){t.then(function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];e.apply(t,n)})}):e()})},e.k=function(t,n){e.g(1,t.successFunc,t,n)},e.S=function(t,n){t.failFunc&&e.g(-1,t.failFunc,t,n)},e.g=function(e,t,r,o){if(typeof t===n)try{r.promise.resolve(t.apply(r.promise,o))}catch(e){r.promise.reject(e)}else 1===e&&r.promise.resolve.apply(r.promise,o),e===-1&&r.promise.reject.apply(r.promise,o)},e}();t.TSPromise=r},function(e,t,n){"use strict";var r=n(1),o=n(2),i=function(){function e(){var e=this;e.s={},e.O={},e.F={},e.K={},e.j={},e.C=[],e.q()}return e.prototype.connect=function(e,t,n,r,o,i){var c=this;for(var a in e)c.I(a,e[a]);c.s=r,i()},e.prototype.I=function(e,t){this.K[e]={},this.F[e]={},this.O[e]=new c(t)},e.prototype.exec=function(e,t,n,i,c){var a=this;return void 0!==a.N?void a.C.push([e,t,n,i,c]):(a.f=e,a.A=[],a.N=void 0,a.J=r.SomeSQLInstance.hash(JSON.stringify(t)),a.j[a.J]=t,void o.TSPromise.all(t.map(function(e){return new o.TSPromise(function(t,n){a.r(e,t)})})).then(function(){a.Q(function(e){i(e),a.N=void 0,a.C.length&&a.exec.apply(a,a.C.pop())})}))},e.prototype.r=function(e,t){["upsert","select","delete","drop"].indexOf(e.type)!==-1?this.N=e:this.A.push(e),t()},e.prototype.q=function(){var e=this;e.s={sum:function(t){return[{sum:t.map(function(t){return e.N?t[e.N.args[0]]:0}).reduce(function(e,t){return e+t},0)}]},first:function(e){return[e[0]]},last:function(e){return[e.pop()]},min:function(t){return[{min:t.map(function(t){return e.N?t[e.N.args[0]]:0}).sort(function(e,t){return e<t?-1:1})[0]}]},max:function(t){return[{max:t.map(function(t){return e.N?t[e.N.args[0]]:0}).sort(function(e,t){return e>t?-1:1})[0]}]},average:function(t){return[{average:e.V("sum",t)[0].sum/t.length}]},count:function(e){return[{length:e.length}]}}},e.prototype.V=function(e,t,n){return this.s[e].apply(this,[t,n])},e.prototype.P=function(e){var t=this,n=t.A.filter(function(e){return 0===e.type.indexOf("filter-")});return n.length?n.reduce(function(e,r,o){return t.V(n[o].type.replace("filter-",""),e,n[o].args)},e):e},e.prototype.L=function(e){var t=this;t.K[t.f]={},t.F[t.f]={}},e.prototype.Q=function(e){var t=this,n=t.A.filter(function(e){return"where"===e.type}),r=n.length?n[0].args:void 0;if(!t.N)throw Error("No action specified!");var o,i=t.N.args,c=t.O[t.f],a=0;switch(t.N.type){case"upsert":if(r){o=t.M(c,r);var s=[];o.W.forEach(function(e){for(var t in i)c.D[e][t]=i[t];s.push(e),a++}),t.L(s)}else c.R(i),a++,t.K[t.f]={},t.F[t.f]={};e([{result:a+" row(s) upserted"}]);break;case"select":if(t.K[t.f][t.J])return void e(t.K[t.f][t.J]);o=r?t.M(c,r):c.$();var u=["or","of","lm","cl"],f=function(e){return t.A.filter(function(t){return t.type===e}).pop()},l=u.reduce(function(e,t,n){switch(u[n]){case"or":var r=f("orderby");if(r){var o=r.args;return e.sort(function(e,t){var n=[];for(var r in o)n.push(r);return n.reduce(function(r,i,c){var a=n[c];return e[a]===t[a]?0+r:(e[a]>t[a]?1:-1)*("asc"===o[a]?1:-1)+r},0)})}case"of":var a=f("offset");if(a){var s=a.args;return e.filter(function(e,t){return t>=s})}case"lm":var l=f("limit");if(l){var _=l.args;return e.filter(function(e,t){return t<_})}case"cl":if(i){var p=c.B.map(function(e){return e.key}).filter(function(e){return i.indexOf(e)===-1});return e.map(function(e){return p.forEach(function(t){return delete e[t]}),e})}default:return e}},o.G()),_=t.P(l);t.K[t.f][t.J]=_,t.F[t.f][t.J]=l.map(function(e){return e[o.X]}),e(_);break;case"delete":if(r){var p=[],h=t.M(c,r);h.W.forEach(function(e){c.z(e),p.push(e)}),t.L(p),e([{result:h.length+" row(s) deleted"}])}else t.I(t.f,t.O[t.f].B),e([{result:"Table Dropped"}]);break;case"drop":t.I(t.f,t.O[t.f].B),e([{result:"Table Dropped"}])}},e.prototype.M=function(e,t){var n=this;if(t&&t.length){if("string"==typeof t[0])return n.H(e.$(),t);var r,o=0;return t.map(function(t){return n.H(e.$(),t)}).reduce(function(e,n,i){if(0===i)return n;if(0===o)return r=t[i],o=1,e;if(1===o)switch(o=0,r){case"and":return e.U("inner",n);case"or":return e.U("outer",n);default:return e}return e})}return e.$()},e.prototype.H=function(e,t){var n=this,r=(t[0],t[1]),o=t[2];return e.W=e.W.filter(function(i){return 0===n.Y(o,r,e.D[i][t[0]])}),e},e.prototype.Y=function(e,t,n){var r=e.indexOf(n)===-1?0:1,o={"=":n===e?0:1,">":n>e?0:1,"<":n<e?0:1,"<=":n<=e?0:1,">=":n>=e?0:1,IN:e.indexOf(n)===-1?1:0,"NOT IN":e.indexOf(n)===-1?0:1,REGEX:r,LIKE:r};return o[t]},e}();t._=i;var c=function(){function e(e,t,n){var r=this;r.B=e,r.W=t||[],r.D={},r.Z=1,r.length=0,r.X=r.B.reduce(function(e,t){return t.props&&t.props.indexOf("pk")!==-1?(r.ee=t.type,t.key):e},""),n&&n.forEach(function(e){r.D[e[r.X]]=e})}return e.prototype.G=function(){var e=this;return e.W.map(function(t){return e.D[t]})},e.te=function(e){return JSON.parse(JSON.stringify(e))},e.prototype.R=function(e){var t=this;if(e=JSON.parse(JSON.stringify(e)),t.B.forEach(function(t){e[t.key]=e[t.key]||t.default||void 0}),e[t.X])t.D[e[t.X]]=e;else{switch(t.ee){case"int":e[t.X]=t.Z,t.Z++;break;case"uuid":e[t.X]=r.SomeSQLInstance.uuid()}t.W.push(e[t.X]),t.D[e[t.X]]=e,t.length=t.W.length}},e.prototype.z=function(e){this.W.splice(this.W.indexOf(e),1)},e.prototype.U=function(e,t,n,r){var o=this,i=[];i=n?n:[o.X,t.X];var c=[this,t];return"inner"===e&&c.sort(function(e,t){return e.length>t.length?-1:1}),c[0].W.forEach(function(t){var n;if(c[1].W.forEach(function(e){void 0===n&&c[0].D[t][i[0]]===c[1].D[t][i[1]]&&(n=c[1].D[t])}),void 0===n)switch(e){case"inner":c[0].z(t)}else switch(e){case"outer":c[1].R(n)}}),"outer"===e&&c[0].W.sort(function(e,t){return e>t?1:-1}),c[0]},e.prototype.$=function(){var t=new e(this.B,e.te(this.W),e.te(this.G()));return t.Z=this.Z,t.length=this.length,t},e}()}])});